<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒŒê²¬í•™ë‹¹ ì •ë³´ ê´€ë¦¬ - ì„¸ì¢…í•™ë‹¹ ë¬¸í™”ì¸í„´ ì§€ì› ì‹œìŠ¤í…œ</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../css/main.css?v=4.4.0">
    <link rel="stylesheet" href="../css/institute.css?v=4.4.0">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Supabase JavaScript Client -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="institute-management-container">
        <!-- í—¤ë” ì„¹ì…˜ -->
        <div class="institute-header">
            <div class="institute-header-content">
                <div class="institute-header-title">
                    <h1>íŒŒê²¬í•™ë‹¹ ì •ë³´ ê´€ë¦¬</h1>
                    <p>ì„¸ì¢…í•™ë‹¹ì˜ 15ê°œ í•„ë“œ ì •ë³´ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ë¬¸í™”ì¸í„´ ë°°ì • í˜„í™©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
                <button class="institute-btn institute-btn-secondary" onclick="goBackToDashboard()">
                    <i data-lucide="arrow-left"></i>
                    ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                </button>
            </div>
        </div>

        <!-- í†µê³„ ì„¹ì…˜ -->
        <div class="institute-stats-section">
            <div class="institute-stat-card total">
                <div class="institute-stat-icon">
                    <i data-lucide="building2"></i>
                </div>
                <div class="institute-stat-number" id="total-institutes">-</div>
                <p class="institute-stat-label">ì´ ì„¸ì¢…í•™ë‹¹ ìˆ˜</p>
            </div>
            <div class="institute-stat-card assigned">
                <div class="institute-stat-icon">
                    <i data-lucide="users"></i>
                </div>
                <div class="institute-stat-number" id="assigned-interns">-</div>
                <p class="institute-stat-label">ë°°ì •ëœ ë¬¸í™”ì¸í„´</p>
            </div>
            <div class="institute-stat-card active">
                <div class="institute-stat-icon">
                    <i data-lucide="check-circle"></i>
                </div>
                <div class="institute-stat-number" id="complete-institutes">-</div>
                <p class="institute-stat-label">ì •ë³´ ì™„ì„± í•™ë‹¹</p>
            </div>
            <div class="institute-stat-card pending">
                <div class="institute-stat-icon">
                    <i data-lucide="alert-circle"></i>
                </div>
                <div class="institute-stat-number" id="incomplete-institutes">-</div>
                <p class="institute-stat-label">ì •ë³´ ë¯¸ì™„ì„± í•™ë‹¹</p>
            </div>
        </div>

        <!-- í•„í„° ë° ê²€ìƒ‰ ì„¹ì…˜ -->
        <div class="institute-filters-section">
            <div class="institute-filters-grid">
                <div class="institute-search-box">
                    <i data-lucide="search" class="institute-search-icon"></i>
                    <input type="text" class="institute-search-input" id="institute-search" 
                           placeholder="í•™ë‹¹ëª…, ìš´ì˜ê¸°ê´€, ë‹´ë‹¹ì ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰...">
                </div>
                <div class="institute-view-toggle">
                    <button class="institute-view-btn active" id="view-toggle-grid" data-view="grid">
                        <i data-lucide="grid-3x3"></i>
                        ê·¸ë¦¬ë“œ
                    </button>
                    <button class="institute-view-btn" id="view-toggle-list" data-view="list">
                        <i data-lucide="list"></i>
                        ë¦¬ìŠ¤íŠ¸
                    </button>
                </div>
                <button class="institute-btn institute-btn-primary" id="refresh-button">
                    <i data-lucide="refresh-cw"></i>
                    ìƒˆë¡œê³ ì¹¨
                </button>
            </div>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
        <div id="institute-management-container">
            <!-- ë¡œë”© ìƒíƒœ -->
            <div class="institute-loading" id="loading-spinner">
                <div class="institute-loading-spinner"></div>
                <span>í•™ë‹¹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
            </div>

            <!-- ê·¸ë¦¬ë“œ ë·° -->
            <div class="institute-grid" id="institute-grid" style="display: none;">
                <!-- í•™ë‹¹ ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>

            <!-- ë¦¬ìŠ¤íŠ¸ ë·° -->
            <div class="institute-list" id="institute-list" style="display: none;">
                <table class="institute-table">
                    <thead>
                        <tr>
                            <th>í•™ë‹¹ëª…</th>
                            <th>ìš´ì˜ê¸°ê´€</th>
                            <th>ì£¼ì†Œ</th>
                            <th>ë‹´ë‹¹ì</th>
                            <th>ë¬¸í™”ì¸í„´</th>
                            <th>ìƒíƒœ</th>
                            <th>ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody id="institute-table-body">
                        <!-- í•™ë‹¹ í–‰ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                    </tbody>
                </table>
            </div>

            <!-- ë¹ˆ ìƒíƒœ -->
            <div class="institute-empty-state" id="empty-state" style="display: none;">
                <i data-lucide="search" class="institute-empty-icon"></i>
                <h3>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”.</p>
            </div>
        </div>
    </div>

    <!-- í•™ë‹¹ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
    <div class="institute-modal-overlay" id="institute-detail-modal" style="display: none;">
        <div class="institute-modal">
            <div class="institute-modal-header">
                <h2 class="institute-modal-title">
                    <i data-lucide="building2"></i>
                    í•™ë‹¹ ìƒì„¸ ì •ë³´
                </h2>
                <button class="institute-modal-close" onclick="closeDetailModal()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="institute-modal-body" id="institute-detail-content">
                <!-- ìƒì„¸ ì •ë³´ê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
            <div class="institute-modal-footer">
                <button class="institute-btn institute-btn-primary" id="edit-institute-btn">
                    <i data-lucide="edit"></i>
                    ì •ë³´ ìˆ˜ì •
                </button>
                <button class="institute-btn institute-btn-secondary" onclick="closeDetailModal()">
                    ë‹«ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- ğŸ¯ Cë‹¨ê³„: ê°œì„ ëœ í•™ë‹¹ ì •ë³´ ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="institute-modal-overlay" id="institute-edit-modal" style="display: none;">
        <div class="institute-modal">
            <!-- ğŸ¯ Cë‹¨ê³„: ë¡œë”© ì˜¤ë²„ë ˆì´ -->
            <div class="institute-modal-loading" id="modal-loading" style="display: none;">
                <div class="institute-modal-loading-content">
                    <div class="institute-modal-loading-spinner"></div>
                    <div class="institute-modal-loading-text">ì²˜ë¦¬ ì¤‘...</div>
                </div>
            </div>

            <div class="institute-modal-header">
                <h2 class="institute-modal-title">
                    <i data-lucide="edit"></i>
                    í•™ë‹¹ ì •ë³´ ìˆ˜ì •
                </h2>
                <button class="institute-modal-close" onclick="closeEditModal()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="institute-modal-body">
                <form id="institute-edit-form">
                    <div class="institute-field-groups">
                        <!-- ê¸°ë³¸ ì •ë³´ ê·¸ë£¹ -->
                        <div class="institute-field-group">
                            <h3 class="institute-field-group-title">
                                <i data-lucide="info"></i>
                                ê¸°ë³¸ ì •ë³´
                            </h3>
                            <div class="institute-form-group">
                                <label class="institute-form-label required" for="edit-name-ko">í•™ë‹¹ëª…</label>
                                <input type="text" class="institute-form-input" id="edit-name-ko" name="name_ko" required>
                                <div class="institute-form-help">í•™ë‹¹ì˜ ê³µì‹ í•œêµ­ì–´ ëª…ì¹­</div>
                                <div class="institute-form-error" id="error-name-ko" style="display: none;"></div>
                            </div>
                            <div class="institute-form-group">
                                <label class="institute-form-label" for="edit-name-en">í•™ë‹¹ ì˜ë¬¸ëª…</label>
                                <input type="text" class="institute-form-input" id="edit-name-en" name="name_en">
                                <div class="institute-form-help">í•™ë‹¹ì˜ ì˜ë¬¸ ëª…ì¹­</div>
                                <div class="institute-form-error" id="error-name-en" style="display: none;"></div>
                            </div>
                            <div class="institute-form-group">
                                <label class="institute-form-label" for="edit-operating-organization">ìš´ì˜ ê¸°ê´€</label>
                                <input type="text" class="institute-form-input" id="edit-operating-organization" name="operating_organization">
                                <div class="institute-form-help">í•™ë‹¹ì„ ìš´ì˜í•˜ëŠ” ê¸°ê´€ëª…</div>
                                <div class="institute-form-error" id="error-operating-organization" style="display: none;"></div>
                            </div>
                            <div class="institute-form-group">
                                <label class="institute-form-label" for="edit-image-url">í•™ë‹¹ ì‚¬ì§„</label>
                                <div class="institute-image-upload" id="image-upload-area">
                                    <img id="image-preview" class="institute-image-preview" style="display: none;">
                                    <i data-lucide="upload" class="institute-image-upload-icon"></i>
                                    <div class="institute-image-upload-text">
                                        í´ë¦­í•˜ê±°ë‚˜ ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ
                                    </div>
                                </div>
                                <input type="file" id="image-file-input" accept="image/*" style="display: none;">
                                <input type="hidden" id="edit-image-url" name="image_url">
                                <div class="institute-form-error" id="error-image-url" style="display: none;"></div>
                            </div>
                        </div>

                        <!-- ì—°ë½ì²˜ ì •ë³´ ê·¸ë£¹ -->
                        <div class="institute-field-group">
                            <h3 class="institute-field-group-title">
                                <i data-lucide="phone"></i>
                                ì—°ë½ì²˜ ì •ë³´
                            </h3>
                            <div class="institute-form-group">
                                <label class="institute-form-label" for="edit-address">ì£¼ì†Œ</label>
                                <textarea class="institute-form-textarea" id="edit-address" name="address" rows="3"></textarea>
                                <div class="institute-form-help">í•™ë‹¹ì˜ ìƒì„¸ ì£¼ì†Œ</div>
                                <div class="institute-form-error" id="error-address" style="display: none;"></div>
                            </div>
                            <div class="institute-form-group">
                                <label class="institute-form-label" for="edit-phone">ëŒ€í‘œ ì—°ë½ì²˜</label>
                                <input type="tel" class="institute-form-input" id="edit-phone" name="phone">
                                <div class="institute-form-help">í•™ë‹¹ì˜ ëŒ€í‘œ ì „í™”ë²ˆí˜¸</div>
                                <div class="institute-form-error" id="error-phone" style="display: none;"></div>
                            </div>
                            <div class="institute-form-group">
                                <label class="institute-form-label" for="edit-website-sns">í™ˆí˜ì´ì§€ ë˜ëŠ” SNS</label>
                                <input type="url" class="institute-form-input" id="edit-website-sns" name="website_sns">
                                <div class="institute-form-help">í•™ë‹¹ì˜ ì›¹ì‚¬ì´íŠ¸ ë˜ëŠ” SNS ì£¼ì†Œ</div>
                                <div class="institute-form-error" id="error-website-sns" style="display: none;"></div>
                            </div>
                            <div class="institute-form-group">
                                <label class="institute-form-label" for="edit-manager-name">ë‹´ë‹¹ì ì„±ëª…</label>
                                <input type="text" class="institute-form-input" id="edit-manager-name" name="manager_name">
                                <div class="institute-form-help">í•™ë‹¹ ë‹´ë‹¹ìì˜ ì„±ëª…</div>
                                <div class="institute-form-error" id="error-manager-name" style="display: none;"></div>
                            </div>
                            <div class="institute-form-group">
                                <label class="institute-form-label" for="edit-manager-contact">ë‹´ë‹¹ì ì—°ë½ì²˜</label>
                                <input type="text" class="institute-form-input" id="edit-manager-contact" name="manager_contact">
                                <div class="institute-form-help">ë‹´ë‹¹ìì˜ ì „í™”ë²ˆí˜¸ ë˜ëŠ” ì´ë©”ì¼</div>
                                <div class="institute-form-error" id="error-manager-contact" style="display: none;"></div>
                            </div>
                        </div>

                        <!-- í”„ë¡œê·¸ë¨ ì •ë³´ ê·¸ë£¹ -->
                        <div class="institute-field-group">
                            <h3 class="institute-field-group-title">
                                <i data-lucide="graduation-cap"></i>
                                í”„ë¡œê·¸ë¨ ì •ë³´
                            </h3>
                            <div class="institute-form-group">
                                <label class="institute-form-label" for="edit-local-adaptation-staff">í˜„ì§€ ì ì‘ ì „ë‹´ ì¸ë ¥</label>
                                <textarea class="institute-form-textarea" id="edit-local-adaptation-staff" name="local_adaptation_staff" rows="4"></textarea>
                                <div class="institute-form-help">í˜„ì§€ ì ì‘ì„ ë„ì™€ì£¼ëŠ” ì „ë‹´ ì¸ë ¥ ì •ë³´</div>
                                <div class="institute-form-error" id="error-local-adaptation-staff" style="display: none;"></div>
                            </div>
                            <div class="institute-form-group">
                                <label class="institute-form-label" for="edit-cultural-program-plan">ë¬¸í™”ìˆ˜ì—… ìš´ì˜ ê³„íš</label>
                                <textarea class="institute-form-textarea" id="edit-cultural-program-plan" name="cultural_program_plan" rows="4"></textarea>
                                <div class="institute-form-help">ë¬¸í™” ìˆ˜ì—… ìš´ì˜ ê³„íš ë° ë‚´ìš©</div>
                                <div class="institute-form-error" id="error-cultural-program-plan" style="display: none;"></div>
                            </div>
                            <!-- ğŸ¯ Cë‹¨ê³„: í…Œì´ë¸” í˜•ì‹ ì…ë ¥ UI -->
                            <div class="institute-form-group">
                                <label class="institute-form-label" for="edit-desired-courses">í¬ë§ ê°œì„¤ ê°•ì¢Œ</label>
                                <div class="institute-table-input" id="desired-courses-table">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>ê°•ì¢Œëª…</th>
                                                <th>ë ˆë²¨</th>
                                                <th>ì‹œê°„</th>
                                                <th>ì˜ˆìƒ ì¸ì›</th>
                                                <th>ì‘ì—…</th>
                                            </tr>
                                        </thead>
                                        <tbody id="courses-table-body">
                                            <!-- ê°•ì¢Œ í–‰ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                                        </tbody>
                                    </table>
                                    <div class="institute-table-add-row">
                                        <button type="button" class="institute-table-add-btn" id="add-course-btn">
                                            <i data-lucide="plus"></i>
                                            ê°•ì¢Œ ì¶”ê°€
                                        </button>
                                    </div>
                                </div>
                                <input type="hidden" id="edit-desired-courses" name="desired_courses">
                                <div class="institute-form-help">ê°œì„¤í•˜ê³ ì í•˜ëŠ” ê°•ì¢Œ ëª©ë¡ (ìµœëŒ€ 10ê°œ)</div>
                                <div class="institute-form-error" id="error-desired-courses" style="display: none;"></div>
                            </div>
                        </div>

                        <!-- ì§€ì› ì •ë³´ ê·¸ë£¹ -->
                        <div class="institute-field-group">
                            <h3 class="institute-field-group-title">
                                <i data-lucide="help-circle"></i>
                                ì§€ì› ì •ë³´
                            </h3>
                            <div class="institute-form-group">
                                <label class="institute-form-label" for="edit-local-language-requirement">í˜„ì§€ì–´ êµ¬ì‚¬ í•„ìš” ìˆ˜ì¤€</label>
                                <textarea class="institute-form-textarea" id="edit-local-language-requirement" name="local_language_requirement" rows="4"></textarea>
                                <div class="institute-form-help">ë¬¸í™”ì¸í„´ì—ê²Œ ìš”êµ¬ë˜ëŠ” í˜„ì§€ì–´ ìˆ˜ì¤€</div>
                                <div class="institute-form-error" id="error-local-language-requirement" style="display: none;"></div>
                            </div>
                            <div class="institute-form-group">
                                <label class="institute-form-label" for="edit-institute-support">í•™ë‹¹ ì§€ì› ì‚¬í•­</label>
                                <textarea class="institute-form-textarea" id="edit-institute-support" name="institute_support" rows="4"></textarea>
                                <div class="institute-form-help">í•™ë‹¹ì—ì„œ ì œê³µí•˜ëŠ” ì§€ì› ì‚¬í•­</div>
                                <div class="institute-form-error" id="error-institute-support" style="display: none;"></div>
                            </div>
                            <div class="institute-form-group">
                                <label class="institute-form-label" for="edit-country-safety-info">íŒŒê²¬ êµ­ê°€ ì•ˆì „ ì •ë³´</label>
                                <input type="url" class="institute-form-input" id="edit-country-safety-info" name="country_safety_info">
                                <div class="institute-form-help">íŒŒê²¬ êµ­ê°€ì˜ ì•ˆì „ ê´€ë ¨ ì •ë³´ URL</div>
                                <div class="institute-form-error" id="error-country-safety-info" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="institute-modal-footer">
                <button class="institute-btn institute-btn-success" id="save-institute-btn">
                    <i data-lucide="save"></i>
                    ì €ì¥í•˜ê¸°
                </button>
                <button class="institute-btn institute-btn-secondary" onclick="closeEditModal()">
                    ì·¨ì†Œ
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <!-- 1. ê¸°ë³¸ ì„¤ì • ëª¨ë“ˆ (ì˜ì¡´ì„± ìˆœì„œ ì¤‘ìš”!) -->
    <script src="../js/config.js?v=4.4.0"></script>
    <script src="../js/auth.js?v=4.4.0"></script>
    <script src="../js/utils.js?v=4.4.0"></script>
    
    <!-- 2. Supabase ëª¨ë“ˆë“¤ -->
    <script src="../js/supabase/supabase-core.js?v=4.4.0"></script>
    <script src="../js/supabase/supabase-student.js?v=4.4.0"></script>
    <script src="../js/supabase/supabase-admin.js?v=4.4.0"></script>
    <script src="../js/supabase-client.js?v=4.4.0"></script>

    <!-- 3. Institute ì „ìš© ëª¨ë“ˆë“¤ (Bë‹¨ê³„) -->
    <script src="../js/institute/institute-utils.js?v=4.4.0"></script>
    <script src="../js/institute/institute-validation.js?v=4.4.0"></script>
    <script src="../js/institute/institute-api.js?v=4.4.0"></script>
    <script src="../js/institute/institute-core.js?v=4.4.0"></script>
    <script src="../js/institute/institute-ui.js?v=4.4.0"></script>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentInstitute = null;
        let currentView = 'grid';
        // ğŸ¯ Cë‹¨ê³„: ì‹¤ì‹œê°„ ê²€ì¦ ìƒíƒœ
        let validationState = {};
        // ğŸ¯ Cë‹¨ê³„: ê°•ì¢Œ í…Œì´ë¸” ë°ì´í„°
        let coursesData = [];

        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸ›ï¸ íŒŒê²¬í•™ë‹¹ ì •ë³´ ê´€ë¦¬ ì‹œìŠ¤í…œ v4.4.0 Cë‹¨ê³„ ì´ˆê¸°í™”');
            
            try {
                // Lucide ì•„ì´ì½˜ ì´ˆê¸°í™”
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }

                // ê´€ë¦¬ì ì¸ì¦ í™•ì¸
                checkAdminAuthentication();

                // Institute ëª¨ë“ˆë“¤ ì´ˆê¸°í™” ëŒ€ê¸°
                await initializeInstituteModules();

                // ğŸ¯ Cë‹¨ê³„: ì‹¤ì‹œê°„ ê²€ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
                initializeRealTimeValidation();

                // ğŸ¯ Cë‹¨ê³„: ê°•ì¢Œ í…Œì´ë¸” ì‹œìŠ¤í…œ ì´ˆê¸°í™”
                initializeCourseTableSystem();

                // UI ì´ë²¤íŠ¸ ì„¤ì •
                setupEventListeners();

                // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
                await loadInstituteData();

                console.log('âœ… Cë‹¨ê³„ íŒŒê²¬í•™ë‹¹ ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');

            } catch (error) {
                console.error('âŒ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                showError('ì‹œìŠ¤í…œ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        });

        /**
         * ğŸ” ê´€ë¦¬ì ì¸ì¦ í™•ì¸
         */
        function checkAdminAuthentication() {
            console.log('ğŸ” ê´€ë¦¬ì ì¸ì¦ í™•ì¸ ì¤‘...');
            
            const adminSession = localStorage.getItem('adminSession');
            if (!adminSession) {
                console.warn('âš ï¸ ê´€ë¦¬ì ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤');
                alert('ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = '../admin.html';
                return;
            }

            console.log('âœ… ê´€ë¦¬ì ì¸ì¦ í™•ì¸ë¨');
        }

        /**
         * ğŸš€ Institute ëª¨ë“ˆë“¤ ì´ˆê¸°í™”
         */
        async function initializeInstituteModules() {
            console.log('ğŸ”„ Institute ëª¨ë“ˆë“¤ ì´ˆê¸°í™” ì¤‘...');

            // ëª¨ë“ˆ ë¡œë“œ ëŒ€ê¸°
            await waitForModules([
                'InstituteUtils',
                'InstituteValidation', 
                'InstituteAPI',
                'InstituteCore',
                'InstituteUI'
            ]);

            // ìˆœì°¨ì  ì´ˆê¸°í™”
            const initResults = [];
            
            initResults.push(await window.InstituteUtils.initialize());
            initResults.push(await window.InstituteValidation.initialize());
            initResults.push(await window.InstituteAPI.initialize());
            initResults.push(await window.InstituteCore.initialize());
            initResults.push(await window.InstituteUI.initialize());

            const failedModules = initResults.filter(result => !result);
            if (failedModules.length > 0) {
                throw new Error(`${failedModules.length}ê°œ ëª¨ë“ˆ ì´ˆê¸°í™” ì‹¤íŒ¨`);
            }

            console.log('âœ… ëª¨ë“  Institute ëª¨ë“ˆ ì´ˆê¸°í™” ì™„ë£Œ');
        }

        /**
         * â° ëª¨ë“ˆ ë¡œë“œ ëŒ€ê¸°
         */
        async function waitForModules(moduleNames, timeout = 10000) {
            const startTime = Date.now();
            
            while (Date.now() - startTime < timeout) {
                const allLoaded = moduleNames.every(name => window[name]);
                if (allLoaded) {
                    console.log(`âœ… ëª¨ë“  ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ: ${moduleNames.join(', ')}`);
                    return;
                }
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            const missingModules = moduleNames.filter(name => !window[name]);
            throw new Error(`ëª¨ë“ˆ ë¡œë“œ íƒ€ì„ì•„ì›ƒ: ${missingModules.join(', ')}`);
        }

        /**
         * ğŸ¯ Cë‹¨ê³„: ì‹¤ì‹œê°„ ê²€ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
         */
        function initializeRealTimeValidation() {
            console.log('âš¡ ì‹¤ì‹œê°„ ê²€ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...');

            const form = document.getElementById('institute-edit-form');
            if (!form) return;

            // ëª¨ë“  ì…ë ¥ í•„ë“œì— ì‹¤ì‹œê°„ ê²€ì¦ ì´ë²¤íŠ¸ ì¶”ê°€
            const inputFields = form.querySelectorAll('input, textarea');
            inputFields.forEach(field => {
                // ì…ë ¥ ì‹œ ê²€ì¦
                field.addEventListener('input', debounce((e) => {
                    validateField(e.target);
                }, 300));

                // í¬ì»¤ìŠ¤ ì•„ì›ƒ ì‹œ ê²€ì¦
                field.addEventListener('blur', (e) => {
                    validateField(e.target);
                });
            });

            console.log('âœ… ì‹¤ì‹œê°„ ê²€ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
        }

        /**
         * ğŸ¯ Cë‹¨ê³„: ê°•ì¢Œ í…Œì´ë¸” ì‹œìŠ¤í…œ ì´ˆê¸°í™”
         */
        function initializeCourseTableSystem() {
            console.log('ğŸ“‹ ê°•ì¢Œ í…Œì´ë¸” ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...');

            const addBtn = document.getElementById('add-course-btn');
            if (addBtn) {
                addBtn.addEventListener('click', addCourseRow);
            }

            // ì´ˆê¸° ê°•ì¢Œ í–‰ ì¶”ê°€
            addCourseRow();

            console.log('âœ… ê°•ì¢Œ í…Œì´ë¸” ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
        }

        /**
         * ğŸ¯ Cë‹¨ê³„: ê°•ì¢Œ í–‰ ì¶”ê°€
         */
        function addCourseRow() {
            const tableBody = document.getElementById('courses-table-body');
            if (!tableBody) return;

            const rowIndex = coursesData.length;
            if (rowIndex >= 10) {
                showError('ìµœëŒ€ 10ê°œì˜ ê°•ì¢Œë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            const courseData = {
                name: '',
                level: '',
                time: '',
                participants: ''
            };
            coursesData.push(courseData);

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>
                    <input type="text" placeholder="ê°•ì¢Œëª…" value="${courseData.name}" 
                           oninput="updateCourseData(${rowIndex}, 'name', this.value)">
                </td>
                <td>
                    <input type="text" placeholder="ì´ˆê¸‰/ì¤‘ê¸‰/ê³ ê¸‰" value="${courseData.level}" 
                           oninput="updateCourseData(${rowIndex}, 'level', this.value)">
                </td>
                <td>
                    <input type="text" placeholder="ì£¼ 2íšŒ 90ë¶„" value="${courseData.time}" 
                           oninput="updateCourseData(${rowIndex}, 'time', this.value)">
                </td>
                <td>
                    <input type="number" placeholder="15" min="1" max="50" value="${courseData.participants}" 
                           oninput="updateCourseData(${rowIndex}, 'participants', this.value)">
                </td>
                <td>
                    <button type="button" class="institute-table-remove-btn" onclick="removeCourseRow(${rowIndex})">
                        <i data-lucide="trash-2"></i>
                    </button>
                </td>
            `;

            tableBody.appendChild(row);

            // ì•„ì´ì½˜ ì¬ìƒì„±
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            updateCoursesHiddenInput();
        }

        /**
         * ğŸ¯ Cë‹¨ê³„: ê°•ì¢Œ ë°ì´í„° ì—…ë°ì´íŠ¸
         */
        function updateCourseData(index, field, value) {
            if (coursesData[index]) {
                coursesData[index][field] = value;
                updateCoursesHiddenInput();
            }
        }

        /**
         * ğŸ¯ Cë‹¨ê³„: ê°•ì¢Œ í–‰ ì œê±°
         */
        function removeCourseRow(index) {
            coursesData.splice(index, 1);
            renderCourseTable();
            updateCoursesHiddenInput();
        }

        /**
         * ğŸ¯ Cë‹¨ê³„: ê°•ì¢Œ í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
         */
        function renderCourseTable() {
            const tableBody = document.getElementById('courses-table-body');
            if (!tableBody) return;

            tableBody.innerHTML = '';
            coursesData.forEach((course, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <input type="text" placeholder="ê°•ì¢Œëª…" value="${course.name}" 
                               oninput="updateCourseData(${index}, 'name', this.value)">
                    </td>
                    <td>
                        <input type="text" placeholder="ì´ˆê¸‰/ì¤‘ê¸‰/ê³ ê¸‰" value="${course.level}" 
                               oninput="updateCourseData(${index}, 'level', this.value)">
                    </td>
                    <td>
                        <input type="text" placeholder="ì£¼ 2íšŒ 90ë¶„" value="${course.time}" 
                               oninput="updateCourseData(${index}, 'time', this.value)">
                    </td>
                    <td>
                        <input type="number" placeholder="15" min="1" max="50" value="${course.participants}" 
                               oninput="updateCourseData(${index}, 'participants', this.value)">
                    </td>
                    <td>
                        <button type="button" class="institute-table-remove-btn" onclick="removeCourseRow(${index})">
                            <i data-lucide="trash-2"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // ì•„ì´ì½˜ ì¬ìƒì„±
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        /**
         * ğŸ¯ Cë‹¨ê³„: ê°•ì¢Œ ë°ì´í„° hidden input ì—…ë°ì´íŠ¸
         */
        function updateCoursesHiddenInput() {
            const hiddenInput = document.getElementById('edit-desired-courses');
            if (hiddenInput) {
                const validCourses = coursesData.filter(course => 
                    course.name.trim() || course.level.trim() || course.time.trim() || course.participants.trim()
                );
                hiddenInput.value = JSON.stringify(validCourses);
            }
        }

        /**
         * ğŸ¯ Cë‹¨ê³„: í•„ë“œ ì‹¤ì‹œê°„ ê²€ì¦
         */
        function validateField(field) {
            const fieldName = field.name || field.id.replace('edit-', '');
            const value = field.value.trim();
            const errorElement = document.getElementById(`error-${fieldName.replace(/_/g, '-')}`);
            
            if (!errorElement) return;

            let isValid = true;
            let errorMessage = '';

            // í•„ìˆ˜ í•„ë“œ ê²€ì¦
            if (field.hasAttribute('required') && !value) {
                isValid = false;
                errorMessage = 'ì´ í•„ë“œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.';
            }

            // íŠ¹ì • í•„ë“œë³„ ê²€ì¦
            switch (fieldName) {
                case 'name_ko':
                    if (value && value.length < 2) {
                        isValid = false;
                        errorMessage = 'í•™ë‹¹ëª…ì€ ìµœì†Œ 2ê¸€ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                    }
                    break;
                
                case 'phone':
                    if (value && !/^[\d\s\-\+\(\)]+$/.test(value)) {
                        isValid = false;
                        errorMessage = 'ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.';
                    }
                    break;
                
                case 'website_sns':
                case 'country_safety_info':
                    if (value && !isValidURL(value)) {
                        isValid = false;
                        errorMessage = 'ì˜¬ë°”ë¥¸ URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. (http:// ë˜ëŠ” https://ë¡œ ì‹œì‘)';
                    }
                    break;
            }

            // UI ì—…ë°ì´íŠ¸
            updateFieldValidationUI(field, errorElement, isValid, errorMessage);
            validationState[fieldName] = isValid;
        }

        /**
         * ğŸ¯ Cë‹¨ê³„: í•„ë“œ ê²€ì¦ UI ì—…ë°ì´íŠ¸
         */
        function updateFieldValidationUI(field, errorElement, isValid, errorMessage) {
            // í•„ë“œ í´ë˜ìŠ¤ ì—…ë°ì´íŠ¸
            field.classList.remove('error', 'success');
            
            if (isValid) {
                if (field.value.trim()) {
                    field.classList.add('success');
                }
                errorElement.style.display = 'none';
            } else {
                field.classList.add('error');
                errorElement.innerHTML = `<i data-lucide="alert-circle"></i> ${errorMessage}`;
                errorElement.style.display = 'flex';
                
                // ì•„ì´ì½˜ ì¬ìƒì„±
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }
        }

        /**
         * ğŸ¯ Cë‹¨ê³„: URL ìœ íš¨ì„± ê²€ì‚¬
         */
        function isValidURL(string) {
            try {
                const url = new URL(string);
                return url.protocol === 'http:' || url.protocol === 'https:';
            } catch (_) {
                return false;
            }
        }

        /**
         * ğŸ¯ Cë‹¨ê³„: ë””ë°”ìš´ìŠ¤ ìœ í‹¸ë¦¬í‹°
         */
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        /**
         * ğŸ“¡ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
         */
        function setupEventListeners() {
            // ê²€ìƒ‰ ê¸°ëŠ¥
            const searchInput = document.getElementById('institute-search');
            if (searchInput) {
                searchInput.addEventListener('input', window.Utils.debounce(handleSearch, 300));
            }

            // ë·° ì „í™˜ ë²„íŠ¼
            document.getElementById('view-toggle-grid')?.addEventListener('click', () => switchView('grid'));
            document.getElementById('view-toggle-list')?.addEventListener('click', () => switchView('list'));

            // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼
            document.getElementById('refresh-button')?.addEventListener('click', refreshData);

            // ìˆ˜ì • ëª¨ë‹¬ ì €ì¥ ë²„íŠ¼
            document.getElementById('save-institute-btn')?.addEventListener('click', saveInstituteData);

            // ì´ë¯¸ì§€ ì—…ë¡œë“œ
            setupImageUpload();

            // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeAllModals();
                }
            });

            console.log('ğŸ“¡ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
        }

        /**
         * ğŸ“Š ì´ˆê¸° ë°ì´í„° ë¡œë“œ
         */
        async function loadInstituteData() {
            try {
                showLoading(true);
                
                // InstituteCoreë¥¼ í†µí•´ ë°ì´í„° ë¡œë“œ
                await window.InstituteCore.loadBasicData();
                
                // UI ë Œë”ë§
                await renderInstitutes();
                
                // í†µê³„ ì—…ë°ì´íŠ¸
                updateStatistics();
                
                showLoading(false);
                
            } catch (error) {
                console.error('âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                showError('í•™ë‹¹ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                showLoading(false);
            }
        }

        /**
         * ğŸ¨ í•™ë‹¹ ëª©ë¡ ë Œë”ë§
         */
        async function renderInstitutes() {
            const institutes = window.InstituteCore.getAllInstitutes();
            
            if (institutes.length === 0) {
                showEmptyState();
                return;
            }

            if (currentView === 'grid') {
                renderGridView(institutes);
            } else {
                renderListView(institutes);
            }

            // ì•„ì´ì½˜ ë‹¤ì‹œ ìƒì„±
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        /**
         * ğŸ”² ê·¸ë¦¬ë“œ ë·° ë Œë”ë§
         */
        function renderGridView(institutes) {
            const grid = document.getElementById('institute-grid');
            const list = document.getElementById('institute-list');
            
            if (!grid) return;

            grid.innerHTML = institutes.map(institute => createInstituteCard(institute)).join('');
            grid.style.display = 'grid';
            if (list) list.style.display = 'none';
        }

        /**
         * ğŸ“„ ë¦¬ìŠ¤íŠ¸ ë·° ë Œë”ë§  
         */
        function renderListView(institutes) {
            const grid = document.getElementById('institute-grid');
            const list = document.getElementById('institute-list');
            const tableBody = document.getElementById('institute-table-body');
            
            if (!tableBody) return;

            tableBody.innerHTML = institutes.map(institute => createInstituteRow(institute)).join('');
            if (list) list.style.display = 'block';
            if (grid) grid.style.display = 'none';
        }

        /**
         * ğŸ—ï¸ í•™ë‹¹ ì¹´ë“œ ìƒì„±
         */
        function createInstituteCard(institute) {
            const displayData = window.InstituteUtils.createDisplayData(institute);
            const completionStatus = getCompletionStatus(institute);
            
            return `
                <div class="institute-card institute-fade-in" data-id="${institute.id}">
                    <div class="institute-card-header">
                        <h3 class="institute-card-name">${institute.name_ko}</h3>
                        ${institute.name_en ? `<p class="institute-card-name-en">${institute.name_en}</p>` : ''}
                        <span class="institute-status-badge ${completionStatus.class}">
                            ${completionStatus.label}
                        </span>
                    </div>
                    
                    <div class="institute-card-body">
                        <div class="institute-info-row">
                            <i data-lucide="building" class="institute-info-icon"></i>
                            <div class="institute-info-content">
                                <div class="institute-info-label">ìš´ì˜ê¸°ê´€</div>
                                <div class="institute-info-value ${!institute.operating_organization ? 'placeholder' : ''}">
                                    ${institute.operating_organization || 'ë¯¸ì„¤ì •'}
                                </div>
                            </div>
                        </div>
                        
                        <div class="institute-info-row">
                            <i data-lucide="map-pin" class="institute-info-icon"></i>
                            <div class="institute-info-content">
                                <div class="institute-info-label">ì£¼ì†Œ</div>
                                <div class="institute-info-value long-text ${!institute.address ? 'placeholder' : ''}">
                                    ${window.InstituteUtils.truncateText(institute.address || 'ì£¼ì†Œ ë¯¸ì„¤ì •', 60)}
                                </div>
                            </div>
                        </div>
                        
                        <div class="institute-info-row">
                            <i data-lucide="user" class="institute-info-icon"></i>
                            <div class="institute-info-content">
                                <div class="institute-info-label">ë‹´ë‹¹ì</div>
                                <div class="institute-info-value ${!institute.manager_name ? 'placeholder' : ''}">
                                    ${institute.manager_name || 'ë¯¸ì§€ì •'}
                                </div>
                            </div>
                        </div>
                        
                        ${getInternSection(institute)}
                    </div>
                    
                    <div class="institute-card-footer">
                        <div class="institute-last-updated">
                            ìµœì¢… ìˆ˜ì •: ${displayData.updated_at_relative || 'ì •ë³´ ì—†ìŒ'}
                        </div>
                        <div class="institute-card-actions">
                            <button class="institute-btn institute-btn-sm institute-btn-primary" 
                                    onclick="showInstituteDetails('${institute.id}')">
                                <i data-lucide="eye"></i>
                                ìƒì„¸ë³´ê¸°
                            </button>
                            <button class="institute-btn institute-btn-sm institute-btn-secondary" 
                                    onclick="editInstitute('${institute.id}')">
                                <i data-lucide="edit"></i>
                                ìˆ˜ì •
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * ğŸ“‹ í•™ë‹¹ í–‰ ìƒì„± (ë¦¬ìŠ¤íŠ¸ ë·°)
         */
        function createInstituteRow(institute) {
            const completionStatus = getCompletionStatus(institute);
            const internCount = 0; // TODO: ë¬¸í™”ì¸í„´ ìˆ˜ ê³„ì‚°
            
            return `
                <tr data-id="${institute.id}">
                    <td>
                        <div class="institute-table-name">${institute.name_ko}</div>
                        ${institute.name_en ? `<div class="institute-table-name-en">${institute.name_en}</div>` : ''}
                    </td>
                    <td>${institute.operating_organization || '-'}</td>
                    <td>${window.InstituteUtils.truncateText(institute.address || '-', 40)}</td>
                    <td>${institute.manager_name || '-'}</td>
                    <td>${internCount}ëª…</td>
                    <td>
                        <span class="institute-status-badge ${completionStatus.class}">
                            ${completionStatus.label}
                        </span>
                    </td>
                    <td>
                        <div class="institute-table-actions">
                            <button class="institute-btn institute-btn-sm institute-btn-primary" 
                                    onclick="showInstituteDetails('${institute.id}')">
                                <i data-lucide="eye"></i>
                            </button>
                            <button class="institute-btn institute-btn-sm institute-btn-secondary" 
                                    onclick="editInstitute('${institute.id}')">
                                <i data-lucide="edit"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }

        /**
         * ğŸ“Š ì™„ì„±ë„ ìƒíƒœ í™•ì¸
         */
        function getCompletionStatus(institute) {
            const requiredFields = ['name_ko', 'operating_organization', 'address', 'manager_name'];
            const completedFields = requiredFields.filter(field => 
                institute[field] && institute[field].toString().trim() !== ''
            );
            
            const completion = completedFields.length / requiredFields.length;
            
            if (completion >= 0.8) {
                return { class: 'complete', label: 'ì™„ë£Œ' };
            } else if (completion >= 0.5) {
                return { class: 'pending', label: 'ì§„í–‰ì¤‘' };
            } else {
                return { class: 'incomplete', label: 'ë¯¸ì™„ì„±' };
            }
        }

        /**
         * ğŸ‘¥ ë¬¸í™”ì¸í„´ ì„¹ì…˜ ìƒì„±
         */
        function getInternSection(institute) {
            // TODO: ì‹¤ì œ ë¬¸í™”ì¸í„´ ë°ì´í„° ì—°ë™
            return `
                <div class="institute-interns-section">
                    <div class="institute-interns-title">
                        <i data-lucide="users"></i>
                        ë°°ì •ëœ ë¬¸í™”ì¸í„´ (0ëª…)
                    </div>
                    <div class="institute-info-value placeholder">
                        ë°°ì •ëœ ë¬¸í™”ì¸í„´ì´ ì—†ìŠµë‹ˆë‹¤
                    </div>
                </div>
            `;
        }

        /**
         * ğŸ” ê²€ìƒ‰ ì²˜ë¦¬
         */
        async function handleSearch() {
            const keyword = document.getElementById('institute-search')?.value?.trim();
            
            if (!keyword) {
                await renderInstitutes();
                return;
            }

            try {
                const results = await window.InstituteCore.searchInstitutes({ keyword });
                
                if (currentView === 'grid') {
                    renderGridView(results);
                } else {
                    renderListView(results);
                }

                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
                
            } catch (error) {
                console.error('âŒ ê²€ìƒ‰ ì‹¤íŒ¨:', error);
                showError('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        /**
         * ğŸ”„ ë·° ì „í™˜
         */
        function switchView(view) {
            currentView = view;
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.institute-view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`view-toggle-${view}`)?.classList.add('active');
            
            // ë·° ë Œë”ë§
            renderInstitutes();
        }

        /**
         * ğŸ‘ï¸ í•™ë‹¹ ìƒì„¸ ì •ë³´ í‘œì‹œ
         */
        async function showInstituteDetails(instituteId) {
            try {
                showLoading(true);
                
                const institute = await window.InstituteCore.getInstituteDetails(instituteId);
                if (!institute) {
                    throw new Error('í•™ë‹¹ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }

                renderDetailModal(institute);
                showModal('institute-detail-modal');
                
                // ìˆ˜ì • ë²„íŠ¼ ì´ë²¤íŠ¸
                document.getElementById('edit-institute-btn').onclick = () => {
                    closeDetailModal();
                    editInstitute(instituteId);
                };
                
                showLoading(false);
                
            } catch (error) {
                console.error('âŒ ìƒì„¸ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                showError('í•™ë‹¹ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                showLoading(false);
            }
        }

        /**
         * ğŸ“ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ ë Œë”ë§
         */
        function renderDetailModal(institute) {
            const content = document.getElementById('institute-detail-content');
            if (!content) return;

            const displayData = window.InstituteUtils.createDisplayData(institute);
            const groupedFields = displayData.grouped_fields;

            let modalHTML = '';

            // í•™ë‹¹ ì´ë¯¸ì§€
            if (institute.image_url) {
                modalHTML += `
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <img src="${institute.image_url}" alt="${institute.name_ko}" 
                             style="max-width: 100%; max-height: 300px; border-radius: 0.5rem; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    </div>
                `;
            }

            // í•„ë“œ ê·¸ë£¹ë³„ë¡œ ë Œë”ë§
            Object.entries(groupedFields).forEach(([groupKey, groupData]) => {
                if (groupData.fields.length === 0) return;

                modalHTML += `
                    <div class="institute-field-group" style="margin-bottom: 2rem;">
                        <h3 class="institute-field-group-title">
                            <i data-lucide="${groupData.icon}"></i>
                            ${groupData.name}
                        </h3>
                `;

                groupData.fields.forEach(field => {
                    const value = field.value || 'ì •ë³´ ì—†ìŒ';
                    const isLongText = typeof value === 'string' && value.length > 100;
                    
                    modalHTML += `
                        <div class="institute-info-row" style="margin-bottom: 1rem;">
                            <i data-lucide="${field.icon}" class="institute-info-icon"></i>
                            <div class="institute-info-content">
                                <div class="institute-info-label">${field.label}</div>
                                <div class="institute-info-value ${!field.value ? 'placeholder' : ''}" 
                                     ${isLongText ? 'style="white-space: pre-wrap; line-height: 1.6;"' : ''}>
                                    ${field.name === 'website_sns' && field.value ? 
                                        `<a href="${field.value}" target="_blank" rel="noopener">${field.value}</a>` : 
                                        value}
                                </div>
                            </div>
                        </div>
                    `;
                });

                modalHTML += '</div>';
            });

            content.innerHTML = modalHTML;

            // ì•„ì´ì½˜ ë‹¤ì‹œ ìƒì„±
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        /**
         * âœï¸ í•™ë‹¹ ì •ë³´ ìˆ˜ì •
         */
        async function editInstitute(instituteId) {
            try {
                currentInstitute = await window.InstituteCore.getInstituteDetails(instituteId);
                if (!currentInstitute) {
                    throw new Error('í•™ë‹¹ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }

                populateEditForm(currentInstitute);
                showModal('institute-edit-modal');
                
            } catch (error) {
                console.error('âŒ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸° ì‹¤íŒ¨:', error);
                showError('í•™ë‹¹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        /**
         * ğŸ“ ìˆ˜ì • í¼ ë°ì´í„° ì±„ìš°ê¸°
         */
        function populateEditForm(institute) {
            const formFields = window.InstituteUtils.getAllFields();
            
            formFields.forEach(fieldName => {
                const element = document.getElementById(`edit-${fieldName.replace(/_/g, '-')}`);
                if (element && institute[fieldName]) {
                    element.value = institute[fieldName];
                }
            });

            // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
            if (institute.image_url) {
                const preview = document.getElementById('image-preview');
                if (preview) {
                    preview.src = institute.image_url;
                    preview.style.display = 'block';
                }
            }

            // ğŸ¯ Cë‹¨ê³„: ê°•ì¢Œ ë°ì´í„° ë¡œë“œ
            loadCoursesData(institute.desired_courses);
        }

        /**
         * ğŸ¯ Cë‹¨ê³„: ê°•ì¢Œ ë°ì´í„° ë¡œë“œ
         */
        function loadCoursesData(coursesJson) {
            coursesData = [];
            
            if (coursesJson) {
                try {
                    const courses = JSON.parse(coursesJson);
                    if (Array.isArray(courses)) {
                        coursesData = courses;
                    }
                } catch (error) {
                    console.warn('ê°•ì¢Œ ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:', error);
                }
            }

            // ìµœì†Œ 1ê°œ í–‰ì€ ë³´ì¥
            if (coursesData.length === 0) {
                coursesData.push({
                    name: '',
                    level: '',
                    time: '',
                    participants: ''
                });
            }

            renderCourseTable();
            updateCoursesHiddenInput();
        }

        /**
         * ğŸ’¾ í•™ë‹¹ ì •ë³´ ì €ì¥
         */
        async function saveInstituteData() {
            if (!currentInstitute) return;

            try {
                // ğŸ¯ Cë‹¨ê³„: ëª¨ë“  í•„ë“œ ê²€ì¦
                if (!validateAllFields()) {
                    showError('ì…ë ¥ ë°ì´í„°ì— ì˜¤ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤. ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í‘œì‹œëœ í•„ë“œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    return;
                }

                showModalLoading(true, 'ì €ì¥ ì¤‘...');

                const formData = new FormData(document.getElementById('institute-edit-form'));
                const updateData = {};
                
                for (const [key, value] of formData.entries()) {
                    if (value.trim()) {
                        updateData[key] = value.trim();
                    }
                }

                // ì´ë¯¸ì§€ URL ì¶”ê°€
                const imageUrl = document.getElementById('edit-image-url')?.value;
                if (imageUrl) {
                    updateData.image_url = imageUrl;
                }

                // ìœ íš¨ì„± ê²€ì‚¬
                const validation = window.InstituteValidation.validateInstituteData(updateData);
                if (!validation.isValid) {
                    throw new Error('ì…ë ¥ ë°ì´í„°ì— ì˜¤ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤: ' + validation.errors.join(', '));
                }

                // ë°ì´í„° ì—…ë°ì´íŠ¸
                const success = await window.InstituteCore.updateInstituteInfo(currentInstitute.id, updateData);
                
                if (success) {
                    showSuccess('í•™ë‹¹ ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    showModalLoading(false);
                    closeEditModal();
                    await refreshData();
                } else {
                    throw new Error('ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error('âŒ ì €ì¥ ì‹¤íŒ¨:', error);
                showError('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                showModalLoading(false);
            }
        }

        /**
         * ğŸ¯ Cë‹¨ê³„: ëª¨ë“  í•„ë“œ ê²€ì¦
         */
        function validateAllFields() {
            const form = document.getElementById('institute-edit-form');
            const inputFields = form.querySelectorAll('input, textarea');
            
            let isAllValid = true;
            inputFields.forEach(field => {
                validateField(field);
                const fieldName = field.name || field.id.replace('edit-', '');
                if (validationState[fieldName] === false) {
                    isAllValid = false;
                }
            });

            return isAllValid;
        }

        /**
         * ğŸ“¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„¤ì •
         */
        function setupImageUpload() {
            const uploadArea = document.getElementById('image-upload-area');
            const fileInput = document.getElementById('image-file-input');
            const preview = document.getElementById('image-preview');
            const hiddenInput = document.getElementById('edit-image-url');

            if (!uploadArea || !fileInput) return;

            // í´ë¦­ìœ¼ë¡œ íŒŒì¼ ì„ íƒ
            uploadArea.addEventListener('click', () => fileInput.click());

            // íŒŒì¼ ì„ íƒ ì²˜ë¦¬
            fileInput.addEventListener('change', handleImageSelect);

            // ë“œë˜ê·¸ ì•¤ ë“œë¡­
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleImageFile(files[0]);
                }
            });

            async function handleImageSelect() {
                const file = fileInput.files[0];
                if (file) {
                    await handleImageFile(file);
                }
            }

            async function handleImageFile(file) {
                if (!currentInstitute) return;

                try {
                    // íŒŒì¼ ê²€ì¦
                    if (!file.type.startsWith('image/')) {
                        throw new Error('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    }

                    if (file.size > 5 * 1024 * 1024) {
                        throw new Error('íŒŒì¼ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                    }

                    showModalLoading(true, 'ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘...');

                    // ì´ë¯¸ì§€ ì—…ë¡œë“œ
                    const imageUrl = await window.InstituteAPI.uploadInstituteImage(file, currentInstitute.id);
                    
                    if (imageUrl) {
                        preview.src = imageUrl;
                        preview.style.display = 'block';
                        hiddenInput.value = imageUrl;
                        showSuccess('ì´ë¯¸ì§€ê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    } else {
                        throw new Error('ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }

                    showModalLoading(false);

                } catch (error) {
                    console.error('âŒ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
                    showError(error.message);
                    showModalLoading(false);
                }
            }
        }

        /**
         * ğŸ“Š í†µê³„ ì—…ë°ì´íŠ¸
         */
        function updateStatistics() {
            const institutes = window.InstituteCore.getAllInstitutes();
            
            let assignedInterns = 0;
            let completeInstitutes = 0;
            let incompleteInstitutes = 0;

            institutes.forEach(institute => {
                // TODO: ì‹¤ì œ ë¬¸í™”ì¸í„´ ìˆ˜ ê³„ì‚°
                // assignedInterns += institute.interns ? institute.interns.length : 0;
                
                const status = getCompletionStatus(institute);
                if (status.class === 'complete') {
                    completeInstitutes++;
                } else {
                    incompleteInstitutes++;
                }
            });

            // í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('total-institutes').textContent = institutes.length;
            document.getElementById('assigned-interns').textContent = assignedInterns;
            document.getElementById('complete-institutes').textContent = completeInstitutes;
            document.getElementById('incomplete-institutes').textContent = incompleteInstitutes;
        }

        /**
         * ğŸ”„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
         */
        async function refreshData() {
            console.log('ğŸ”„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨...');
            
            try {
                // ìºì‹œ í´ë¦¬ì–´
                window.InstituteCore.clearCache();
                
                // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
                await loadInstituteData();
                
                showSuccess('ë°ì´í„°ê°€ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
                
            } catch (error) {
                console.error('âŒ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
                showError('ë°ì´í„° ìƒˆë¡œê³ ì¹¨ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        /**
         * ğŸšª ëª¨ë‹¬ ê´€ë¦¬
         */
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                
                // ğŸ¯ Cë‹¨ê³„: ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
                modal.classList.add('institute-fade-in');
            }
        }

        function closeDetailModal() {
            document.getElementById('institute-detail-modal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function closeEditModal() {
            document.getElementById('institute-edit-modal').style.display = 'none';
            document.body.style.overflow = 'auto';
            currentInstitute = null;
            
            // ğŸ¯ Cë‹¨ê³„: ê²€ì¦ ìƒíƒœ ì´ˆê¸°í™”
            validationState = {};
            coursesData = [];
        }

        function closeAllModals() {
            closeDetailModal();
            closeEditModal();
        }

        /**
         * ğŸ¯ Cë‹¨ê³„: ëª¨ë‹¬ ë¡œë”© ìƒíƒœ ê´€ë¦¬
         */
        function showModalLoading(show, message = 'ì²˜ë¦¬ ì¤‘...') {
            const loading = document.getElementById('modal-loading');
            const loadingText = document.querySelector('.institute-modal-loading-text');
            
            if (loading) {
                loading.style.display = show ? 'flex' : 'none';
                if (loadingText && message) {
                    loadingText.textContent = message;
                }
            }
        }

        /**
         * ğŸ¨ UI ìƒíƒœ ê´€ë¦¬
         */
        function showLoading(show) {
            const spinner = document.getElementById('loading-spinner');
            const container = document.getElementById('institute-management-container');
            
            if (spinner) {
                spinner.style.display = show ? 'flex' : 'none';
            }
        }

        function showEmptyState() {
            document.getElementById('institute-grid').style.display = 'none';
            document.getElementById('institute-list').style.display = 'none';
            document.getElementById('empty-state').style.display = 'block';
        }

        function showError(message) {
            if (window.Utils && window.Utils.showToast) {
                window.Utils.showToast(message, 'error');
            } else {
                alert('ì˜¤ë¥˜: ' + message);
            }
        }

        function showSuccess(message) {
            if (window.Utils && window.Utils.showToast) {
                window.Utils.showToast(message, 'success');
            } else {
                console.log('âœ… ' + message);
            }
        }

        /**
         * ğŸ”™ ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
         */
        function goBackToDashboard() {
            console.log('ğŸ”™ ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°');
            window.location.href = '../admin.html';
        }

        // ğŸ¯ Cë‹¨ê³„: ê°œë°œì ë””ë²„ê·¸ í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ í™•ì¥
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                e.preventDefault();
                console.log('ğŸ› ï¸ Cë‹¨ê³„ ë””ë²„ê·¸ ì •ë³´');
                console.log('ëª¨ë“ˆ ìƒíƒœ:', {
                    InstituteUtils: window.InstituteUtils?.getUtilsStatus(),
                    InstituteValidation: window.InstituteValidation?.getValidationStatus(),
                    InstituteAPI: window.InstituteAPI?.getAPIStatus(),
                    InstituteCore: window.InstituteCore?.getModuleStatus(),
                    InstituteUI: window.InstituteUI?.getUIStatus()
                });
                console.log('í˜„ì¬ ë·°:', currentView);
                console.log('í˜„ì¬ í¸ì§‘ ì¤‘ì¸ í•™ë‹¹:', currentInstitute);
                console.log('ê²€ì¦ ìƒíƒœ:', validationState);
                console.log('ê°•ì¢Œ ë°ì´í„°:', coursesData);
            }
        });

        console.log('ğŸ›ï¸ íŒŒí¸í•™ë‹¹ ì •ë³´ ê´€ë¦¬ ì‹œìŠ¤í…œ v4.4.0 Cë‹¨ê³„ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html>