<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒŒê²¬ í•™ë‹¹ ì •ë³´ - ì„¸ì¢…í•™ë‹¹ ë¬¸í™”ì¸í„´ ì§€ì› ì‹œìŠ¤í…œ</title>
    
    <!-- CSS Files - Updated to v4.0.0 -->
    <link rel="stylesheet" href="../css/main.css?v=4.0.0">
    <link rel="stylesheet" href="../css/student.css?v=4.0.0">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Supabase JavaScript Client - Updated CDN URL -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <style>
        .institute-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem;
        }

        .institute-header {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .header-subtitle {
            font-size: 1.2rem;
            color: #718096;
            margin-bottom: 1rem;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: #e2e8f0;
            color: #2d3748;
        }

        .institute-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .institute-card {
            background: white;
            border-radius: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .card-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .institute-logo {
            width: 4rem;
            height: 4rem;
            background: rgba(255,255,255,0.2);
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
        }

        .institute-name-ko {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .institute-name-en {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .institute-location {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 1.1rem;
        }

        .card-body {
            padding: 2rem;
        }

        .info-section {
            margin-bottom: 2rem;
        }

        .info-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .info-item {
            background: #f7fafc;
            border-radius: 0.5rem;
            padding: 1.5rem;
            border-left: 4px solid #667eea;
        }

        .info-label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-value {
            color: #2d3748;
            line-height: 1.6;
        }

        .contact-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .contact-link:hover {
            color: #5a67d8;
            text-decoration: underline;
        }

        .programs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .program-card {
            background: #f7fafc;
            border-radius: 1rem;
            padding: 1.5rem;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .program-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .program-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .program-details {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .program-details li {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            color: #4a5568;
        }

        .program-details li i {
            color: #667eea;
            margin-top: 0.2rem;
            flex-shrink: 0;
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 4rem;
        }

        .spinner {
            width: 3rem;
            height: 3rem;
            border: 3px solid #e2e8f0;
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: #fed7d7;
            color: #c53030;
            border: 2px solid #fc8181;
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
            margin: 2rem 0;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #718096;
        }

        .empty-state i {
            width: 4rem;
            height: 4rem;
            margin-bottom: 1rem;
            color: #cbd5e0;
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .institute-container {
                padding: 1rem;
            }

            .institute-header {
                padding: 1.5rem;
            }

            .header-title {
                font-size: 2rem;
            }

            .institute-name-ko {
                font-size: 1.5rem;
            }

            .card-body {
                padding: 1.5rem;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .programs-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="institute-container">
        <!-- í—¤ë” ì„¹ì…˜ -->
        <div class="institute-header">
            <h1 class="header-title">íŒŒê²¬ í•™ë‹¹ ì •ë³´</h1>
            <p class="header-subtitle">ë°°ì •ë°›ì€ ì„¸ì¢…í•™ë‹¹ì˜ ìƒì„¸ ì •ë³´</p>
            <a href="dashboard.html" class="back-button">
                <i data-lucide="arrow-left"></i>
                ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
            </a>
        </div>

        <div class="institute-content">
            <!-- ë¡œë”© ìƒíƒœ -->
            <div id="loadingSpinner" class="loading-spinner">
                <div class="spinner"></div>
            </div>

            <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
            <div id="errorMessage" class="error-message" style="display: none;">
                <i data-lucide="alert-circle"></i>
                ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
            </div>

            <!-- ë¹ˆ ìƒíƒœ -->
            <div id="emptyState" class="empty-state" style="display: none;">
                <i data-lucide="building"></i>
                <h3>ë“±ë¡ëœ í•™ë‹¹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì—¬ í•™ë‹¹ ì •ë³´ë¥¼ ë“±ë¡ë°›ìœ¼ì„¸ìš”.</p>
            </div>

            <!-- í•™ë‹¹ ì •ë³´ ì¹´ë“œ -->
            <div id="instituteCard" class="institute-card" style="display: none;">
                <!-- ì¹´ë“œ í—¤ë” -->
                <div class="card-header">
                    <div class="institute-logo">
                        <i data-lucide="building"></i>
                    </div>
                    <h2 class="institute-name-ko" id="instituteNameKo">-</h2>
                    <p class="institute-name-en" id="instituteNameEn">-</p>
                    <div class="institute-location">
                        <i data-lucide="map-pin"></i>
                        <span id="instituteLocation">-</span>
                    </div>
                </div>

                <!-- ì¹´ë“œ ë³¸ë¬¸ -->
                <div class="card-body">
                    <!-- ê¸°ë³¸ ì •ë³´ -->
                    <div class="info-section">
                        <h3 class="info-title">
                            <i data-lucide="info"></i>
                            ê¸°ë³¸ ì •ë³´
                        </h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">
                                    <i data-lucide="building-2"></i>
                                    ìš´ì˜ê¸°ê´€
                                </div>
                                <div class="info-value" id="instituteOperator">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">
                                    <i data-lucide="map-pin"></i>
                                    ì£¼ì†Œ
                                </div>
                                <div class="info-value" id="instituteAddress">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">
                                    <i data-lucide="phone"></i>
                                    ì—°ë½ì²˜
                                </div>
                                <div class="info-value" id="institutePhone">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">
                                    <i data-lucide="instagram"></i>
                                    SNS
                                </div>
                                <div class="info-value" id="instituteSns">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- ë‹´ë‹¹ì ì •ë³´ -->
                    <div class="info-section">
                        <h3 class="info-title">
                            <i data-lucide="users"></i>
                            ë‹´ë‹¹ì ì •ë³´
                        </h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">
                                    <i data-lucide="user"></i>
                                    ì£¼ë‹´ë‹¹ì
                                </div>
                                <div class="info-value" id="contactPerson">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">
                                    <i data-lucide="mail"></i>
                                    ì´ë©”ì¼
                                </div>
                                <div class="info-value" id="contactEmail">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">
                                    <i data-lucide="user-check"></i>
                                    í˜„ì§€ ë‹´ë‹¹ì
                                </div>
                                <div class="info-value" id="localCoordinator">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- ê·¼ë¬´ ì •ë³´ -->
                    <div class="info-section">
                        <h3 class="info-title">
                            <i data-lucide="clock"></i>
                            ê·¼ë¬´ ë° í™œë™ ì •ë³´
                        </h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">
                                    <i data-lucide="calendar"></i>
                                    ê·¼ë¬´ ì‹œê°„
                                </div>
                                <div class="info-value" id="workingHours">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">
                                    <i data-lucide="book-open"></i>
                                    ë¬¸í™”ê°•ì¢Œ ì‹œê°„
                                </div>
                                <div class="info-value" id="culturalHours">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">
                                    <i data-lucide="schedule"></i>
                                    ìˆ˜ì—… ì¼ì •
                                </div>
                                <div class="info-value" id="classSchedule">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">
                                    <i data-lucide="users-2"></i>
                                    ë°˜ë‹¹ ìµœëŒ€ ì¸ì›
                                </div>
                                <div class="info-value" id="maxStudents">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- ê¸°íƒ€ ì •ë³´ -->
                    <div class="info-section">
                        <h3 class="info-title">
                            <i data-lucide="settings"></i>
                            ì¶”ê°€ ì •ë³´
                        </h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">
                                    <i data-lucide="globe"></i>
                                    í˜„ì§€ì–´ ìš”êµ¬ìˆ˜ì¤€
                                </div>
                                <div class="info-value" id="languageRequirement">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">
                                    <i data-lucide="gift"></i>
                                    í•™ë‹¹ ì§€ì›ì‚¬í•­
                                </div>
                                <div class="info-value" id="supportProvided">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- ë¬¸í™” í”„ë¡œê·¸ë¨ -->
                    <div class="info-section">
                        <h3 class="info-title">
                            <i data-lucide="sparkles"></i>
                            ë¬¸í™” í”„ë¡œê·¸ë¨
                        </h3>
                        <div class="programs-grid" id="programsGrid">
                            <!-- í”„ë¡œê·¸ë¨ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files - Updated to v4.0 Module System -->
    <!-- í•µì‹¬ ì„¤ì • íŒŒì¼ë“¤ -->
    <script src="../js/config.js?v=4.0.0"></script>
    <script src="../js/supabase-client.js?v=4.0.0"></script>
    <script src="../js/utils.js?v=4.0.0"></script>
    <script src="../js/auth.js?v=4.0.0"></script>
    
    <!-- í•„ìš”í•œ í•™ìƒ ëª¨ë“ˆë“¤ (ì˜ì¡´ì„± ìˆœì„œëŒ€ë¡œ) -->
    <script src="../js/student/api-helper.js?v=4.0.0"></script>
    <script src="../js/student/notification-system.js?v=4.0.0"></script>
    <script src="../js/student/institute-info.js?v=4.0.0"></script>
    
    <!-- Page Initialization Script - Enhanced for v4.0 -->
    <script>
        // ì „ì—­ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¡œ ì¶©ëŒ ë°©ì§€
        window.InstituteInfoPageController = (function() {
            'use strict';
            
            // ì´ˆê¸°í™” ìƒíƒœ ê´€ë¦¬
            const initState = {
                configLoaded: false,
                supabaseInitialized: false,
                modulesReady: false,
                retryCount: 0,
                maxRetries: 3
            };

            // ì•ˆì „í•œ ì´ˆê¸°í™” í•¨ìˆ˜
            async function safeInitialize() {
                try {
                    console.log('ğŸ›ï¸ í•™ë‹¹ ì •ë³´ í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘ (v4.0)');
                    
                    // 1. í•„ìˆ˜ ê°ì²´ë“¤ì´ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
                    await waitForEssentials();
                    console.log('âœ… í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì™„ë£Œ');
                    
                    // 2. Lucide ì•„ì´ì½˜ ì´ˆê¸°í™”
                    if (typeof lucide !== 'undefined') {
                        lucide.createIcons();
                        console.log('âœ… Lucide ì•„ì´ì½˜ ì´ˆê¸°í™” ì™„ë£Œ');
                    } else {
                        console.warn('âš ï¸ Lucide ì•„ì´ì½˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                    
                    // 3. SupabaseAPI ì´ˆê¸°í™” ëŒ€ê¸° (ì¤‘ìš”!)
                    await waitForSupabaseAPI();
                    console.log('âœ… ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì™„ë£Œ');
                    
                    // 4. í•„ìš”í•œ ëª¨ë“ˆë“¤ ëŒ€ê¸°
                    await waitForRequiredModules();
                    console.log('âœ… í•„ìš”í•œ ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ');
                    
                    // 5. í•™ìƒ ì¸ì¦ í™•ì¸
                    checkStudentAuthentication();
                    
                    // 6. í•™ë‹¹ ì •ë³´ ë¡œë“œ
                    await loadInstituteInfo();
                    
                    console.log('ğŸ‰ í•™ë‹¹ ì •ë³´ í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
                    
                } catch (error) {
                    console.error('âŒ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    
                    // ì¬ì‹œë„ ë¡œì§
                    if (initState.retryCount < initState.maxRetries) {
                        initState.retryCount++;
                        console.log(`ğŸ”„ ì´ˆê¸°í™” ì¬ì‹œë„ ì¤‘... (${initState.retryCount}/${initState.maxRetries})`);
                        
                        setTimeout(() => {
                            safeInitialize();
                        }, 2000 * initState.retryCount); // ì ì§„ì  ì§€ì—°
                        return;
                    }
                    
                    showError(`ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`);
                }
            }

            // í•„ìˆ˜ ê°ì²´ë“¤ì´ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
            function waitForEssentials() {
                return new Promise((resolve, reject) => {
                    let attempts = 0;
                    const maxAttempts = 50; // 5ì´ˆ
                    
                    const check = () => {
                        attempts++;
                        
                        const hasConfig = window.CONFIG;
                        const hasSupabase = window.supabase && typeof window.supabase.createClient === 'function';
                        
                        if (hasConfig && hasSupabase) {
                            console.log('âœ… í•„ìˆ˜ ê°ì²´ ë¡œë“œ ì™„ë£Œ');
                            initState.configLoaded = true;
                            resolve();
                        } else if (attempts >= maxAttempts) {
                            const missing = [];
                            if (!hasConfig) missing.push('CONFIG');
                            if (!hasSupabase) missing.push('Supabase');
                            reject(new Error(`í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨: ${missing.join(', ')}`));
                        } else {
                            setTimeout(check, 100);
                        }
                    };
                    
                    check();
                });
            }

            // SupabaseAPI ì´ˆê¸°í™” ëŒ€ê¸°
            function waitForSupabaseAPI() {
                return new Promise((resolve, reject) => {
                    let attempts = 0;
                    const maxAttempts = 30; // 3ì´ˆ
                    
                    const check = async () => {
                        attempts++;
                        
                        if (window.SupabaseAPI && typeof window.SupabaseAPI.init === 'function') {
                            try {
                                console.log('ğŸ”— SupabaseAPI ì´ˆê¸°í™” ì¤‘...');
                                const success = await window.SupabaseAPI.init();
                                
                                if (success) {
                                    console.log('âœ… SupabaseAPI ì´ˆê¸°í™” ì™„ë£Œ');
                                    initState.supabaseInitialized = true;
                                    resolve();
                                    return;
                                }
                            } catch (error) {
                                console.warn(`âš ï¸ SupabaseAPI ì´ˆê¸°í™” ì‹œë„ ${attempts}/${maxAttempts} ì‹¤íŒ¨:`, error.message);
                            }
                        }
                        
                        if (attempts >= maxAttempts) {
                            reject(new Error('SupabaseAPI ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.'));
                        } else {
                            setTimeout(check, 100);
                        }
                    };
                    
                    check();
                });
            }

            // í•„ìš”í•œ ëª¨ë“ˆë“¤ ëŒ€ê¸°
            function waitForRequiredModules() {
                return new Promise((resolve, reject) => {
                    let attempts = 0;
                    const maxAttempts = 50; // 5ì´ˆ
                    
                    const check = () => {
                        attempts++;
                        
                        // ì´ í˜ì´ì§€ì—ì„œ í•„ìš”í•œ ëª¨ë“ˆë“¤ í™•ì¸
                        const hasApiHelper = window.ApiHelper;
                        const hasNotificationSystem = window.NotificationSystem;
                        const hasInstituteInfoModule = window.InstituteInfoModule;
                        
                        console.log(`ğŸ” ëª¨ë“ˆ ì²´í¬ ${attempts}/${maxAttempts}:`, {
                            ApiHelper: hasApiHelper,
                            NotificationSystem: hasNotificationSystem,
                            InstituteInfoModule: hasInstituteInfoModule
                        });
                        
                        if (hasApiHelper && hasNotificationSystem && hasInstituteInfoModule) {
                            console.log('âœ… í•„ìš”í•œ ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ');
                            initState.modulesReady = true;
                            resolve();
                        } else if (attempts >= maxAttempts) {
                            const missing = [];
                            if (!hasApiHelper) missing.push('ApiHelper');
                            if (!hasNotificationSystem) missing.push('NotificationSystem');
                            if (!hasInstituteInfoModule) missing.push('InstituteInfoModule');
                            
                            // ëª¨ë“ˆì´ ì—†ì–´ë„ ê¸°ë³¸ ê¸°ëŠ¥ì€ ë™ì‘í•˜ë„ë¡ ê²½ê³ ë§Œ í‘œì‹œ
                            console.warn(`âš ï¸ ì¼ë¶€ ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨: ${missing.join(', ')}`);
                            resolve(); // reject ëŒ€ì‹  resolveë¡œ ê³„ì† ì§„í–‰
                        } else {
                            setTimeout(check, 100);
                        }
                    };
                    
                    check();
                });
            }

            // DOMContentLoaded ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.addEventListener('DOMContentLoaded', safeInitialize);

            return {
                initialize: safeInitialize
            };
        })();

        // í•™ìƒ ì¸ì¦ í™•ì¸ (ê¸°ì¡´ í•¨ìˆ˜ë¥¼ ì „ì—­ìœ¼ë¡œ ìœ ì§€)
        function checkStudentAuthentication() {
            const studentData = localStorage.getItem('currentStudent');
            if (!studentData) {
                if (window.NotificationSystem && typeof window.NotificationSystem.showError === 'function') {
                    window.NotificationSystem.showError('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                } else {
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                }
                setTimeout(() => {
                    window.location.href = '../index.html';
                }, 1500);
                return false;
            }
            return true;
        }

        // ì—ëŸ¬ í‘œì‹œ (ê¸°ì¡´ í•¨ìˆ˜ë¥¼ ì „ì—­ìœ¼ë¡œ ìœ ì§€)
        function showError(message) {
            document.getElementById('loadingSpinner').style.display = 'none';
            document.getElementById('instituteCard').style.display = 'none';
            document.getElementById('emptyState').style.display = 'none';
            
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            
            // ì•„ì´ì½˜ ì¬ë Œë”ë§
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        // ë¹ˆ ìƒíƒœ í‘œì‹œ (ê¸°ì¡´ í•¨ìˆ˜ë¥¼ ì „ì—­ìœ¼ë¡œ ìœ ì§€)
        function showEmptyState() {
            document.getElementById('loadingSpinner').style.display = 'none';
            document.getElementById('instituteCard').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('emptyState').style.display = 'block';
            
            // ì•„ì´ì½˜ ì¬ë Œë”ë§
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        // í•™ë‹¹ ì •ë³´ í‘œì‹œ (ê¸°ì¡´ í•¨ìˆ˜ë¥¼ ì „ì—­ìœ¼ë¡œ ìœ ì§€)
        function showInstituteInfo(institute, programs) {
            document.getElementById('loadingSpinner').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('emptyState').style.display = 'none';

            // ê¸°ë³¸ ì •ë³´ ì±„ìš°ê¸°
            document.getElementById('instituteNameKo').textContent = institute.name_ko || '-';
            document.getElementById('instituteNameEn').textContent = institute.name_en || '-';
            document.getElementById('instituteLocation').textContent = `${institute.city || '-'}, ${institute.country || '-'}`;
            document.getElementById('instituteOperator').textContent = institute.operator || '-';
            document.getElementById('instituteAddress').textContent = institute.address || '-';
            document.getElementById('institutePhone').textContent = institute.phone || '-';
            
            // SNS ë§í¬ ì²˜ë¦¬
            const snsElement = document.getElementById('instituteSns');
            if (institute.sns_url) {
                snsElement.innerHTML = `<a href="${institute.sns_url}" target="_blank" class="contact-link">Instagram</a>`;
            } else {
                snsElement.textContent = '-';
            }

            // ë‹´ë‹¹ì ì •ë³´
            document.getElementById('contactPerson').textContent = institute.contact_person || '-';
            
            // ì´ë©”ì¼ ë§í¬ ì²˜ë¦¬
            const emailElement = document.getElementById('contactEmail');
            if (institute.contact_email) {
                emailElement.innerHTML = `<a href="mailto:${institute.contact_email}" class="contact-link">${institute.contact_email}</a>`;
            } else {
                emailElement.textContent = '-';
            }

            document.getElementById('localCoordinator').textContent = 
                institute.local_coordinator ? `${institute.local_coordinator} (${institute.local_coordinator_role || 'í˜„ì§€ ë‹´ë‹¹ì'})` : '-';

            // ê·¼ë¬´ ì •ë³´
            document.getElementById('workingHours').textContent = institute.working_hours_per_week || '-';
            document.getElementById('culturalHours').textContent = 
                institute.cultural_class_hours ? `ì£¼ ${institute.cultural_class_hours}ì‹œê°„` : '-';
            document.getElementById('classSchedule').textContent = institute.class_schedule || '-';
            document.getElementById('maxStudents').textContent = 
                institute.max_students_per_class ? `${institute.max_students_per_class}ëª…` : '-';

            // ì¶”ê°€ ì •ë³´
            document.getElementById('languageRequirement').textContent = institute.local_language_requirement || '-';
            document.getElementById('supportProvided').textContent = institute.support_provided || '-';

            // ë¬¸í™” í”„ë¡œê·¸ë¨ í‘œì‹œ
            displayPrograms(programs);

            document.getElementById('instituteCard').style.display = 'block';
            
            // ì•„ì´ì½˜ ì¬ë Œë”ë§
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        // ë¬¸í™” í”„ë¡œê·¸ë¨ í‘œì‹œ (ê¸°ì¡´ í•¨ìˆ˜ë¥¼ ì „ì—­ìœ¼ë¡œ ìœ ì§€)
        function displayPrograms(programs) {
            const programsGrid = document.getElementById('programsGrid');
            programsGrid.innerHTML = '';

            if (!programs || programs.length === 0) {
                programsGrid.innerHTML = `
                    <div class="empty-state">
                        <i data-lucide="calendar-x"></i>
                        <p>ë“±ë¡ëœ ë¬¸í™” í”„ë¡œê·¸ë¨ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                // ì•„ì´ì½˜ ì¬ë Œë”ë§
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
                return;
            }

            programs.forEach(program => {
                const programCard = document.createElement('div');
                programCard.className = 'program-card';
                programCard.innerHTML = `
                    <h4 class="program-name">
                        <i data-lucide="star"></i>
                        ${program.program_name}
                    </h4>
                    <ul class="program-details">
                        ${program.location ? `
                            <li>
                                <i data-lucide="map-pin"></i>
                                <span><strong>ì¥ì†Œ:</strong> ${program.location}</span>
                            </li>
                        ` : ''}
                        ${program.max_capacity ? `
                            <li>
                                <i data-lucide="users"></i>
                                <span><strong>ìµœëŒ€ ìˆ˜ìš©:</strong> ${program.max_capacity}ëª…</span>
                            </li>
                        ` : ''}
                        ${program.equipment_needed ? `
                            <li>
                                <i data-lucide="package"></i>
                                <span><strong>êµêµ¬/ì‹œì„¤:</strong> ${program.equipment_needed}</span>
                            </li>
                        ` : ''}
                        ${program.description ? `
                            <li>
                                <i data-lucide="file-text"></i>
                                <span><strong>ì„¤ëª…:</strong> ${program.description}</span>
                            </li>
                        ` : ''}
                    </ul>
                `;
                programsGrid.appendChild(programCard);
            });

            // ì•„ì´ì½˜ ë‹¤ì‹œ ë Œë”ë§
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        // loadInstituteInfo í•¨ìˆ˜ëŠ” InstituteInfoModuleì—ì„œ ì œê³µë¨
        async function loadInstituteInfo() {
            if (window.InstituteInfoModule && typeof window.InstituteInfoModule.loadInstituteInfo === 'function') {
                try {
                    await window.InstituteInfoModule.loadInstituteInfo();
                } catch (error) {
                    console.error('í•™ë‹¹ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                    showError('í•™ë‹¹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            } else {
                console.warn('âš ï¸ InstituteInfoModuleì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ë™ì‘ì„ ì‹œë„í•©ë‹ˆë‹¤.');
                showError('í•™ë‹¹ ì •ë³´ ëª¨ë“ˆì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
    </script>
</body>
</html>