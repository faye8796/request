<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š ì‚¬ì—… ë§Œì¡±ë„ ì¡°ì‚¬ - ì„¸ì¢…í•™ë‹¹ ë¬¸í™”ì¸í„´</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .user-info p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        /* ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* ì§„í–‰ë¥  í‘œì‹œ */
        .progress-section {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .progress-title {
            font-weight: 600;
            color: #374151;
        }

        .progress-text {
            font-size: 0.9rem;
            color: #6b7280;
        }

        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .survey-section {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 1.5rem 2rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .section-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            font-weight: 700;
            font-size: 0.9rem;
            margin-right: 0.75rem;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            display: flex;
            align-items: center;
        }

        .section-description {
            font-size: 0.9rem;
            color: #6b7280;
            margin-top: 0.5rem;
            padding-left: 2.75rem;
        }

        .section-body {
            padding: 2rem;
        }

        /* ì§ˆë¬¸ ìŠ¤íƒ€ì¼ */
        .question-item {
            margin-bottom: 2.5rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #f3f4f6;
        }

        .question-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .question-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1.25rem;
        }

        .question-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 36px;
            height: 36px;
            background: #eff6ff;
            color: #3b82f6;
            border-radius: 0.5rem;
            font-weight: 700;
            font-size: 0.85rem;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .question-text {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            line-height: 1.5;
        }

        /* ë¦¬ì»¤íŠ¸ ì²™ë„ */
        .likert-scale {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.75rem;
        }

        .likert-option {
            position: relative;
        }

        .likert-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .likert-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem 0.5rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            min-height: 100px;
            justify-content: center;
            text-align: center;
        }

        .likert-label:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .likert-option input[type="radio"]:checked + .likert-label {
            border-color: #667eea;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        }

        .likert-option input[type="radio"]:checked + .likert-label .likert-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .likert-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: #f3f4f6;
            color: #6b7280;
            border-radius: 50%;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .likert-text {
            font-size: 0.8rem;
            color: #4b5563;
            line-height: 1.3;
        }

        /* ì„œìˆ í˜• ì…ë ¥ */
        .textarea-wrapper {
            position: relative;
        }

        .form-textarea {
            width: 100%;
            min-height: 150px;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea:disabled {
            background: #f9fafb;
            color: #6b7280;
            cursor: not-allowed;
        }

        .char-count {
            text-align: right;
            font-size: 0.85rem;
            color: #9ca3af;
            margin-top: 0.5rem;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            font-size: 0.95rem;
            white-space: nowrap;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #4b5563;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        /* ì•¡ì…˜ ë²„íŠ¼ ì˜ì—­ */
        .action-section {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .action-info {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
        }

        /* ì œì¶œ ì™„ë£Œ ìƒíƒœ */
        .submitted-notice {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border: 2px solid #10b981;
            border-radius: 0.75rem;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .submitted-notice .notice-icon {
            width: 64px;
            height: 64px;
            color: #059669;
            margin: 0 auto 1rem;
        }

        .submitted-notice h3 {
            font-size: 1.5rem;
            color: #065f46;
            margin-bottom: 0.5rem;
        }

        .submitted-notice p {
            color: #047857;
        }

        /* í† ìŠ¤íŠ¸ ì•Œë¦¼ */
        .toast {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            color: white;
            font-weight: 500;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .toast-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .toast-error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .toast-info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .section-body {
                padding: 1.5rem;
            }

            .likert-scale {
                grid-template-columns: repeat(5, 1fr);
                gap: 0.4rem;
            }

            .likert-label {
                padding: 0.75rem 0.25rem;
                min-height: 90px;
            }

            .likert-number {
                width: 28px;
                height: 28px;
                font-size: 0.9rem;
            }

            .likert-text {
                font-size: 0.65rem;
            }

            .action-section {
                flex-direction: column;
                text-align: center;
            }

            .action-buttons {
                width: 100%;
                flex-direction: column;
            }

            .action-buttons .btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .user-info h1 {
                font-size: 1.25rem;
            }

            .section-title {
                font-size: 1.1rem;
            }

            .question-text {
                font-size: 0.95rem;
            }

            .likert-label {
                min-height: 80px;
            }

            .likert-text {
                font-size: 0.6rem;
            }
        }
    </style>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="header-content">
            <div class="user-info">
                <h1 id="userWelcome">ğŸ“Š 2025 ë¬¸í™”ì¸í„´ ì‚¬ì—… ë§Œì¡±ë„ ì¡°ì‚¬</h1>
                <p id="userDetails">ì†Œì¤‘í•œ ì˜ê²¬ì„ ë“¤ë ¤ì£¼ì„¸ìš”</p>
            </div>
            <div class="header-actions">
                <button id="backToDashboard" class="btn btn-secondary">
                    <i data-lucide="arrow-left"></i>
                    ëŒ€ì‹œë³´ë“œ
                </button>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="container">
        <!-- ì œì¶œ ì™„ë£Œ ì•ˆë‚´ (ì œì¶œ ì‹œì—ë§Œ í‘œì‹œ) -->
        <div class="submitted-notice" id="submittedNotice" style="display: none;">
            <svg class="notice-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <h3>ì„¤ë¬¸ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤</h3>
            <p>ì†Œì¤‘í•œ ì˜ê²¬ ê°ì‚¬í•©ë‹ˆë‹¤. ì œì¶œëœ ì„¤ë¬¸ì€ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>

        <!-- ì§„í–‰ë¥  í‘œì‹œ -->
        <div class="progress-section" id="progressSection">
            <div class="progress-header">
                <span class="progress-title">ì‘ì„± ì§„í–‰ë¥ </span>
                <span class="progress-text" id="progressText">0 / 15 ë¬¸í•­</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </div>

        <!-- ì„¤ë¬¸ í¼ -->
        <form id="surveyForm">
            <!-- ì„¹ì…˜ 1: ì „ë°˜ì ì¸ ë§Œì¡±ë„ -->
            <section class="survey-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-number">1</span>
                        ì „ë°˜ì ì¸ ë§Œì¡±ë„
                    </h2>
                </div>
                <div class="section-body">
                    <!-- Q1-1 -->
                    <div class="question-item">
                        <div class="question-header">
                            <span class="question-number">1-1</span>
                            <span class="question-text">2025 ì„¸ì¢…í•™ë‹¹ ë¬¸í™”ì¸í„´ ì‚¬ì—…ì— ì°¸ì—¬í•œ ê²ƒì— ë§Œì¡±í•˜ì‹­ë‹ˆê¹Œ?</span>
                        </div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="q1_1" value="5" id="q1_1_5">
                                <label for="q1_1_5" class="likert-label">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">ë§¤ìš° ë§Œì¡±</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q1_1" value="4" id="q1_1_4">
                                <label for="q1_1_4" class="likert-label">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">ë§Œì¡±</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q1_1" value="3" id="q1_1_3">
                                <label for="q1_1_3" class="likert-label">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">ë³´í†µ</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q1_1" value="2" id="q1_1_2">
                                <label for="q1_1_2" class="likert-label">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">ë¶ˆë§Œì¡±</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q1_1" value="1" id="q1_1_1">
                                <label for="q1_1_1" class="likert-label">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">ë§¤ìš° ë¶ˆë§Œì¡±</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Q1-2 -->
                    <div class="question-item">
                        <div class="question-header">
                            <span class="question-number">1-2</span>
                            <span class="question-text">ë¬¸í™”ì¸í„´ í™œë™ê³¼ ê´€ë ¨í•˜ì—¬, ì„¸ì¢…í•™ë‹¹ì¬ë‹¨ ë° ìš´ì˜ì‚¬ë¬´êµ­ì˜ í™œë™ ì§€ì›ì— ì „ë°˜ì ìœ¼ë¡œ ë§Œì¡±í•˜ì‹­ë‹ˆê¹Œ?</span>
                        </div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="q1_2" value="5" id="q1_2_5">
                                <label for="q1_2_5" class="likert-label">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">ë§¤ìš° ë§Œì¡±</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q1_2" value="4" id="q1_2_4">
                                <label for="q1_2_4" class="likert-label">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">ë§Œì¡±</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q1_2" value="3" id="q1_2_3">
                                <label for="q1_2_3" class="likert-label">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">ë³´í†µ</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q1_2" value="2" id="q1_2_2">
                                <label for="q1_2_2" class="likert-label">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">ë¶ˆë§Œì¡±</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q1_2" value="1" id="q1_2_1">
                                <label for="q1_2_1" class="likert-label">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">ë§¤ìš° ë¶ˆë§Œì¡±</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Q1-3 -->
                    <div class="question-item">
                        <div class="question-header">
                            <span class="question-number">1-3</span>
                            <span class="question-text">ë¬¸í™”ì¸í„´ í™œë™ê³¼ ê´€ë ¨í•˜ì—¬, íŒŒê²¬ëœ ì„¸ì¢…í•™ë‹¹ì˜ í™œë™ ì§€ì›ì— ì „ë°˜ì ìœ¼ë¡œ ë§Œì¡±í•˜ì‹­ë‹ˆê¹Œ?</span>
                        </div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="q1_3" value="5" id="q1_3_5">
                                <label for="q1_3_5" class="likert-label">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">ë§¤ìš° ë§Œì¡±</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q1_3" value="4" id="q1_3_4">
                                <label for="q1_3_4" class="likert-label">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">ë§Œì¡±</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q1_3" value="3" id="q1_3_3">
                                <label for="q1_3_3" class="likert-label">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">ë³´í†µ</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q1_3" value="2" id="q1_3_2">
                                <label for="q1_3_2" class="likert-label">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">ë¶ˆë§Œì¡±</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q1_3" value="1" id="q1_3_1">
                                <label for="q1_3_1" class="likert-label">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">ë§¤ìš° ë¶ˆë§Œì¡±</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Q1-4 -->
                    <div class="question-item">
                        <div class="question-header">
                            <span class="question-number">1-4</span>
                            <span class="question-text">ë¬¸í™”ì¸í„´ ì‚¬ì—…ì— ëŒ€í•´ ì£¼ë³€ ì‚¬ëŒë“¤ì—ê²Œ ì¶”ì²œí•  ì˜í–¥ì´ ìˆìœ¼ì‹­ë‹ˆê¹Œ?</span>
                        </div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="q1_4" value="5" id="q1_4_5">
                                <label for="q1_4_5" class="likert-label">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">ë§¤ìš° ê·¸ë ‡ë‹¤</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q1_4" value="4" id="q1_4_4">
                                <label for="q1_4_4" class="likert-label">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">ê·¸ë ‡ë‹¤</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q1_4" value="3" id="q1_4_3">
                                <label for="q1_4_3" class="likert-label">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">ë³´í†µ</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q1_4" value="2" id="q1_4_2">
                                <label for="q1_4_2" class="likert-label">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">ê·¸ë ‡ì§€ ì•Šë‹¤</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q1_4" value="1" id="q1_4_1">
                                <label for="q1_4_1" class="likert-label">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ì„¹ì…˜ 2: ë¬¸í™”ì¸í„´ ìˆ˜ì—… ì§€ì› ê´€ë ¨ -->
            <section class="survey-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-number">2</span>
                        ë¬¸í™”ì¸í„´ ìˆ˜ì—… ì§€ì› ê´€ë ¨
                    </h2>
                    <p class="section-description">ì•„ë˜ëŠ” ë¬¸í™”ì¸í„´ ìˆ˜ì—… ì§€ì›ê³¼ ê´€ë ¨ëœ ì„¤ë¬¸ ë¬¸í•­ì…ë‹ˆë‹¤.</p>
                </div>
                <div class="section-body">
                    <!-- Q2-1 -->
                    <div class="question-item">
                        <div class="question-header">
                            <span class="question-number">2-1</span>
                            <span class="question-text">íŒŒê²¬ ì „ êµ­ë‚´ êµìœ¡ í”„ë¡œê·¸ë¨ì˜ êµìœ¡ ë‚´ìš©ì´ ë¬¸í™”ì¸í„´ í™œë™ ì¤€ë¹„ ë° ë¬¸í™” ìˆ˜ì—… ì¤€ë¹„ì— ë„ì›€ì´ ë˜ì—ˆìŠµë‹ˆê¹Œ?</span>
                        </div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="q2_1" value="5" id="q2_1_5">
                                <label for="q2_1_5" class="likert-label">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">ë§¤ìš° ë„ì›€ë¨</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q2_1" value="4" id="q2_1_4">
                                <label for="q2_1_4" class="likert-label">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">ë„ì›€ë¨</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q2_1" value="3" id="q2_1_3">
                                <label for="q2_1_3" class="likert-label">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">ë³´í†µ</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q2_1" value="2" id="q2_1_2">
                                <label for="q2_1_2" class="likert-label">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">ë„ì›€ ì•ˆë¨</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q2_1" value="1" id="q2_1_1">
                                <label for="q2_1_1" class="likert-label">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">ì „í˜€ ë„ì›€ ì•ˆë¨</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Q2-2 -->
                    <div class="question-item">
                        <div class="question-header">
                            <span class="question-number">2-2</span>
                            <span class="question-text">ë¬¸í™” êµêµ¬ ì§€ì›ì´ ìˆ˜ì—…ì„ ìš´ì˜í•˜ëŠ”ë° ë„ì›€ì´ ë˜ì—ˆìŠµë‹ˆê¹Œ?</span>
                        </div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="q2_2" value="5" id="q2_2_5">
                                <label for="q2_2_5" class="likert-label">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">ë§¤ìš° ë„ì›€ë¨</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q2_2" value="4" id="q2_2_4">
                                <label for="q2_2_4" class="likert-label">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">ë„ì›€ë¨</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q2_2" value="3" id="q2_2_3">
                                <label for="q2_2_3" class="likert-label">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">ë³´í†µ</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q2_2" value="2" id="q2_2_2">
                                <label for="q2_2_2" class="likert-label">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">ë„ì›€ ì•ˆë¨</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q2_2" value="1" id="q2_2_1">
                                <label for="q2_2_1" class="likert-label">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">ì „í˜€ ë„ì›€ ì•ˆë¨</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Q2-3 -->
                    <div class="question-item">
                        <div class="question-header">
                            <span class="question-number">2-3</span>
                            <span class="question-text">íŒŒê²¬ëœ ì„¸ì¢…í•™ë‹¹ í˜„ì§€ ìš´ì˜ìš”ì›ì˜ ì§€ì›ì´ ìˆ˜ì—…ì„ ìš´ì˜í•˜ëŠ”ë° ë„ì›€ì´ ë˜ì—ˆìŠµë‹ˆê¹Œ?</span>
                        </div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="q2_3" value="5" id="q2_3_5">
                                <label for="q2_3_5" class="likert-label">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">ë§¤ìš° ë„ì›€ë¨</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q2_3" value="4" id="q2_3_4">
                                <label for="q2_3_4" class="likert-label">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">ë„ì›€ë¨</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q2_3" value="3" id="q2_3_3">
                                <label for="q2_3_3" class="likert-label">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">ë³´í†µ</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q2_3" value="2" id="q2_3_2">
                                <label for="q2_3_2" class="likert-label">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">ë„ì›€ ì•ˆë¨</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q2_3" value="1" id="q2_3_1">
                                <label for="q2_3_1" class="likert-label">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">ì „í˜€ ë„ì›€ ì•ˆë¨</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ì„¹ì…˜ 3: í˜„ì§€ ì •ì°© ì§€ì› ê´€ë ¨ -->
            <section class="survey-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-number">3</span>
                        í˜„ì§€ ì •ì°© ì§€ì› ê´€ë ¨
                    </h2>
                    <p class="section-description">ì•„ë˜ëŠ” í˜„ì§€ ì •ì°© ì§€ì›ê³¼ ê´€ë ¨ëœ ì„¤ë¬¸ ë¬¸í•­ì…ë‹ˆë‹¤.</p>
                </div>
                <div class="section-body">
                    <!-- Q3-1 -->
                    <div class="question-item">
                        <div class="question-header">
                            <span class="question-number">3-1</span>
                            <span class="question-text">ë¹„ì ë°œê¸‰ê³¼ ê´€ë ¨í•˜ì—¬ ìš´ì˜ì‚¬ë¬´êµ­ê³¼ í˜„ì§€ ì„¸ì¢…í•™ë‹¹ ë‹´ë‹¹ìì˜ ì ì ˆí•œ ì•ˆë‚´ ë° ì§€ì›ì´ ì´ë£¨ì–´ì¡ŒìŠµë‹ˆê¹Œ?</span>
                        </div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="q3_1" value="5" id="q3_1_5">
                                <label for="q3_1_5" class="likert-label">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">ë§¤ìš° ê·¸ë ‡ë‹¤</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_1" value="4" id="q3_1_4">
                                <label for="q3_1_4" class="likert-label">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">ê·¸ë ‡ë‹¤</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_1" value="3" id="q3_1_3">
                                <label for="q3_1_3" class="likert-label">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">ë³´í†µ</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_1" value="2" id="q3_1_2">
                                <label for="q3_1_2" class="likert-label">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">ê·¸ë ‡ì§€ ì•Šë‹¤</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_1" value="1" id="q3_1_1">
                                <label for="q3_1_1" class="likert-label">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Q3-2 -->
                    <div class="question-item">
                        <div class="question-header">
                            <span class="question-number">3-2</span>
                            <span class="question-text">ìˆ™ì†Œë¥¼ êµ¬í•˜ëŠ” ê³¼ì •ì—ì„œ, í˜„ì§€ ì„¸ì¢…í•™ë‹¹ ë‹´ë‹¹ìì˜ ì ì ˆí•œ ì•ˆë‚´ ë° ì§€ì›ì´ ì´ë£¨ì–´ì¡ŒìŠµë‹ˆê¹Œ?</span>
                        </div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="q3_2" value="5" id="q3_2_5">
                                <label for="q3_2_5" class="likert-label">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">ë§¤ìš° ê·¸ë ‡ë‹¤</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_2" value="4" id="q3_2_4">
                                <label for="q3_2_4" class="likert-label">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">ê·¸ë ‡ë‹¤</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_2" value="3" id="q3_2_3">
                                <label for="q3_2_3" class="likert-label">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">ë³´í†µ</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_2" value="2" id="q3_2_2">
                                <label for="q3_2_2" class="likert-label">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">ê·¸ë ‡ì§€ ì•Šë‹¤</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_2" value="1" id="q3_2_1">
                                <label for="q3_2_1" class="likert-label">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Q3-3 -->
                    <div class="question-item">
                        <div class="question-header">
                            <span class="question-number">3-3</span>
                            <span class="question-text">í˜„ì§€ ì ì‘ê³¼ ê´€ë ¨í•˜ì—¬, ì „ë‹´ ìš´ì˜ìš”ì›ì˜ ì§€ì›ì´ ë„ì›€ì´ ë˜ì—ˆìŠµë‹ˆê¹Œ?</span>
                        </div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="q3_3" value="5" id="q3_3_5">
                                <label for="q3_3_5" class="likert-label">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">ë§¤ìš° ê·¸ë ‡ë‹¤</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_3" value="4" id="q3_3_4">
                                <label for="q3_3_4" class="likert-label">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">ê·¸ë ‡ë‹¤</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_3" value="3" id="q3_3_3">
                                <label for="q3_3_3" class="likert-label">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">ë³´í†µ</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_3" value="2" id="q3_3_2">
                                <label for="q3_3_2" class="likert-label">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">ê·¸ë ‡ì§€ ì•Šë‹¤</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_3" value="1" id="q3_3_1">
                                <label for="q3_3_1" class="likert-label">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Q3-4 -->
                    <div class="question-item">
                        <div class="question-header">
                            <span class="question-number">3-4</span>
                            <span class="question-text">ì•ˆì „í•œ í•´ì™¸ì²´ë¥˜ì™€ ê´€ë ¨í•˜ì—¬ ì•ˆì „ ê´€ë ¨ êµ­ë‚´ êµìœ¡ ë° ê¸°ì´ˆ ì•ˆë‚´ìë£Œ, ë³´í—˜ê°€ì…, ì˜ë£Œì„œë¹„ìŠ¤ ë“±ì´ ë„ì›€ì´ ë˜ì—ˆìŠµë‹ˆê¹Œ?</span>
                        </div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="q3_4" value="5" id="q3_4_5">
                                <label for="q3_4_5" class="likert-label">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">ë§¤ìš° ê·¸ë ‡ë‹¤</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_4" value="4" id="q3_4_4">
                                <label for="q3_4_4" class="likert-label">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">ê·¸ë ‡ë‹¤</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_4" value="3" id="q3_4_3">
                                <label for="q3_4_3" class="likert-label">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">ë³´í†µ</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_4" value="2" id="q3_4_2">
                                <label for="q3_4_2" class="likert-label">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">ê·¸ë ‡ì§€ ì•Šë‹¤</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_4" value="1" id="q3_4_1">
                                <label for="q3_4_1" class="likert-label">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Q3-5 -->
                    <div class="question-item">
                        <div class="question-header">
                            <span class="question-number">3-5</span>
                            <span class="question-text">ì„¸ì¢…í•™ë‹¹ì¬ë‹¨ì˜ ì²´ì¬ë¹„ ë° í™œë™ë¹„ ì§€ì› ìˆ˜ì¤€ì— ë§Œì¡±í•˜ì‹­ë‹ˆê¹Œ?</span>
                        </div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="q3_5" value="5" id="q3_5_5">
                                <label for="q3_5_5" class="likert-label">
                                    <span class="likert-number">5</span>
                                    <span class="likert-text">ë§¤ìš° ë§Œì¡±</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_5" value="4" id="q3_5_4">
                                <label for="q3_5_4" class="likert-label">
                                    <span class="likert-number">4</span>
                                    <span class="likert-text">ë§Œì¡±</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_5" value="3" id="q3_5_3">
                                <label for="q3_5_3" class="likert-label">
                                    <span class="likert-number">3</span>
                                    <span class="likert-text">ë³´í†µ</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_5" value="2" id="q3_5_2">
                                <label for="q3_5_2" class="likert-label">
                                    <span class="likert-number">2</span>
                                    <span class="likert-text">ë¶€ì¡±</span>
                                </label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q3_5" value="1" id="q3_5_1">
                                <label for="q3_5_1" class="likert-label">
                                    <span class="likert-number">1</span>
                                    <span class="likert-text">ë§¤ìš° ë¶€ì¡±</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ì„¹ì…˜ 4: ì‚¬ì—… ê°œì„  ë°©í–¥ ê´€ë ¨ -->
            <section class="survey-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-number">4</span>
                        ì‚¬ì—… ê°œì„  ë°©í–¥ ê´€ë ¨
                    </h2>
                    <p class="section-description">ì•„ë˜ëŠ” ë¬¸í™”ì¸í„´ ì‚¬ì—… ê°œì„  ë°©í–¥ê³¼ ê´€ë ¨ëœ ì„¤ë¬¸ ë¬¸í•­ì…ë‹ˆë‹¤.</p>
                </div>
                <div class="section-body">
                    <!-- Q4-1 -->
                    <div class="question-item">
                        <div class="question-header">
                            <span class="question-number">4-1</span>
                            <span class="question-text">ë¬¸í™”ì¸í„´ í™œë™ì´ ë³¸ì¸ì—ê²Œ ìˆì–´ ê°€ì¥ ë„ì›€ì´ ë˜ì—ˆë˜ ì ì€ ë¬´ì—‡ì¸ê°€ìš”?</span>
                        </div>
                        <div class="textarea-wrapper">
                            <textarea 
                                class="form-textarea" 
                                id="q4_1" 
                                name="q4_1" 
                                placeholder="ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”..."
                                maxlength="2000"
                            ></textarea>
                            <div class="char-count"><span id="q4_1_count">0</span> / 2000</div>
                        </div>
                    </div>

                    <!-- Q4-2 -->
                    <div class="question-item">
                        <div class="question-header">
                            <span class="question-number">4-2</span>
                            <span class="question-text">ë¬¸í™”ì¸í„´ íŒŒê²¬ ì „, ì¶”ê°€ì ì¸ ì•ˆë‚´ê°€ í•„ìš”í•˜ê±°ë‚˜ êµìœ¡ì´ í•„ìš”í•˜ë‹¤ê³  ìƒê°ë˜ëŠ” ì‚¬í•­ì´ ìˆìœ¼ì‹œë‹¤ë©´ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”.</span>
                        </div>
                        <div class="textarea-wrapper">
                            <textarea 
                                class="form-textarea" 
                                id="q4_2" 
                                name="q4_2" 
                                placeholder="ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”..."
                                maxlength="2000"
                            ></textarea>
                            <div class="char-count"><span id="q4_2_count">0</span> / 2000</div>
                        </div>
                    </div>

                    <!-- Q4-3 -->
                    <div class="question-item">
                        <div class="question-header">
                            <span class="question-number">4-3</span>
                            <span class="question-text">ê¸°íƒ€ ë¬¸í™”ì¸í„´ ì‚¬ì—…ê³¼ ê´€ë ¨í•˜ì—¬ ê±´ì˜í•˜ê³  ì‹¶ì€ ì‚¬í•­ì´ ìˆìœ¼ì‹œë‹¤ë©´ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”.</span>
                        </div>
                        <div class="textarea-wrapper">
                            <textarea 
                                class="form-textarea" 
                                id="q4_3" 
                                name="q4_3" 
                                placeholder="ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”..."
                                maxlength="2000"
                            ></textarea>
                            <div class="char-count"><span id="q4_3_count">0</span> / 2000</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ì•¡ì…˜ ë²„íŠ¼ ì˜ì—­ -->
            <div class="action-section" id="actionSection">
                <p class="action-info" id="actionInfo">
                    <i data-lucide="info" style="width: 16px; height: 16px; display: inline; vertical-align: middle;"></i>
                    ì„ì‹œì €ì¥ í›„ ë‚˜ì¤‘ì— ì´ì–´ì„œ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
                <div class="action-buttons">
                    <button type="button" class="btn btn-secondary" id="saveDraftBtn">
                        <i data-lucide="save"></i>
                        ì„ì‹œì €ì¥
                    </button>
                    <button type="button" class="btn btn-success" id="submitBtn">
                        <i data-lucide="send"></i>
                        ìµœì¢… ì œì¶œ
                    </button>
                </div>
            </div>
        </form>
    </main>

    <!-- JavaScript -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        const SUPABASE_URL = 'https://aazvopacnbbkvusihqva.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFhenZvcGFjbmJia3Z1c2locXZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3OTQyMjQsImV4cCI6MjA2NTM3MDIyNH0.0NXI_tohwFCOl3xY4b1jIlxQR_zGTS9tWDM2OFxTq4s';

        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // ì•± ìƒíƒœ
        let currentUser = null;
        let existingSurvey = null;
        let isSubmitted = false;

        // ì§ˆë¬¸ ëª©ë¡ (ì§„í–‰ë¥  ê³„ì‚°ìš©)
        const likertQuestions = ['q1_1', 'q1_2', 'q1_3', 'q1_4', 'q2_1', 'q2_2', 'q2_3', 'q3_1', 'q3_2', 'q3_3', 'q3_4', 'q3_5'];
        const textQuestions = ['q4_1', 'q4_2', 'q4_3'];
        const totalQuestions = likertQuestions.length + textQuestions.length;

        // ì´ˆê¸°í™”
        async function init() {
            try {
                console.log('ğŸš€ ì‚¬ì—… ë§Œì¡±ë„ ì¡°ì‚¬ ì•± ì´ˆê¸°í™”...');

                // ì‚¬ìš©ì ì¸ì¦ í™•ì¸
                await loadUserData();

                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                setupEventListeners();

                // ê¸°ì¡´ ì„¤ë¬¸ ë°ì´í„° ë¡œë“œ
                await loadExistingSurvey();

                // Lucide ì•„ì´ì½˜ ì´ˆê¸°í™”
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }

                console.log('âœ… ì´ˆê¸°í™” ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                showToast('ì‹œìŠ¤í…œ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ
        async function loadUserData() {
            const userDataStr = localStorage.getItem('currentStudent');
            if (!userDataStr) {
                window.location.href = '../index.html';
                return;
            }

            currentUser = JSON.parse(userDataStr);

            // í™˜ì˜ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
            const welcomeEl = document.getElementById('userWelcome');
            if (welcomeEl && currentUser.name) {
                welcomeEl.textContent = `ğŸ“Š ${currentUser.name}ë‹˜ì˜ ì‚¬ì—… ë§Œì¡±ë„ ì¡°ì‚¬`;
            }
        }

        // ê¸°ì¡´ ì„¤ë¬¸ ë°ì´í„° ë¡œë“œ
        async function loadExistingSurvey() {
            try {
                const { data, error } = await supabase
                    .from('satisfaction_surveys')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .maybeSingle();

                if (error) throw error;

                if (data) {
                    existingSurvey = data;
                    isSubmitted = data.status === 'submitted';

                    // ê¸°ì¡´ ë°ì´í„°ë¡œ í¼ ì±„ìš°ê¸°
                    fillFormWithData(data);

                    // ì œì¶œëœ ê²½ìš° UI ì²˜ë¦¬
                    if (isSubmitted) {
                        showSubmittedState();
                    }
                }

                updateProgress();
            } catch (error) {
                console.error('ì„¤ë¬¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // í¼ì— ë°ì´í„° ì±„ìš°ê¸°
        function fillFormWithData(data) {
            // ë¦¬ì»¤íŠ¸ ì²™ë„ ì§ˆë¬¸
            likertQuestions.forEach(q => {
                const dbKey = q.replace('q', 'q').replace('_', '_');
                const value = data[dbKey];
                if (value) {
                    const radio = document.querySelector(`input[name="${q}"][value="${value}"]`);
                    if (radio) {
                        radio.checked = true;
                    }
                }
            });

            // ì„œìˆ í˜• ì§ˆë¬¸
            textQuestions.forEach(q => {
                const dbKey = q.replace('q4_1', 'q4_1_best_benefit')
                    .replace('q4_2', 'q4_2_additional_training')
                    .replace('q4_3', 'q4_3_suggestions');
                const textarea = document.getElementById(q);
                const value = data[dbKey];
                if (textarea && value) {
                    textarea.value = value;
                    updateCharCount(textarea, q);
                }
            });
        }

        // ì œì¶œ ì™„ë£Œ ìƒíƒœ í‘œì‹œ
        function showSubmittedState() {
            document.getElementById('submittedNotice').style.display = 'block';
            document.getElementById('progressSection').style.display = 'none';
            document.getElementById('actionSection').style.display = 'none';

            // ëª¨ë“  ì…ë ¥ ë¹„í™œì„±í™”
            document.querySelectorAll('input[type="radio"]').forEach(input => {
                input.disabled = true;
            });
            document.querySelectorAll('textarea').forEach(textarea => {
                textarea.disabled = true;
            });
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            // ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
            document.getElementById('backToDashboard').addEventListener('click', () => {
                window.location.href = 'dashboard.html';
            });

            // ì„ì‹œì €ì¥
            document.getElementById('saveDraftBtn').addEventListener('click', () => {
                saveSurvey(false);
            });

            // ìµœì¢… ì œì¶œ
            document.getElementById('submitBtn').addEventListener('click', () => {
                if (validateForm()) {
                    if (confirm('ì œì¶œ í›„ì—ëŠ” ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì •ë§ ì œì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        saveSurvey(true);
                    }
                }
            });

            // ë¼ë””ì˜¤ ë²„íŠ¼ ë³€ê²½ ì‹œ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', updateProgress);
            });

            // í…ìŠ¤íŠ¸ ì˜ì—­ ë³€ê²½ ì‹œ ê¸€ììˆ˜ ì¹´ìš´íŠ¸ ë° ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            textQuestions.forEach(q => {
                const textarea = document.getElementById(q);
                if (textarea) {
                    textarea.addEventListener('input', () => {
                        updateCharCount(textarea, q);
                        updateProgress();
                    });
                }
            });
        }

        // ê¸€ììˆ˜ ì—…ë°ì´íŠ¸
        function updateCharCount(textarea, id) {
            const countEl = document.getElementById(`${id}_count`);
            if (countEl) {
                countEl.textContent = textarea.value.length;
            }
        }

        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress() {
            let answered = 0;

            // ë¦¬ì»¤íŠ¸ ì²™ë„ ì§ˆë¬¸ ì²´í¬
            likertQuestions.forEach(q => {
                const checked = document.querySelector(`input[name="${q}"]:checked`);
                if (checked) answered++;
            });

            // ì„œìˆ í˜• ì§ˆë¬¸ ì²´í¬ (ë‚´ìš©ì´ ìˆìœ¼ë©´ ì‘ë‹µí•œ ê²ƒìœ¼ë¡œ ê°„ì£¼)
            textQuestions.forEach(q => {
                const textarea = document.getElementById(q);
                if (textarea && textarea.value.trim().length > 0) {
                    answered++;
                }
            });

            const percentage = Math.round((answered / totalQuestions) * 100);

            document.getElementById('progressText').textContent = `${answered} / ${totalQuestions} ë¬¸í•­`;
            document.getElementById('progressFill').style.width = `${percentage}%`;
        }

        // í¼ ìœ íš¨ì„± ê²€ì‚¬
        function validateForm() {
            // í•„ìˆ˜ ë¦¬ì»¤íŠ¸ ì§ˆë¬¸ ì²´í¬
            for (const q of likertQuestions) {
                const checked = document.querySelector(`input[name="${q}"]:checked`);
                if (!checked) {
                    showToast('ëª¨ë“  ê°ê´€ì‹ ë¬¸í•­ì— ì‘ë‹µí•´ì£¼ì„¸ìš”.', 'error');
                    return false;
                }
            }

            return true;
        }

        // í¼ ë°ì´í„° ìˆ˜ì§‘
        function collectFormData() {
            const formData = {
                user_id: currentUser.id
            };

            // ë¦¬ì»¤íŠ¸ ì²™ë„ ì§ˆë¬¸
            likertQuestions.forEach(q => {
                const checked = document.querySelector(`input[name="${q}"]:checked`);
                formData[q] = checked ? parseInt(checked.value) : null;
            });

            // ì„œìˆ í˜• ì§ˆë¬¸
            formData.q4_1_best_benefit = document.getElementById('q4_1').value.trim() || null;
            formData.q4_2_additional_training = document.getElementById('q4_2').value.trim() || null;
            formData.q4_3_suggestions = document.getElementById('q4_3').value.trim() || null;

            return formData;
        }

        // ì„¤ë¬¸ ì €ì¥
        async function saveSurvey(isSubmitting) {
            const btn = isSubmitting ? document.getElementById('submitBtn') : document.getElementById('saveDraftBtn');
            const originalText = btn.innerHTML;

            try {
                btn.disabled = true;
                btn.innerHTML = `<span class="loading-spinner"></span> ${isSubmitting ? 'ì œì¶œ ì¤‘...' : 'ì €ì¥ ì¤‘...'}`;

                const formData = collectFormData();

                if (isSubmitting) {
                    formData.status = 'submitted';
                    formData.submitted_at = new Date().toISOString();
                } else {
                    formData.status = 'draft';
                }

                formData.updated_at = new Date().toISOString();

                let result;

                if (existingSurvey) {
                    // ê¸°ì¡´ ë°ì´í„° ì—…ë°ì´íŠ¸
                    result = await supabase
                        .from('satisfaction_surveys')
                        .update(formData)
                        .eq('id', existingSurvey.id)
                        .select()
                        .single();
                } else {
                    // ìƒˆë¡œ ìƒì„±
                    result = await supabase
                        .from('satisfaction_surveys')
                        .insert([formData])
                        .select()
                        .single();
                }

                if (result.error) throw result.error;

                existingSurvey = result.data;

                if (isSubmitting) {
                    showToast('ì„¤ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    isSubmitted = true;
                    showSubmittedState();
                } else {
                    showToast('ì„ì‹œì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                }

            } catch (error) {
                console.error('ì €ì¥ ì‹¤íŒ¨:', error);
                showToast('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;

                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }
        }

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€
        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }

            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 3000);
        }

        // DOM ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
