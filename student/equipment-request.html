<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>λ¬Έν™”κµκµ¬ μ‹ μ²­ - μ„ΈμΆ…ν•™λ‹Ή λ¬Έν™”μΈν„΄ μ§€μ› μ‹μ¤ν…</title>
    
    <!-- CSS Files - Updated Cache Busting ---->
    <link rel="stylesheet" href="../css/main.css?v=4.1.0">
    <link rel="stylesheet" href="../css/student.css?v=4.1.0">
    <link rel="stylesheet" href="../css/lesson-plan.css?v=4.1.0">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Supabase JavaScript Client - Fixed CDN URL with Cache Busting -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.js?v=4.1.0"></script>
</head>
<body>
    <!-- Main App Container -->
    <div id="app">
        <!-- μμ—… κ³„ν μ‘μ„± νμ΄μ§€ -->
        <div id="lessonPlanPage" class="page">
            <div class="lesson-plan-container">
                <div class="lesson-plan-header">
                    <h1>μμ—… κ³„ν μ‘μ„±</h1>
                    <p>νκ²¬ κΈ°κ°„ λ™μ•μ μƒμ„Έν• μμ—… κ³„νμ„ <strong>ν•„μμ μΌλ΅</strong> μ‘μ„±ν•΄μ£Όμ„Έμ”. κ΄€λ¦¬μκ°€ μ΄ λ‚΄μ©μ„ κ²€ν† ν•μ—¬ μΉμΈ μ—¬λ¶€λ¥Ό κ²°μ •ν•λ©°, μΉμΈ ν›„μ—λ§ κµκµ¬ μ‹ μ²­μ΄ κ°€λ¥ν•©λ‹λ‹¤.</p>
                </div>

                <div class="lesson-plan-content">
                    <form id="lessonPlanForm">
                        <!-- κΈ°λ³Έ μ •λ³΄ μ…λ ¥ -->
                        <div class="basic-info-section">
                            <h2>κΈ°λ³Έ μ •λ³΄</h2>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>νκ²¬ μ‹μ‘μΌ *</label>
                                    <input type="date" id="startDate" required>
                                </div>
                                <div class="form-group">
                                    <label>νκ²¬ μΆ…λ£μΌ *</label>
                                    <input type="date" id="endDate" required>
                                </div>
                                <div class="form-group">
                                    <label>μ΄ μμ—… νμ</label>
                                    <div class="lesson-count-display">
                                        <span id="totalLessonsDisplay" class="lesson-count-number">0</span>
                                        <span class="lesson-count-label">ν</span>
                                    </div>
                                    <small class="text-muted">μ•„λμ—μ„ μμ—…μ„ μ¶”κ°€ν•λ©΄ μλ™μΌλ΅ κ³„μ‚°λ©λ‹λ‹¤</small>
                                </div>
                            </div>
                        </div>

                        <!-- μμ—… κ³„νν‘ -->
                        <div class="lesson-table-section">
                            <div class="lesson-table-header">
                                <h2>μμ—… κ³„νν‘</h2>
                                <button type="button" id="addLessonBtn" class="btn primary">
                                    <i data-lucide="plus"></i>
                                    μμ—… μ¶”κ°€
                                </button>
                            </div>
                            <div class="lesson-plan-requirements">
                                <div class="requirement-notice">
                                    <i data-lucide="alert-circle"></i>
                                    <div>
                                        <strong>ν•„μ μ μ¶ μ‚¬ν•­</strong>
                                        <p>λ¨λ“  μμ—…μ μ£Όμ μ™€ λ‚΄μ©μ„ κµ¬μ²΄μ μΌλ΅ μ‘μ„±ν•΄μ£Όμ„Έμ”. μμ—…μ€ κ°λ³„μ μΌλ΅ μ¶”κ°€/μ‚­μ ν•  μ μμΌλ©°, μ΄ μμ—… νμλ” μλ™μΌλ΅ κ³„μ‚°λ©λ‹λ‹¤.</p>
                                    </div>
                                </div>
                            </div>
                            <div id="lessonTableContainer" class="lesson-table-container">
                                <div class="empty-lessons-message">
                                    <i data-lucide="calendar-plus"></i>
                                    <p>μ•„μ§ μ¶”κ°€λ μμ—…μ΄ μ—†μµλ‹λ‹¤.</p>
                                    <p>μ„μ "μμ—… μ¶”κ°€" λ²„νΌμ„ ν΄λ¦­ν•μ—¬ μ²« λ²μ§Έ μμ—…μ„ μ¶”κ°€ν•΄λ³΄μ„Έμ”.</p>
                                </div>
                            </div>
                        </div>

                        <!-- μ¶”κ°€ μ •λ³΄ -->
                        <div class="additional-info-section">
                            <h2>μ¶”κ°€ μ •λ³΄</h2>
                            <div class="form-group">
                                <label>μ „μ²΄ μμ—… λ©ν‘ *</label>
                                <textarea id="overallGoals" rows="4" required placeholder="μ „μ²΄ μμ—…μ„ ν†µν•΄ λ‹¬μ„±ν•κ³ μ ν•λ” λ©ν‘λ¥Ό κµ¬μ²΄μ μΌλ΅ μ…λ ¥ν•μ„Έμ”"></textarea>
                            </div>
                            <div class="form-group">
                                <label>νΉλ³„ κ³ λ ¤μ‚¬ν•­</label>
                                <textarea id="specialNotes" rows="3" placeholder="ν„μ§€ μƒν™©μ΄λ‚ νΉλ³„ν κ³ λ ¤ν•΄μ•Ό ν•  μ‚¬ν•­μ΄ μμΌλ©΄ μ…λ ¥ν•μ„Έμ”"></textarea>
                            </div>
                        </div>

                        <!-- μ μ¶ λ²„νΌ (λ™μ μΌλ΅ λ³€κ²½λ¨) -->
                        <div class="form-actions">
                            <button type="button" id="backToDashboardBtn" class="btn secondary">
                                <i data-lucide="arrow-left"></i>
                                λ€μ‹λ³΄λ“λ΅ λμ•„κ°€κΈ°
                            </button>
                            <button type="button" id="saveDraftBtn" class="btn secondary">
                                <i data-lucide="save"></i>
                                μ„μ‹ μ €μ¥
                            </button>
                            <button type="submit" id="submitLessonPlanBtn" class="btn primary">
                                <i data-lucide="check"></i>
                                μμ—… κ³„ν μ™„λ£ λ° μ μ¶
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ν•™μƒ λ€μ‹λ³΄λ“ (κµκµ¬ μ‹ μ²­) -->
        <div id="studentPage" class="page active">
            <header class="header">
                <div class="header-content">
                    <div class="user-info">
                        <h1 id="studentWelcome">λ¬Έν™”κµκµ¬ μ‹ μ²­</h1>
                        <p id="studentDetails">μμ—…μ— ν•„μ”ν• κµκµ¬λ¥Ό μ‹ μ²­ν•κ³  κ΄€λ¦¬ν•μ„Έμ”</p>
                        
                        <!-- μμ‚° ν„ν™© ν‘μ‹ μμ—­ -->
                        <div id="budgetStatus" class="budget-status-container"></div>
                    </div>
                    <div class="header-actions">
                        <button id="lessonPlanBtn" class="btn secondary">
                            <i data-lucide="calendar"></i>
                            μμ—… κ³„ν
                        </button>
                        <button id="shippingAddressBtn" class="btn secondary shipping-address-btn">
                            <i data-lucide="map-pin"></i>
                            λ°°μ†΅μ§€ μ„¤μ •
                        </button>
                        <button id="backToDashboard" class="btn secondary">
                            <i data-lucide="arrow-left"></i>
                            λ€μ‹λ³΄λ“
                        </button>
                    </div>
                </div>
            </header>

            <main class="main-content">
                <div class="dashboard-header">
                    <h2>κµκµ¬ μ‹ μ²­ ν„ν™©</h2>
                    <div class="dashboard-actions">
                        <button id="bundleApplicationBtn" class="btn secondary">
                            <i data-lucide="shopping-cart"></i>
                            λ¬¶μ μ‹ μ²­
                        </button>
                        <button id="newApplicationBtn" class="btn primary">
                            <i data-lucide="plus"></i>
                            μƒ κµκµ¬ μ‹ μ²­
                        </button>
                    </div>
                </div>

                <div id="studentApplications" class="applications-grid">
                    <!-- λ™μ μΌλ΅ μƒμ„±λ  μ‹ μ²­ λ‚΄μ—­ -->
                </div>

                <div id="noApplications" class="empty-state" style="display: none;">
                    <i data-lucide="package" class="empty-icon"></i>
                    <p>μ•„μ§ μ‹ μ²­ν• κµκµ¬κ°€ μ—†μµλ‹λ‹¤.</p>
                </div>
            </main>
        </div>
    </div>

    <!-- κµκµ¬ μ‹ μ²­ λ¨λ‹¬ -->
    <div id="applicationModal" class="modal">
        <div class="modal-content">
            <h3 id="applicationModalTitle">μƒ κµκµ¬ μ‹ μ²­</h3>
            <form id="applicationForm">
                <!-- κµ¬λ§¤ λ°©μ‹ μ„ νƒ -->
                <div class="form-group">
                    <label>κµ¬λ§¤ λ°©μ‹ *</label>
                    <div class="purchase-method-options">
                        <label class="radio-option">
                            <input type="radio" name="purchaseMethod" value="online" checked>
                            <span class="radio-custom"></span>
                            <div class="radio-content">
                                <strong>μ¨λΌμΈ κµ¬λ§¤</strong>
                                <p>κ΄€λ¦¬μκ°€ λ€μ‹  κµ¬λ§¤ν•μ—¬ λ°°μ†΅</p>
                            </div>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="purchaseMethod" value="offline">
                            <span class="radio-custom"></span>
                            <div class="radio-content">
                                <strong>μ¤ν”„λΌμΈ κµ¬λ§¤</strong>
                                <p>μ§μ ‘ κµ¬λ§¤ ν›„ μμμ¦ μ μ¶λ΅ λΉ„μ© μ •μ‚°</p>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>κµκµ¬λ… *</label>
                    <input type="text" id="itemName" name="itemName" required placeholder="κµκµ¬ μ΄λ¦„μ„ μ…λ ¥ν•μ„Έμ”">
                </div>
                <div class="form-group">
                    <label>μ‚¬μ© λ©μ  *</label>
                    <textarea id="itemPurpose" name="itemPurpose" required rows="3" placeholder="κµκµ¬ μ‚¬μ© λ©μ μ„ μ„¤λ…ν•μ„Έμ”"></textarea>
                </div>
                <div class="form-group">
                    <label>κ°€κ²© (μ›) *</label>
                    <input type="number" id="itemPrice" name="itemPrice" required placeholder="κ°€κ²©μ„ μ…λ ¥ν•μ„Έμ”">
                </div>
                <div class="form-group" id="itemLinkGroup">
                    <label id="itemLinkLabel">κµ¬λ§¤ λ§ν¬ *</label>
                    <input type="url" id="itemLink" name="itemLink" required placeholder="κµ¬λ§¤ κ°€λ¥ν• λ§ν¬λ¥Ό μ…λ ¥ν•μ„Έμ”">
                </div>
                <div class="modal-actions">
                    <button type="button" id="cancelBtn" class="btn secondary">μ·¨μ†</button>
                    <button type="submit" class="btn primary" id="submitBtn">μ‹ μ²­ν•κΈ°</button>
                </div>
            </form>
        </div>
    </div>

    <!-- π“¦ λ¬¶μ μ‹ μ²­ λ¨λ‹¬ - μ™„μ „ μ¬μ„¤κ³„ -->
    <div id="bundleModal" class="modal">
        <div class="modal-content">
            <h3>λ¬¶μ κµκµ¬ μ‹ μ²­</h3>
            <form id="bundleForm">
                <!-- κΈ°λ³Έ μ •λ³΄ -->
                <div class="form-group">
                    <label>λ¬¶μ μ λ© *</label>
                    <input type="text" id="bundleTitle" name="bundleTitle" required placeholder="λ¬¶μ κµκµ¬λ¥Ό λ€ν‘ν•λ” μ λ©μ„ μ…λ ¥ν•μ„Έμ”">
                    <small class="text-muted">μ: ν•κµ­ μ „ν†µλ¬Έν™” μ²΄ν— κµκµ¬ μ„ΈνΈ</small>
                </div>
                
                <div class="form-group">
                    <label>μ‚¬μ© λ©μ  *</label>
                    <textarea id="bundlePurpose" name="bundlePurpose" required rows="3" placeholder="λ¬¶μ κµκµ¬μ μ‚¬μ© λ©μ μ„ μ„¤λ…ν•μ„Έμ”"></textarea>
                </div>
                
                <div class="form-group">
                    <label>κµ¬λ§¤ μ΄μ•΅ (μ›) *</label>
                    <input type="number" id="bundleTotalPrice" name="bundleTotalPrice" required min="1" placeholder="μμƒ μ΄ κµ¬λ§¤ κΈμ•΅μ„ μ…λ ¥ν•μ„Έμ”">
                    <small class="text-muted">μ¥λ°”κµ¬λ‹μ— λ‹΄κΈ΄ λ¨λ“  μƒν’μ μμƒ μ΄μ•΅</small>
                </div>
                
                <!-- κµ¬λ§¤ λ°©μ‹ μ„ νƒ -->
                <div class="form-group">
                    <label>κµ¬λ§¤ λ°©μ‹ *</label>
                    <div class="purchase-method-options">
                        <label class="radio-option">
                            <input type="radio" name="bundlePurchaseMethod" value="online" checked>
                            <span class="radio-custom"></span>
                            <div class="radio-content">
                                <strong>μ¨λΌμΈ κµ¬λ§¤</strong>
                                <p>κ΄€λ¦¬μκ°€ ν•™μƒ κ³„μ •μΌλ΅ λ€μ‹  κµ¬λ§¤</p>
                            </div>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="bundlePurchaseMethod" value="offline">
                            <span class="radio-custom"></span>
                            <div class="radio-content">
                                <strong>μ¤ν”„λΌμΈ κµ¬λ§¤</strong>
                                <p>μ§μ ‘ κµ¬λ§¤ ν›„ μμμ¦ μ μ¶λ΅ λΉ„μ© μ •μ‚°</p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- μ¨λΌμΈ κµ¬λ§¤ μ •λ³΄ -->
                <div id="onlinePurchaseInfo" class="purchase-info-