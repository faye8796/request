<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬¸í™”êµêµ¬ ì‹ ì²­ - ì„¸ì¢…í•™ë‹¹ ë¬¸í™”ì¸í„´ ì§€ì› ì‹œìŠ¤í…œ</title>
    
    <!-- CSS Files - Updated Cache Busting ---> 
    <link rel="stylesheet" href="../css/main.css?v=4.2.2">
    <link rel="stylesheet" href="../css/student.css?v=4.2.2">
    <link rel="stylesheet" href="../css/lesson-plan.css?v=4.2.2">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Supabase JavaScript Client - Fixed CDN URL with Cache Busting -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.js?v=4.2.2"></script>
</head>
<body>
    <!-- Main App Container -->
    <div id="app">
        <!-- ìˆ˜ì—… ê³„íš ì‘ì„± í˜ì´ì§€ -->
        <div id="lessonPlanPage" class="page">
            <div class="lesson-plan-container">
                <div class="lesson-plan-header">
                    <h1>ìˆ˜ì—… ê³„íš ì‘ì„±</h1>
                    <p>íŒŒê²¬ ê¸°ê°„ ë™ì•ˆì˜ ìƒì„¸í•œ ìˆ˜ì—… ê³„íšì„ <strong>í•„ìˆ˜ì ìœ¼ë¡œ</strong> ì‘ì„±í•´ì£¼ì„¸ìš”. ê´€ë¦¬ìê°€ ì´ ë‚´ìš©ì„ ê²€í† í•˜ì—¬ ìŠ¹ì¸ ì—¬ë¶€ë¥¼ ê²°ì •í•˜ë©°, ìŠ¹ì¸ í›„ì—ë§Œ êµêµ¬ ì‹ ì²­ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                </div>

                <div class="lesson-plan-content">
                    <form id="lessonPlanForm">
                        <!-- ê¸°ë³¸ ì •ë³´ ì…ë ¥ -->
                        <div class="basic-info-section">
                            <h2>ê¸°ë³¸ ì •ë³´</h2>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>íŒŒê²¬ ì‹œì‘ì¼ *</label>
                                    <input type="date" id="startDate" required>
                                </div>
                                <div class="form-group">
                                    <label>íŒŒê²¬ ì¢…ë£Œì¼ *</label>
                                    <input type="date" id="endDate" required>
                                </div>
                                <div class="form-group">
                                    <label>ì´ ìˆ˜ì—… íšŸìˆ˜</label>
                                    <div class="lesson-count-display">
                                        <span id="totalLessonsDisplay" class="lesson-count-number">0</span>
                                        <span class="lesson-count-label">íšŒ</span>
                                    </div>
                                    <small class="text-muted">ì•„ë˜ì—ì„œ ìˆ˜ì—…ì„ ì¶”ê°€í•˜ë©´ ìë™ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤</small>
                                </div>
                            </div>
                        </div>

                        <!-- ìˆ˜ì—… ê³„íší‘œ -->
                        <div class="lesson-table-section">
                            <div class="lesson-table-header">
                                <h2>ìˆ˜ì—… ê³„íší‘œ</h2>
                                <button type="button" id="addLessonBtn" class="btn primary">
                                    <i data-lucide="plus"></i>
                                    ìˆ˜ì—… ì¶”ê°€
                                </button>
                            </div>
                            <div class="lesson-plan-requirements">
                                <div class="requirement-notice">
                                    <i data-lucide="alert-circle"></i>
                                    <div>
                                        <strong>í•„ìˆ˜ ì œì¶œ ì‚¬í•­</strong>
                                        <p>ëª¨ë“  ìˆ˜ì—…ì˜ ì£¼ì œì™€ ë‚´ìš©ì„ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”. ìˆ˜ì—…ì€ ê°œë³„ì ìœ¼ë¡œ ì¶”ê°€/ì‚­ì œí•  ìˆ˜ ìˆìœ¼ë©°, ì´ ìˆ˜ì—… íšŸìˆ˜ëŠ” ìë™ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.</p>
                                    </div>
                                </div>
                            </div>
                            <div id="lessonTableContainer" class="lesson-table-container">
                                <div class="empty-lessons-message">
                                    <i data-lucide="calendar-plus"></i>
                                    <p>ì•„ì§ ì¶”ê°€ëœ ìˆ˜ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                                    <p>ìœ„ì˜ "ìˆ˜ì—… ì¶”ê°€" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì²« ë²ˆì§¸ ìˆ˜ì—…ì„ ì¶”ê°€í•´ë³´ì„¸ìš”.</p>
                                </div>
                            </div>
                        </div>

                        <!-- ì¶”ê°€ ì •ë³´ -->
                        <div class="additional-info-section">
                            <h2>ì¶”ê°€ ì •ë³´</h2>
                            <div class="form-group">
                                <label>ì „ì²´ ìˆ˜ì—… ëª©í‘œ *</label>
                                <textarea id="overallGoals" rows="4" required placeholder="ì „ì²´ ìˆ˜ì—…ì„ í†µí•´ ë‹¬ì„±í•˜ê³ ì í•˜ëŠ” ëª©í‘œë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                            </div>
                            <div class="form-group">
                                <label>íŠ¹ë³„ ê³ ë ¤ì‚¬í•­</label>
                                <textarea id="specialNotes" rows="3" placeholder="í˜„ì§€ ìƒí™©ì´ë‚˜ íŠ¹ë³„íˆ ê³ ë ¤í•´ì•¼ í•  ì‚¬í•­ì´ ìˆìœ¼ë©´ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                            </div>
                        </div>

                        <!-- ì œì¶œ ë²„íŠ¼ (ë™ì ìœ¼ë¡œ ë³€ê²½ë¨) -->
                        <div class="form-actions">
                            <button type="button" id="backToDashboardBtn" class="btn secondary">
                                <i data-lucide="arrow-left"></i>
                                ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                            </button>
                            <button type="button" id="saveDraftBtn" class="btn secondary">
                                <i data-lucide="save"></i>
                                ì„ì‹œ ì €ì¥
                            </button>
                            <button type="submit" id="submitLessonPlanBtn" class="btn primary">
                                <i data-lucide="check"></i>
                                ìˆ˜ì—… ê³„íš ì™„ë£Œ ë° ì œì¶œ
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- í•™ìƒ ëŒ€ì‹œë³´ë“œ (êµêµ¬ ì‹ ì²­) -->
        <div id="studentPage" class="page active">
            <header class="header">
                <div class="header-content">
                    <div class="user-info">
                        <h1 id="studentWelcome">ë¬¸í™”êµêµ¬ ì‹ ì²­</h1>
                        <p id="studentDetails">ìˆ˜ì—…ì— í•„ìš”í•œ êµêµ¬ë¥¼ ì‹ ì²­í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</p>
                        
                        <!-- ì˜ˆì‚° í˜„í™© í‘œì‹œ ì˜ì—­ -->
                        <div id="budgetStatus" class="budget-status-container"></div>
                    </div>
                    <div class="header-actions">
                        <button id="lessonPlanBtn" class="btn secondary">
                            <i data-lucide="calendar"></i>
                            ìˆ˜ì—… ê³„íš
                        </button>
                        <button id="shippingAddressBtn" class="btn secondary shipping-address-btn">
                            <i data-lucide="map-pin"></i>
                            ë°°ì†¡ì§€ ì„¤ì •
                        </button>
                        <button id="backToDashboard" class="btn secondary">
                            <i data-lucide="arrow-left"></i>
                            ëŒ€ì‹œë³´ë“œ
                        </button>
                    </div>
                </div>
            </header>

            <main class="main-content">
                <div class="dashboard-header">
                    <h2>êµêµ¬ ì‹ ì²­ í˜„í™©</h2>
                    <div class="dashboard-actions">
                        <button id="bundleApplicationBtn" class="btn secondary">
                            <i data-lucide="shopping-cart"></i>
                            ë¬¶ìŒ ì‹ ì²­
                        </button>
                        <button id="newApplicationBtn" class="btn primary">
                            <i data-lucide="plus"></i>
                            ìƒˆ êµêµ¬ ì‹ ì²­
                        </button>
                    </div>
                </div>

                <div id="studentApplications" class="applications-grid">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ì‹ ì²­ ë‚´ì—­ -->
                </div>

                <div id="noApplications" class="empty-state" style="display: none;">
                    <i data-lucide="package" class="empty-icon"></i>
                    <p>ì•„ì§ ì‹ ì²­í•œ êµêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
            </main>
        </div>
    </div>

    <!-- êµêµ¬ ì‹ ì²­ ëª¨ë‹¬ -->
    <div id="applicationModal" class="modal">
        <div class="modal-content">
            <h3 id="applicationModalTitle">ìƒˆ êµêµ¬ ì‹ ì²­</h3>
            <form id="applicationForm">
                <!-- êµ¬ë§¤ ë°©ì‹ ì„ íƒ -->
                <div class="form-group">
                    <label>êµ¬ë§¤ ë°©ì‹ *</label>
                    <div class="purchase-method-options">
                        <label class="radio-option">
                            <input type="radio" name="purchaseMethod" value="online" checked>
                            <span class="radio-custom"></span>
                            <div class="radio-content">
                                <strong>ì˜¨ë¼ì¸ êµ¬ë§¤</strong>
                                <p>ê´€ë¦¬ìê°€ ëŒ€ì‹  êµ¬ë§¤í•˜ì—¬ ë°°ì†¡</p>
                            </div>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="purchaseMethod" value="offline">
                            <span class="radio-custom"></span>
                            <div class="radio-content">
                                <strong>ì˜¤í”„ë¼ì¸ êµ¬ë§¤</strong>
                                <p>ì§ì ‘ êµ¬ë§¤ í›„ ì˜ìˆ˜ì¦ ì œì¶œë¡œ ë¹„ìš© ì •ì‚°</p>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>êµêµ¬ëª… *</label>
                    <input type="text" id="itemName" name="itemName" required placeholder="êµêµ¬ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group">
                    <label>ì‚¬ìš© ëª©ì  *</label>
                    <textarea id="itemPurpose" name="itemPurpose" required rows="3" placeholder="êµêµ¬ ì‚¬ìš© ëª©ì ì„ ì„¤ëª…í•˜ì„¸ìš”"></textarea>
                </div>
                <div class="form-group">
                    <label>ê°€ê²© (ì›) *</label>
                    <input type="number" id="itemPrice" name="itemPrice" required placeholder="ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group" id="itemLinkGroup">
                    <label id="itemLinkLabel">êµ¬ë§¤ ë§í¬ *</label>
                    <input type="url" id="itemLink" name="itemLink" required placeholder="êµ¬ë§¤ ê°€ëŠ¥í•œ ë§í¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="modal-actions">
                    <button type="button" id="cancelBtn" class="btn secondary">ì·¨ì†Œ</button>
                    <button type="submit" class="btn primary" id="submitBtn">ì‹ ì²­í•˜ê¸°</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ğŸ“¦ ë¬¶ìŒ ì‹ ì²­ ëª¨ë‹¬ - v4.3.0 ì™„ì „ ì¬ì„¤ê³„ (4ê°€ì§€ íƒ€ì…ë³„ ìµœì í™”) -->
    <div id="bundleModal" class="modal">
        <div class="modal-content">
            <h3>ë¬¶ìŒ êµêµ¬ ì‹ ì²­ <span class="version-badge">v4.3.0</span></h3>
            <div class="bundle-intro">
                <p>ì—¬ëŸ¬ êµêµ¬ë¥¼ í•œ ë²ˆì— ì‹ ì²­í•  ë•Œ ì‚¬ìš©í•˜ì„¸ìš”. êµ¬ë§¤ ë°©ì‹ì— ë”°ë¼ í•„ìš”í•œ ì •ë³´ê°€ ë‹¤ë¦…ë‹ˆë‹¤.</p>
            </div>
            
            <form id="bundleForm">
                <!-- ê¸°ë³¸ ì •ë³´ -->
                <div class="form-section">
                    <h4><i data-lucide="info"></i> ê¸°ë³¸ ì •ë³´</h4>
                    
                    <div class="form-group">
                        <label>ë¬¶ìŒ ì œëª© *</label>
                        <input type="text" id="bundleTitle" name="bundleTitle" required placeholder="ë¬¶ìŒ êµêµ¬ë¥¼ ëŒ€í‘œí•˜ëŠ” ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                        <small class="text-muted">ì˜ˆ: í•œêµ­ ì „í†µë¬¸í™” ì²´í—˜ êµêµ¬ ì„¸íŠ¸, K-POP ëŒ„ìŠ¤ ìˆ˜ì—…ìš© ë„êµ¬ ë¬¶ìŒ</small>
                    </div>
                    
                    <div class="form-group">
                        <label>ì‚¬ìš© ëª©ì  *</label>
                        <textarea id="bundlePurpose" name="bundlePurpose" required rows="3" placeholder="ì´ ë¬¶ìŒ êµêµ¬ë“¤ì„ ì–´ë–¤ ëª©ì ìœ¼ë¡œ ì‚¬ìš©í•  ì˜ˆì •ì¸ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>êµ¬ë§¤ ì´ì•¡ (ì›) *</label>
                        <input type="number" id="bundleTotalPrice" name="bundleTotalPrice" required min="1" placeholder="ì˜ˆìƒ ì´ êµ¬ë§¤ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”">
                        <small class="text-muted">ëª¨ë“  êµêµ¬ì˜ ì˜ˆìƒ ì´ì•¡ (ë°°ì†¡ë¹„ í¬í•¨)</small>
                    </div>
                </div>
                
                <!-- ğŸ¯ v4.3.0 êµ¬ë§¤ ë°©ì‹ ì„ íƒ - 4ê°€ì§€ íƒ€ì…ë³„ ìµœì í™” -->
                <div class="form-section">
                    <h4><i data-lucide="shopping-cart"></i> êµ¬ë§¤ ë°©ì‹ ì„ íƒ</h4>
                    <div class="purchase-method-options">
                        <label class="radio-option enhanced">
                            <input type="radio" name="bundlePurchaseMethod" value="online" checked>
                            <span class="radio-custom"></span>
                            <div class="radio-content">
                                <strong>ì˜¨ë¼ì¸ êµ¬ë§¤</strong>
                                <p>ê´€ë¦¬ìê°€ í•™ìƒ ê³„ì •ìœ¼ë¡œ ëŒ€ì‹  êµ¬ë§¤</p>
                                <div class="method-features">
                                    <span class="feature-tag">ê³„ì • ì •ë³´ í•„ìš”</span>
                                    <span class="feature-tag">ì¥ë°”êµ¬ë‹ˆ ì¤€ë¹„</span>
                                </div>
                            </div>
                        </label>
                        <label class="radio-option enhanced">
                            <input type="radio" name="bundlePurchaseMethod" value="offline">
                            <span class="radio-custom"></span>
                            <div class="radio-content">
                                <strong>ì˜¤í”„ë¼ì¸ êµ¬ë§¤</strong>
                                <p>ì§ì ‘ êµ¬ë§¤ í›„ ì˜ìˆ˜ì¦ ì œì¶œë¡œ ë¹„ìš© ì •ì‚°</p>
                                <div class="method-features">
                                    <span class="feature-tag">êµ¬ë§¤ì²˜ ì •ë³´ í•„ìš”</span>
                                    <span class="feature-tag">ì˜ìˆ˜ì¦ ì œì¶œ</span>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- ğŸ†• v4.3.0 ì˜¨ë¼ì¸ êµ¬ë§¤ ì •ë³´ (account_id, account_pw í™œìš©) -->
                <div id="onlinePurchaseInfo" class="purchase-info-section">
                    <div class="form-section">
                        <h4><i data-lucide="globe"></i> ì˜¨ë¼ì¸ êµ¬ë§¤ ì •ë³´</h4>
                        
                        <div class="form-group">
                            <label>êµ¬ë§¤ ì‚¬ì´íŠ¸ *</label>
                            <select id="purchaseSite" name="purchaseSite" required>
                                <option value="">êµ¬ë§¤ ì‚¬ì´íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="coupang">ì¿ íŒ¡ (Coupang)</option>
                                <option value="11st">11ë²ˆê°€</option>
                                <option value="gmarket">ì§€ë§ˆì¼“ (Gmarket)</option>
                                <option value="auction">ì˜¥ì…˜ (Auction)</option>
                                <option value="interpark">ì¸í„°íŒŒí¬</option>
                                <option value="lotte">ë¡¯ë°ì˜¨</option>
                                <option value="ssg">SSG.COM</option>
                                <option value="yes24">YES24</option>
                                <option value="kyobo">êµë³´ë¬¸ê³ </option>
                                <option value="other">ê¸°íƒ€ (ì§ì ‘ ì…ë ¥)</option>
                            </select>
                            <input type="url" id="otherSite" name="otherSite" placeholder="ê¸°íƒ€ ì‚¬ì´íŠ¸ URLì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: https://example.com)" style="display: none; margin-top: 8px;">
                        </div>
                        
                        <!-- ğŸ” v4.3.0 ê³„ì • ì •ë³´ (ë³„ë„ ì»¬ëŸ¼ìœ¼ë¡œ ì €ì¥) -->
                        <div class="account-info-section">
                            <div class="account-info-header">
                                <i data-lucide="shield-check"></i>
                                <div>
                                    <h5>ê³„ì • ì •ë³´ (v4.3.0 ë³´ì•ˆ ê°•í™”)</h5>
                                    <p>ê´€ë¦¬ìê°€ ëŒ€ì‹  êµ¬ë§¤í•˜ê¸° ìœ„í•œ ê³„ì • ì •ë³´ì…ë‹ˆë‹¤. ì•”í˜¸í™”ë˜ì–´ ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤.</p>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>ê³„ì • ì•„ì´ë”” *</label>
                                <input type="text" id="accountId" name="accountId" required placeholder="êµ¬ë§¤ ì‚¬ì´íŠ¸ ë¡œê·¸ì¸ ì•„ì´ë””">
                                <small class="text-muted">ê´€ë¦¬ìê°€ ëŒ€ì‹  ì£¼ë¬¸í•˜ê¸° ìœ„í•œ ê³„ì • ì•„ì´ë””</small>
                            </div>
                            
                            <div class="form-group">
                                <label>ê³„ì • ë¹„ë°€ë²ˆí˜¸ *</label>
                                <input type="password" id="accountPassword" name="accountPassword" required placeholder="êµ¬ë§¤ ì‚¬ì´íŠ¸ ë¡œê·¸ì¸ ë¹„ë°€ë²ˆí˜¸">
                                <small class="text-muted">âš ï¸ ë³´ì•ˆì„ ìœ„í•´ ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë˜ë©°, êµ¬ë§¤ ì™„ë£Œ í›„ ì¦‰ì‹œ ì‚­ì œë©ë‹ˆë‹¤</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>ì¥ë°”êµ¬ë‹ˆ ë©”ëª¨ (ì„ íƒ)</label>
                            <textarea id="cartNote" name="cartNote" rows="3" placeholder="ì¥ë°”êµ¬ë‹ˆì— ë‹´ì€ ìƒí’ˆë“¤ì— ëŒ€í•œ ì„¤ëª…ì´ë‚˜ íŠ¹ë³„ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ë©´ ì…ë ¥í•˜ì„¸ìš”&#10;&#10;ì˜ˆ: 
- í•œë³µ ì¬ë£Œ: ì„±ì¸ìš© í•œë³µ ì›ë‹¨ 5ì„¸íŠ¸
- ì „í†µ ì•…ê¸°: ì†Œê³  10ê°œ, ì¥êµ¬ 3ê°œ  
- í¬ì¥ ìš”ì²­: ê°œë³„ í¬ì¥ í•„ìš”"></textarea>
                            <small class="text-muted">ê´€ë¦¬ìê°€ ì¥ë°”êµ¬ë‹ˆë¥¼ ì°¾ê¸° ì‰½ë„ë¡ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”</small>
                        </div>
                    </div>
                </div>

                <!-- ğŸ†• v4.3.0 ì˜¤í”„ë¼ì¸ êµ¬ë§¤ ì •ë³´ (store_info í™œìš©) -->
                <div id="offlinePurchaseInfo" class="purchase-info-section" style="display: none;">
                    <div class="form-section">
                        <h4><i data-lucide="store"></i> ì˜¤í”„ë¼ì¸ êµ¬ë§¤ ì •ë³´</h4>
                        
                        <div class="form-group">
                            <label>êµ¬ë§¤ ì—…ì²´ ì •ë³´ *</label>
                            <textarea id="offlineVendor" name="offlineVendor" required rows="4" placeholder="êµ¬ë§¤ ì˜ˆì • ì—…ì²´ì˜ ìƒì„¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”&#10;&#10;ì˜ˆ:
ì—…ì²´ëª…: í•œêµ­ì „í†µë¬¸í™”ì„¼í„°
ì£¼ì†Œ: ì„œìš¸ì‹œ ì¢…ë¡œêµ¬ ì¸ì‚¬ë™ê¸¸ 123
ì—°ë½ì²˜: 02-1234-5678
í™ˆí˜ì´ì§€: www.example.com"></textarea>
                            <small class="text-muted">ì˜ìˆ˜ì¦ í™•ì¸ì„ ìœ„í•´ ì •í™•í•œ ì—…ì²´ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤</small>
                        </div>
                        
                        <div class="form-group">
                            <label>êµ¬ë§¤ ê³„íš (ì„ íƒ)</label>
                            <textarea id="purchasePlan" name="purchasePlan" rows="3" placeholder="êµ¬ë§¤ ì¼ì •ì´ë‚˜ ë°©ë²•ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ê³„íšì„ ì…ë ¥í•˜ì„¸ìš”&#10;&#10;ì˜ˆ:
- êµ¬ë§¤ ì˜ˆì •ì¼: 2025ë…„ 1ì›” 15ì¼
- êµ¬ë§¤ ë°©ë²•: ì—…ì²´ ë°©ë¬¸ ë˜ëŠ” ì „í™” ì£¼ë¬¸
- ë°°ì†¡ ë°©ë²•: ì—…ì²´ ì§ì ‘ ë°°ì†¡"></textarea>
                            <small class="text-muted">ê´€ë¦¬ìê°€ ìŠ¹ì¸ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ëŠ”ë° ë„ì›€ì´ ë©ë‹ˆë‹¤</small>
                        </div>

                        <!-- ğŸ“‹ ì˜¤í”„ë¼ì¸ êµ¬ë§¤ ì•ˆë‚´ì‚¬í•­ -->
                        <div class="offline-notice">
                            <i data-lucide="info"></i>
                            <div>
                                <strong>ì˜¤í”„ë¼ì¸ êµ¬ë§¤ ì•ˆë‚´</strong>
                                <ul>
                                    <li>êµ¬ë§¤ í›„ <strong>7ì¼ ì´ë‚´</strong>ì— ì˜ìˆ˜ì¦ì„ ì œì¶œí•´ì£¼ì„¸ìš”</li>
                                    <li>ì˜ìˆ˜ì¦ì€ êµ¬ë§¤ì²˜ëª…, êµ¬ë§¤ì¼, ê¸ˆì•¡ì´ ëª…í™•íˆ í‘œì‹œë˜ì–´ì•¼ í•©ë‹ˆë‹¤</li>
                                    <li>ë¶„í•  êµ¬ë§¤ ì‹œ ëª¨ë“  ì˜ìˆ˜ì¦ì„ ê°ê° ì œì¶œí•´ì£¼ì„¸ìš”</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" id="bundleCancelBtn" class="btn secondary">ì·¨ì†Œ</button>
                    <button type="submit" class="btn primary">
                        <i data-lucide="shopping-cart"></i>
                        ë¬¶ìŒ ì‹ ì²­í•˜ê¸°
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ë°°ì†¡ì§€ ì„¤ì • ëª¨ë‹¬ -->
    <div id="shippingModal" class="modal">
        <div class="modal-content">
            <h3>ë°°ì†¡ì§€ ì„¤ì •</h3>
            <form id="shippingForm">
                <div class="form-group">
                    <label>ë°›ëŠ” ë¶„ *</label>
                    <input type="text" id="shippingName" name="shippingName" required placeholder="ë°›ëŠ” ë¶„ ì„±ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group">
                    <label>ì—°ë½ì²˜ *</label>
                    <input type="tel" id="shippingPhone" name="shippingPhone" required placeholder="ì—°ë½ì²˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group">
                    <label>ì£¼ì†Œ *</label>
                    <textarea id="shippingAddress" name="shippingAddress" required rows="3" placeholder="ìƒì„¸ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”&#10;ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123, 456í˜¸"></textarea>
                </div>
                <div class="form-group">
                    <label>ìš°í¸ë²ˆí˜¸</label>
                    <input type="text" id="shippingPostcode" name="shippingPostcode" placeholder="ìš°í¸ë²ˆí˜¸ (ì„ íƒ)">
                </div>
                <div class="form-group">
                    <label>ë°°ì†¡ ìš”ì²­ì‚¬í•­</label>
                    <textarea id="shippingNote" name="shippingNote" rows="2" placeholder="ë°°ì†¡ ì‹œ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ë©´ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" id="shippingCancelBtn" class="btn secondary">ì·¨ì†Œ</button>
                    <button type="submit" class="btn primary">ì €ì¥í•˜ê¸°</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì˜ìˆ˜ì¦ ë“±ë¡ ëª¨ë‹¬ - UX ê°œì„  v4.3.0 -->
    <div id="receiptModal" class="modal">
        <div class="modal-content">
            <h3>ì˜ìˆ˜ì¦ ë“±ë¡</h3>
            <form id="receiptForm">
                <div class="receipt-info">
                    <div class="receipt-item-info">
                        <h4 id="receiptItemName">êµêµ¬ëª…</h4>
                        <p id="receiptItemPrice">ê°€ê²©: </p>
                    </div>
                </div>
                
                <!-- ğŸ“¸ ì˜ìˆ˜ì¦ íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ - ê°œì„ ëœ UI -->
                <div class="form-group">
                    <label>ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ *</label>
                    <div class="file-upload-area" id="receiptDropZone">
                        <input type="file" id="receiptFile" accept="image/*,application/pdf" required>
                        <div class="file-upload-content" id="uploadContent">
                            <i data-lucide="upload"></i>
                            <p>ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ê±°ë‚˜ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”</p>
                            <small>JPG, PNG, PDF íŒŒì¼ ì§€ì› (ìµœëŒ€ 5MB)</small>
                        </div>
                        
                        <!-- ğŸ“„ íŒŒì¼ ì„ íƒë¨ ìƒíƒœ í‘œì‹œ -->
                        <div id="fileSelectedContent" class="file-selected-content" style="display: none;">
                            <div class="file-info">
                                <i data-lucide="file-check" class="file-icon"></i>
                                <div class="file-details">
                                    <div id="receiptFileName" class="file-name"></div>
                                    <div id="receiptFileSize" class="file-size"></div>
                                </div>
                                <button type="button" id="removeReceiptBtn" class="btn small danger">
                                    <i data-lucide="x"></i>
                                    ì œê±°
                                </button>
                            </div>
                        </div>
                        
                        <!-- ğŸ–¼ï¸ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° -->
                        <div id="receiptPreview" class="receipt-preview" style="display: none;">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </div>
                    </div>
                </div>
                
                <!-- ğŸ“… êµ¬ë§¤ ë‚ ì§œ (ì‹œê°„ ì •ë³´ ì œê±°) -->
                <div class="form-group">
                    <label>êµ¬ë§¤ ë‚ ì§œ *</label>
                    <input type="date" id="purchaseDate" name="purchaseDate" required>
                    <small class="text-muted">ì˜ìˆ˜ì¦ì— í‘œì‹œëœ êµ¬ë§¤ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</small>
                </div>
                
                <div class="form-group">
                    <label>êµ¬ë§¤ì²˜</label>
                    <input type="text" id="purchaseStore" name="purchaseStore" placeholder="êµ¬ë§¤í•œ ìƒì ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <div class="form-group">
                    <label>ë¹„ê³ </label>
                    <textarea id="receiptNote" name="receiptNote" rows="2" placeholder="ì¶”ê°€ ì„¤ëª…ì´ ìˆìœ¼ë©´ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" id="receiptCancelBtn" class="btn secondary">ì·¨ì†Œ</button>
                    <button type="submit" class="btn primary">ì˜ìˆ˜ì¦ ì œì¶œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì‹œìŠ¤í…œ ì˜¤ë¥˜ ì•Œë¦¼ ëª¨ë‹¬ -->
    <div id="systemErrorModal" class="modal">
        <div class="modal-content">
            <h3>ì‹œìŠ¤í…œ ì˜¤ë¥˜</h3>
            <div id="systemErrorContent">
                <div class="error-info">
                    <i data-lucide="alert-triangle" style="width: 48px; height: 48px; color: #ef4444;"></i>
                    <div>
                        <h4>í˜ì´ì§€ë¥¼ ì •ìƒì ìœ¼ë¡œ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h4>
                        <p id="systemErrorMessage">ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
                <div class="error-actions">
                    <button id="refreshPageBtn" class="btn primary">
                        <i data-lucide="refresh-cw"></i>
                        í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    </button>
                    <button id="clearCacheBtn" class="btn secondary">
                        <i data-lucide="trash-2"></i>
                        ìºì‹œ ì§€ìš°ê³  ë‹¤ì‹œ ì‹œë„
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files - v4.2.2 ëª¨ë“ˆí™” ì‹œìŠ¤í…œ ë° ë¶€ë¶„ ë¡œë”© í—ˆìš© -->
    
    <!-- ğŸ”§ 1ë‹¨ê³„: í•µì‹¬ ì„¤ì • íŒŒì¼ë“¤ (ì˜ì¡´ì„± ìˆœì„œ) -->
    <script src="../js/config.js?v=4.2.2"></script>
    <script src="../js/auth.js?v=4.2.2"></script>
    <script src="../js/utils.js?v=4.2.2"></script>

    <!-- ğŸ”§ 2ë‹¨ê³„: Supabase ëª¨ë“ˆë“¤ (ì˜ì¡´ì„± ìˆœì„œ ì¤‘ìš”) -->
    <script src="../js/supabase/supabase-core.js?v=4.2.2"></script>
    <script src="../js/supabase/supabase-student.js?v=4.2.2"></script>
    <script src="../js/supabase/supabase-admin.js?v=4.2.2"></script>
    <script src="../js/supabase-client.js?v=4.2.2"></script>

    <!-- ğŸ”§ 3ë‹¨ê³„: í•™ìƒ ëª¨ë“ˆ ì‹œìŠ¤í…œ (ì˜ì¡´ì„± ìˆœì„œëŒ€ë¡œ) -->
    <script src="../js/student/api-helper.js?v=4.2.2"></script>
    <script src="../js/student/notification-system.js?v=4.2.2"></script>
    <script src="../js/student/lesson-plan-helper.js?v=4.2.2"></script>
    <script src="../js/student/equipment-request.js?v=4.2.2"></script>
    <script src="../js/student/shipping-management.js?v=4.2.2"></script>
    <script src="../js/student/receipt-management.js?v=4.2.2"></script>
    <script src="../js/student/flight-request.js?v=4.2.2"></script>

    <!-- ğŸ”§ 4ë‹¨ê³„: ìˆ˜ì—… ê³„íš ë° í†µí•© ë§¤ë‹ˆì € -->
    <script src="../js/lesson-plan.js?v=4.2.2"></script>
    <script src="../js/student.js?v=4.2.2"></script>

    <!-- ğŸ”§ 5ë‹¨ê³„: ëª¨ë“ˆ ë¡œë”© ì•ˆì „ì¥ì¹˜ ë° ì´ˆê¸°í™” ì‹œìŠ¤í…œ v4.2.2 -->
    <script>
        /**
         * ğŸš€ Equipment Request í˜ì´ì§€ ì´ˆê¸°í™” v4.2.2 - ë¶€ë¶„ ë¡œë”© í—ˆìš© ë° graceful degradation
         * - âœ… ë¶€ë¶„ ë¡œë”© í—ˆìš©: 80% ì´ìƒ ë¡œë“œë˜ë©´ ì§„í–‰
         * - âœ… í•„ìˆ˜ ëª¨ë“ˆë§Œ ì—„ê²© ì²´í¬: í•µì‹¬ ê¸°ëŠ¥ë§Œ í•„ìˆ˜
         * - âœ… íƒ€ì„ì•„ì›ƒ ì‹œê°„ ì—°ì¥: 20ì´ˆ
         * - âœ… ìƒì„¸í•œ ë””ë²„ê¹… ì •ë³´ ì œê³µ
         * - âœ… graceful degradation: ì„ íƒì  ëª¨ë“ˆ ì—†ì–´ë„ ì§„í–‰
         */

        // ğŸ›¡ï¸ ëª¨ë“ˆ ë¡œë”© ìƒíƒœ ì¶”ì  v4.2.2
        window.ModuleStatusTracker = {
            modules: {
                // í•„ìˆ˜ ëª¨ë“ˆ (ë°˜ë“œì‹œ ë¡œë“œë˜ì–´ì•¼ í•¨)
                CONFIG: false,
                AUTH: false,
                UTILS: false,
                SUPABASE_CORE: false,
                SUPABASE_CLIENT: false,
                STUDENT_MANAGER: false,
                
                // ì„ íƒì  ëª¨ë“ˆ (ì—†ì–´ë„ ê¸°ë³¸ ê¸°ëŠ¥ ë™ì‘)
                SUPABASE_STUDENT: false,
                SUPABASE_ADMIN: false,
                API_HELPER: false,
                NOTIFICATION_SYSTEM: false,
                LESSON_PLAN_HELPER: false,
                EQUIPMENT_REQUEST: false,
                SHIPPING_MANAGEMENT: false,
                RECEIPT_MANAGEMENT: false,
                FLIGHT_REQUEST: false,
                LESSON_PLAN: false
            },
            isInitialized: false,
            
            updateStatus: function() {
                if (this.isInitialized) return; // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
                
                // í•„ìˆ˜ ëª¨ë“ˆ
                this.modules.CONFIG = typeof CONFIG !== 'undefined';
                this.modules.AUTH = typeof AuthManager !== 'undefined';
                this.modules.UTILS = typeof checkConnection !== 'undefined';
                this.modules.SUPABASE_CORE = typeof SupabaseCore !== 'undefined';
                this.modules.SUPABASE_CLIENT = typeof SupabaseAPI !== 'undefined';
                this.modules.STUDENT_MANAGER = typeof StudentManager !== 'undefined';
                
                // ì„ íƒì  ëª¨ë“ˆ
                this.modules.SUPABASE_STUDENT = typeof SupabaseStudent !== 'undefined';
                this.modules.SUPABASE_ADMIN = typeof SupabaseAdmin !== 'undefined';
                this.modules.API_HELPER = typeof ApiHelper !== 'undefined';
                this.modules.NOTIFICATION_SYSTEM = typeof NotificationSystem !== 'undefined';
                this.modules.LESSON_PLAN_HELPER = typeof LessonPlanHelper !== 'undefined';
                this.modules.EQUIPMENT_REQUEST = typeof EquipmentRequestModule !== 'undefined';
                this.modules.SHIPPING_MANAGEMENT = typeof ShippingManagement !== 'undefined';
                this.modules.RECEIPT_MANAGEMENT = typeof ReceiptManagement !== 'undefined';
                this.modules.FLIGHT_REQUEST = typeof FlightRequestModule !== 'undefined';
                this.modules.LESSON_PLAN = typeof LessonPlanManager !== 'undefined';
            },
            
            checkRequiredModules: function() {
                this.updateStatus();
                
                // í•„ìˆ˜ ëª¨ë“ˆë§Œ ì²´í¬
                const requiredModules = [
                    'CONFIG', 'AUTH', 'UTILS', 'SUPABASE_CORE', 'SUPABASE_CLIENT', 'STUDENT_MANAGER'
                ];
                
                const missingRequired = requiredModules.filter(module => !this.modules[module]);
                
                if (missingRequired.length === 0) {
                    return true;
                }
                
                console.error('âŒ ëˆ„ë½ëœ í•„ìˆ˜ ëª¨ë“ˆ:', missingRequired);
                return false;
            },
            
            checkPartialLoading: function() {
                this.updateStatus();
                
                const loadedCount = Object.values(this.modules).filter(Boolean).length;
                const totalCount = Object.keys(this.modules).length;
                const percentage = Math.round((loadedCount / totalCount) * 100);
                
                // 80% ì´ìƒ ë¡œë“œë˜ë©´ ë¶€ë¶„ ë¡œë”© í—ˆìš©
                if (percentage >= 80) {
                    return true;
                }
                
                return false;
            },
            
            checkAllModules: function() {
                if (this.isInitialized) return true; // ì¤‘ë³µ í™•ì¸ ë°©ì§€
                
                // 1. í•„ìˆ˜ ëª¨ë“ˆ ì²´í¬
                if (this.checkRequiredModules()) {
                    this.isInitialized = true;
                    return true;
                }
                
                // 2. ë¶€ë¶„ ë¡œë”© ì²´í¬ (80% ì´ìƒ)
                if (this.checkPartialLoading()) {
                    console.warn('âš ï¸ ë¶€ë¶„ ë¡œë”©ìœ¼ë¡œ ì§„í–‰ (ì¼ë¶€ ê¸°ëŠ¥ ì œí•œ ê°€ëŠ¥)');
                    this.isInitialized = true;
                    return true;
                }
                
                return false;
            },
            
            getStatus: function() {
                this.updateStatus();
                const loadedCount = Object.values(this.modules).filter(Boolean).length;
                const totalCount = Object.keys(this.modules).length;
                
                // í•„ìˆ˜/ì„ íƒì  ëª¨ë“ˆ êµ¬ë¶„í•˜ì—¬ ìƒíƒœ ë°˜í™˜
                const requiredModules = ['CONFIG', 'AUTH', 'UTILS', 'SUPABASE_CORE', 'SUPABASE_CLIENT', 'STUDENT_MANAGER'];
                const requiredLoaded = requiredModules.filter(module => this.modules[module]).length;
                const requiredTotal = requiredModules.length;
                
                return {
                    loaded: loadedCount,
                    total: totalCount,
                    percentage: Math.round((loadedCount / totalCount) * 100),
                    requiredLoaded: requiredLoaded,
                    requiredTotal: requiredTotal,
                    requiredPercentage: Math.round((requiredLoaded / requiredTotal) * 100),
                    modules: this.modules,
                    missingRequired: requiredModules.filter(module => !this.modules[module]),
                    missingOptional: Object.keys(this.modules).filter(module => 
                        !requiredModules.includes(module) && !this.modules[module])
                };
            }
        };

        // ğŸ†• ì‹œìŠ¤í…œ ì˜¤ë¥˜ ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
        function showSystemErrorModal(errorMessage) {
            try {
                const modal = document.getElementById('systemErrorModal');
                const messageEl = document.getElementById('systemErrorMessage');
                
                if (modal && messageEl) {
                    messageEl.textContent = errorMessage || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    modal.style.display = 'flex';
                    
                    // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼
                    const refreshBtn = document.getElementById('refreshPageBtn');
                    if (refreshBtn) {
                        refreshBtn.onclick = function() {
                            window.location.reload(true);
                        };
                    }
                    
                    // ìºì‹œ ì§€ìš°ê¸° ë²„íŠ¼
                    const clearCacheBtn = document.getElementById('clearCacheBtn');
                    if (clearCacheBtn) {
                        clearCacheBtn.onclick = function() {
                            if ('caches' in window) {
                                caches.keys().then(function(names) {
                                    names.forEach(function(name) {
                                        caches.delete(name);
                                    });
                                }).finally(function() {
                                    localStorage.clear();
                                    sessionStorage.clear();
                                    window.location.reload(true);
                                });
                            } else {
                                localStorage.clear();
                                sessionStorage.clear();
                                window.location.reload(true);
                            }
                        };
                    }
                }
            } catch (error) {
                console.error('âŒ ì‹œìŠ¤í…œ ì˜¤ë¥˜ ëª¨ë‹¬ í‘œì‹œ ì‹¤íŒ¨:', error);
                alert('í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”: ' + (errorMessage || 'ì‹œìŠ¤í…œ ì˜¤ë¥˜'));
            }
        }

        // ğŸ”§ ëª¨ë“ˆ ë¡œë”© ì™„ë£Œ ëŒ€ê¸° í•¨ìˆ˜ v4.2.2 (ë¶€ë¶„ ë¡œë”© í—ˆìš©)
        function waitForModulesReady(maxWait = 20000) {
            return new Promise(function(resolve, reject) {
                const startTime = Date.now();
                const checkInterval = 500;
                
                function checkModules() {
                    const status = window.ModuleStatusTracker.getStatus();
                    
                    // ìƒì„¸í•œ ë¡œë”© ìƒíƒœ ë¡œê·¸ (ì˜¤ë¥˜ë§Œ í‘œì‹œ)
                    if (status.loaded < status.total) {
                        if (status.missingRequired.length > 0) {
                            console.error('âŒ ëˆ„ë½ëœ í•„ìˆ˜ ëª¨ë“ˆ:', status.missingRequired);
                        }
                    }
                    
                    if (window.ModuleStatusTracker.checkAllModules()) {
                        resolve();
                        return;
                    }
                    
                    const elapsedTime = Date.now() - startTime;
                    if (elapsedTime >= maxWait) {
                        console.error('âŒ ëª¨ë“ˆ ë¡œë”© ì‹œê°„ ì´ˆê³¼ v4.2.2:', status);
                        
                        // í•„ìˆ˜ ëª¨ë“ˆì´ ëª¨ë‘ ë¡œë“œë˜ì—ˆë‹¤ë©´ ë¶€ë¶„ ì§„í–‰
                        if (status.requiredPercentage === 100) {
                            console.warn('âš ï¸ í•„ìˆ˜ ëª¨ë“ˆë§Œìœ¼ë¡œ ë¶€ë¶„ ì§„í–‰');
                            resolve();
                            return;
                        }
                        
                        reject(new Error('ëª¨ë“ˆ ë¡œë”© ì‹œê°„ ì´ˆê³¼'));
                        return;
                    }
                    
                    setTimeout(checkModules, checkInterval);
                }
                
                checkModules();
            });
        }

        // ğŸ¯ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ë° UI ì—…ë°ì´íŠ¸
        function getCurrentUserSafely() {
            try {
                // ApiHelper ëª¨ë“ˆ ì‚¬ìš© (ì„ íƒì )
                if (typeof window.ApiHelper !== 'undefined' && window.ApiHelper.getCurrentUserSafely) {
                    return window.ApiHelper.getCurrentUserSafely();
                }

                // í´ë°±: localStorage
                const currentStudentData = localStorage.getItem('currentStudent');
                if (currentStudentData) {
                    try {
                        const studentData = JSON.parse(currentStudentData);
                        if (studentData && studentData.id) {
                            return studentData;
                        }
                    } catch (parseError) {
                        console.error('âŒ localStorage íŒŒì‹± ì˜¤ë¥˜:', parseError);
                    }
                }

                return null;
            } catch (error) {
                console.error('âŒ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
                return null;
            }
        }

        // ğŸ†• ìˆ˜ì—…ê³„íš ìƒíƒœ í™•ì¸ ë° í˜ì´ì§€ ë¶„ê¸° (ì˜¤ë¥˜ í—ˆìš©)
        async function checkLessonPlanStatusAndSetPage() {
            try {
                const currentUser = getCurrentUserSafely();
                if (!currentUser) {
                    console.error('âŒ ì‚¬ìš©ì ì •ë³´ ì—†ìŒ - ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™');
                    redirectToLogin();
                    return;
                }

                // SupabaseAPIë¥¼ í†µí•œ ìˆ˜ì—…ê³„íš ì¡°íšŒ (í•„ìˆ˜ ëª¨ë“ˆì´ë¯€ë¡œ ì•ˆì „)
                const client = await SupabaseAPI.ensureClient();
                const { data: lessonPlan, error } = await client
                    .from('lesson_plans')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .single();

                if (error && error.code !== 'PGRST116') {
                    console.error('âŒ ìˆ˜ì—…ê³„íš ì¡°íšŒ ì˜¤ë¥˜:', error);
                    showLessonPlanPage();
                    return;
                }

                if (!lessonPlan) {
                    showLessonPlanPage();
                } else {
                    showStudentPage();
                }

            } catch (error) {
                console.error('âŒ ìˆ˜ì—…ê³„íš ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ê¸°ë³¸ í˜ì´ì§€ í‘œì‹œ
                showStudentPage();
            }
        }

        // ìˆ˜ì—…ê³„íš í˜ì´ì§€ í‘œì‹œ
        function showLessonPlanPage() {
            try {
                const studentPage = document.getElementById('studentPage');
                const lessonPlanPage = document.getElementById('lessonPlanPage');
                
                if (studentPage && lessonPlanPage) {
                    studentPage.classList.remove('active');
                    lessonPlanPage.classList.add('active');
                    
                    setTimeout(() => {
                        if (window.LessonPlanManager && typeof window.LessonPlanManager.showLessonPlanPage === 'function') {
                            window.LessonPlanManager.showLessonPlanPage('create');
                        }
                    }, 200);
                }
            } catch (error) {
                console.error('âŒ ìˆ˜ì—…ê³„íš í˜ì´ì§€ í‘œì‹œ ì˜¤ë¥˜:', error);
            }
        }

        // êµêµ¬ì‹ ì²­ í˜ì´ì§€ í‘œì‹œ
        function showStudentPage() {
            try {
                const studentPage = document.getElementById('studentPage');
                const lessonPlanPage = document.getElementById('lessonPlanPage');
                
                if (studentPage && lessonPlanPage) {
                    lessonPlanPage.classList.remove('active');
                    studentPage.classList.add('active');
                }
            } catch (error) {
                console.error('âŒ êµêµ¬ì‹ ì²­ í˜ì´ì§€ í‘œì‹œ ì˜¤ë¥˜:', error);
            }
        }

        // ğŸ¯ ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì •
        function setupNavigation() {
            // ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
            const backBtn = document.getElementById('backToDashboard');
            if (backBtn) {
                backBtn.addEventListener('click', function() {
                    window.location.href = 'dashboard.html';
                });
            }

            // ìˆ˜ì—…ê³„íš ë²„íŠ¼
            const lessonPlanBtn = document.getElementById('lessonPlanBtn');
            if (lessonPlanBtn) {
                lessonPlanBtn.addEventListener('click', function() {
                    if (typeof StudentManager !== 'undefined' && 
                        typeof StudentManager.handleLessonPlanClick === 'function') {
                        try {
                            StudentManager.handleLessonPlanClick();
                        } catch (error) {
                            console.error('âŒ ìˆ˜ì—…ê³„íš ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                            alert('ìˆ˜ì—…ê³„íš ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                        }
                    } else {
                        alert('ì‹œìŠ¤í…œì´ ì•„ì§ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    }
                });
            }

            // ë°°ì†¡ì§€ ì„¤ì • ë²„íŠ¼
            const shippingAddressBtn = document.getElementById('shippingAddressBtn');
            if (shippingAddressBtn) {
                shippingAddressBtn.addEventListener('click', function() {
                    if (typeof StudentManager !== 'undefined' && 
                        typeof StudentManager.handleShippingClick === 'function') {
                        StudentManager.handleShippingClick();
                    } else {
                        alert('ë°°ì†¡ì§€ ì„¤ì • ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                });
            }
        }

        // ğŸ†• v4.3.0 ë¬¶ìŒ ì‹ ì²­ UI ì´ë²¤íŠ¸ ì„¤ì • (í˜¸í™˜ì„± ìœ ì§€)
        function setupBundleModalEvents() {
            try {
                // êµ¬ë§¤ ë°©ì‹ ë¼ë””ì˜¤ ë²„íŠ¼ ì´ë²¤íŠ¸
                const bundlePurchaseMethodRadios = document.querySelectorAll('input[name="bundlePurchaseMethod"]');
                bundlePurchaseMethodRadios.forEach(function(radio) {
                    radio.addEventListener('change', function() {
                        if (radio.checked && typeof window.toggleBundlePurchaseInfo === 'function') {
                            window.toggleBundlePurchaseInfo(radio.value);
                        }
                    });
                });

                // êµ¬ë§¤ ì‚¬ì´íŠ¸ ì„ íƒ ë³€ê²½ ì´ë²¤íŠ¸
                const purchaseSiteSelect = document.getElementById('purchaseSite');
                if (purchaseSiteSelect && typeof window.handlePurchaseSiteChange === 'function') {
                    purchaseSiteSelect.addEventListener('change', window.handlePurchaseSiteChange);
                }

                // ì´ˆê¸° ìƒíƒœ ì„¤ì •
                if (typeof window.toggleBundlePurchaseInfo === 'function') {
                    window.toggleBundlePurchaseInfo('online');
                }
            } catch (error) {
                console.error('âŒ ë¬¶ìŒ ì‹ ì²­ UI ì´ë²¤íŠ¸ ì„¤ì • ì˜¤ë¥˜:', error);
            }
        }

        // v4.3.0 í˜¸í™˜ì„± í•¨ìˆ˜ë“¤
        window.toggleBundlePurchaseInfo = function(method) {
            const onlineInfo = document.getElementById('onlinePurchaseInfo');
            const offlineInfo = document.getElementById('offlinePurchaseInfo');
            
            if (method === 'online') {
                if (onlineInfo) onlineInfo.style.display = 'block';
                if (offlineInfo) offlineInfo.style.display = 'none';
                
                setFieldRequired('purchaseSite', true);
                setFieldRequired('accountId', true);
                setFieldRequired('accountPassword', true);
                setFieldRequired('offlineVendor', false);
                
            } else if (method === 'offline') {
                if (onlineInfo) onlineInfo.style.display = 'none';
                if (offlineInfo) offlineInfo.style.display = 'block';
                
                setFieldRequired('purchaseSite', false);
                setFieldRequired('accountId', false);
                setFieldRequired('accountPassword', false);
                setFieldRequired('offlineVendor', true);
            }
        };

        window.handlePurchaseSiteChange = function() {
            const siteSelect = document.getElementById('purchaseSite');
            const otherSiteInput = document.getElementById('otherSite');
            
            if (siteSelect && otherSiteInput) {
                if (siteSelect.value === 'other') {
                    otherSiteInput.style.display = 'block';
                    otherSiteInput.required = true;
                } else {
                    otherSiteInput.style.display = 'none';
                    otherSiteInput.required = false;
                    otherSiteInput.value = '';
                }
            }
        };

        function setFieldRequired(fieldId, required) {
            const field = document.getElementById(fieldId);
            if (field) {
                field.required = required;
                
                const label = document.querySelector(`label[for="${fieldId}"]`) || 
                            field.closest('.form-group')?.querySelector('label');
                if (label) {
                    const text = label.textContent.replace(' *', '');
                    label.textContent = required ? text + ' *' : text;
                }
            }
        }

        function redirectToLogin() {
            if (confirm('ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.clear();
                sessionStorage.clear();
                window.location.href = '../index.html';
            }
        }

        // ğŸš€ ë©”ì¸ ì´ˆê¸°í™” í•¨ìˆ˜ v4.2.2 (ë¶€ë¶„ ë¡œë”© í—ˆìš©)
        async function initializeEquipmentRequestPage() {
            try {
                // ëª¨ë“ˆ ë¡œë”© ëŒ€ê¸° (ë¶€ë¶„ ë¡œë”© í—ˆìš©)
                await waitForModulesReady();
                
                // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ë° UI ì—…ë°ì´íŠ¸
                const currentUser = getCurrentUserSafely();
                if (!currentUser) {
                    throw new Error('ë¡œê·¸ì¸ ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤');
                }

                // ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ì—…ë°ì´íŠ¸
                const welcomeEl = document.getElementById('studentWelcome');
                if (welcomeEl) {
                    welcomeEl.textContent = `${currentUser.name}ë‹˜ì˜ êµêµ¬ ì‹ ì²­`;
                }
                
                const detailsEl = document.getElementById('studentDetails');
                if (detailsEl) {
                    const institute = currentUser.sejong_institute || 'ì„¸ì¢…í•™ë‹¹';
                    const field = currentUser.field || '';
                    detailsEl.textContent = field ? `${institute} - ${field}` : institute;
                }

                // ìˆ˜ì—…ê³„íš ìƒíƒœ í™•ì¸ ë° í˜ì´ì§€ ë¶„ê¸° (ì˜¤ë¥˜ í—ˆìš©)
                await checkLessonPlanStatusAndSetPage();
                
                // StudentManager ì´ˆê¸°í™” (ì•ˆì „í•œ ì²´í¬)
                const studentPage = document.getElementById('studentPage');
                if (studentPage && studentPage.classList.contains('active')) {
                    if (typeof StudentManager !== 'undefined') {
                        try {
                            await StudentManager.init();
                        } catch (managerError) {
                            console.error('âŒ StudentManager ì´ˆê¸°í™” ì˜¤ë¥˜ (ê³„ì† ì§„í–‰):', managerError);
                        }
                    }
                }
                
                // ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì •
                setupNavigation();
                
                // v4.3.0 ë¬¶ìŒ ì‹ ì²­ UI ì´ë²¤íŠ¸ ì„¤ì •
                setupBundleModalEvents();
                
            } catch (error) {
                console.error('âŒ í˜ì´ì§€ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                
                if (error.message.includes('ë¡œê·¸ì¸ ì„¸ì…˜')) {
                    setTimeout(function() {
                        alert('ë¡œê·¸ì¸ ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                        window.location.href = '../index.html';
                    }, 1000);
                } else {
                    showSystemErrorModal('í˜ì´ì§€ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            }
        }

        // ğŸ¯ DOM ë¡œë“œ ì™„ë£Œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            // Lucide ì•„ì´ì½˜ ì´ˆê¸°í™”
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì™„ë£Œê¹Œì§€ ì ì‹œ ëŒ€ê¸° í›„ ì´ˆê¸°í™”
            setTimeout(function() {
                initializeEquipmentRequestPage();
            }, 1000); // 1000ms ëŒ€ê¸° (ì•ˆì •ì„± í™•ë³´)
        });

        // ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬ (ì˜¤ë¥˜ë§Œ í‘œì‹œ)
        window.addEventListener('error', function(event) {
            console.error('âŒ ì „ì—­ ìŠ¤í¬ë¦½íŠ¸ ì˜¤ë¥˜:', {
                message: event.message,
                filename: event.filename,
                lineno: event.lineno
            });
            
            if (typeof showSystemErrorModal === 'function') {
                showSystemErrorModal(event.message);
            }
        });
    </script>
    
    <!-- v4.2.2 UI ê°œì„  ìŠ¤íƒ€ì¼ (í•™ìƒ ì¹œí™”ì ) -->
    <style>
        /* í˜ì´ì§€ ì „í™˜ ìŠ¤íƒ€ì¼ */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* ğŸ†• v4.3.0 ë²„ì „ ë°°ì§€ (í˜¸í™˜ì„± ìœ ì§€) */
        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, #3b82f6, #10b981);
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 12px;
            margin-left: 8px;
            vertical-align: middle;
        }

        /* ğŸ†• v4.3.0 ë¬¶ìŒ ì‹ ì²­ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ê°œì„  (í˜¸í™˜ì„± ìœ ì§€) */
        .bundle-intro {
            background: linear-gradient(135deg, #f0f9ff, #ecfdf5);
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .bundle-intro p {
            margin: 0;
            color: #0f172a;
            font-size: 0.875rem;
        }

        /* í¼ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .form-section {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-section h4 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0 0 1rem 0;
            color: #1e293b;
            font-size: 1rem;
            font-weight: 600;
        }

        .form-section h4 i {
            width: 1.25rem;
            height: 1.25rem;
            color: #3b82f6;
        }

        .form-section h5 {
            margin: 0 0 0.5rem 0;
            color: #1e293b;
            font-size: 0.875rem;
            font-weight: 600;
        }

        /* ğŸ” ê³„ì • ì •ë³´ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .account-info-section {
            background: #fff7ed;
            border: 1px solid #fb923c;
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .account-info-header {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .account-info-header i {
            width: 1.5rem;
            height: 1.5rem;
            color: #ea580c;
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* ğŸª ì˜¤í”„ë¼ì¸ êµ¬ë§¤ ì•ˆë‚´ ìŠ¤íƒ€ì¼ */
        .offline-notice {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .offline-notice i {
            width: 1.25rem;
            height: 1.25rem;
            color: #0284c7;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .offline-notice ul {
            margin: 0.5rem 0 0 0;
            padding-left: 1.25rem;
        }

        .offline-notice li {
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
            color: #0f172a;
        }

        /* ğŸ¯ êµ¬ë§¤ ë°©ì‹ ì˜µì…˜ ê°œì„  ìŠ¤íƒ€ì¼ */
        .radio-option.enhanced {
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .radio-option.enhanced:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }

        .radio-option.enhanced:has(input:checked) {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }

        .method-features {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .feature-tag {
            display: inline-block;
            background: #e0e7ff;
            color: #3730a3;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 12px;
        }

        /* ì‹œìŠ¤í…œ ì˜¤ë¥˜ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        #systemErrorModal .modal-content {
            max-width: 500px;
            text-align: center;
        }
        
        #systemErrorModal .error-info {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 2rem;
            text-align: left;
        }
        
        #systemErrorModal .error-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
        
        #systemErrorModal .error-actions .btn {
            flex: 1;
            max-width: 200px;
        }
        
        /* ğŸ†• ì˜ìˆ˜ì¦ íŒŒì¼ ì—…ë¡œë“œ ê°œì„  ìŠ¤íƒ€ì¼ */
        .file-upload-area {
            position: relative;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .file-upload-area:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }
        
        .file-upload-area.drag-over {
            border-color: #10b981;
            background-color: #ecfdf5;
        }
        
        .file-upload-area input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .file-upload-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }
        
        .file-upload-content i {
            width: 3rem;
            height: 3rem;
            color: #6b7280;
        }
        
        .file-upload-content p {
            color: #374151;
            margin: 0;
        }
        
        .file-upload-content small {
            color: #6b7280;
        }
        
        /* ğŸ“„ íŒŒì¼ ì„ íƒë¨ ìƒíƒœ ìŠ¤íƒ€ì¼ */
        .file-selected-content {
            display: none;
        }
        
        .file-selected-content.active {
            display: block;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background-color: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 6px;
        }
        
        .file-icon {
            width: 2rem;
            height: 2rem;
            color: #0ea5e9;
            flex-shrink: 0;
        }
        
        .file-details {
            flex: 1;
            min-width: 0;
        }
        
        .file-name {
            font-weight: 500;
            color: #0f172a;
            word-break: break-all;
        }
        
        .file-size {
            font-size: 0.875rem;
            color: #64748b;
            margin-top: 0.25rem;
        }
        
        /* ğŸ–¼ï¸ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ìŠ¤íƒ€ì¼ */
        .receipt-preview {
            margin-top: 1rem;
            text-align: center;
        }
        
        .receipt-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .receipt-preview .file-info {
            display: inline-block;
            background-color: #f1f5f9;
            border: 1px solid #cbd5e1;
            padding: 0.75rem 1rem;
        }
        
        /* ë°˜ì‘í˜• ì¡°ì • */
        @media (max-width: 768px) {
            .header-actions {
                flex-direction: column;
                gap: 8px;
            }
            
            .header-actions .btn {
                width: 100%;
                justify-content: center;
            }
            
            #systemErrorModal .error-actions {
                flex-direction: column;
            }
            
            #systemErrorModal .error-actions .btn {
                max-width: none;
            }
            
            .file-info {
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }
            
            .file-details {
                order: -1;
            }

            /* v4.2.2 ëª¨ë°”ì¼ ë°˜ì‘í˜• */
            .form-section {
                padding: 1rem;
            }

            .account-info-header {
                flex-direction: column;
                gap: 0.5rem;
            }

            .method-features {
                flex-direction: column;
            }

            .feature-tag {
                align-self: flex-start;
            }
        }
    </style>
</body>
</html>