<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¸ì¢…í•™ë‹¹ ë¬¸í™”ì¸í„´ ì§€ì› ì‹œìŠ¤í…œ - ê´€ë¦¬ì</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/login.css">
    
    <!-- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì „ìš© ìŠ¤íƒ€ì¼ -->
    <style>
        .dashboard-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            padding: 2rem;
        }

        .dashboard-header {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .welcome-section {
            text-align: center;
            margin-bottom: 2rem;
        }

        .welcome-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            color: #718096;
            margin-bottom: 1rem;
        }

        .admin-info {
            background: #2d3748;
            color: white;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .admin-info h3 {
            margin: 0 0 0.5rem 0;
            color: white;
        }

        .admin-info p {
            margin: 0;
            color: #cbd5e0;
        }

        /* ê¸°ëŠ¥ í™œì„±í™” ê´€ë¦¬ ì„¹ì…˜ */
        .feature-settings-section {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .feature-settings-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feature-list {
            display: grid;
            gap: 1rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .feature-item {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .feature-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .feature-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
        }

        .feature-icon {
            width: 3rem;
            height: 3rem;
            background: linear-gradient(135deg, #2d3748, #4a5568);
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .feature-icon i {
            width: 1.5rem;
            height: 1.5rem;
        }

        .feature-details h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d3748;
            margin: 0 0 0.25rem 0;
        }

        .feature-details p {
            font-size: 0.875rem;
            color: #718096;
            margin: 0;
        }

        .feature-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .feature-status {
            font-size: 0.875rem;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            min-width: 4rem;
            text-align: center;
        }

        .feature-status.active {
            background: #c6f6d5;
            color: #22543d;
        }

        .feature-status.inactive {
            background: #fed7d7;
            color: #c53030;
        }

        /* í† ê¸€ ìŠ¤ìœ„ì¹˜ */
        .toggle-switch {
            position: relative;
            width: 3.5rem;
            height: 2rem;
            background: #cbd5e0;
            border-radius: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .toggle-switch.active {
            background: #48bb78;
        }

        .toggle-switch::before {
            content: '';
            position: absolute;
            top: 0.125rem;
            left: 0.125rem;
            width: 1.75rem;
            height: 1.75rem;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.active::before {
            transform: translateX(1.5rem);
        }

        /* ê´€ë¦¬ ë©”ë‰´ ê·¸ë¦¬ë“œ */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .menu-card {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .menu-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #2d3748, #4a5568);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .menu-card:hover::before {
            transform: scaleX(1);
        }

        .menu-icon {
            width: 4rem;
            height: 4rem;
            margin: 0 auto 1.5rem;
            background: linear-gradient(135deg, #2d3748, #4a5568);
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .menu-icon i {
            width: 2rem;
            height: 2rem;
        }

        .menu-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 1rem;
            text-align: center;
        }

        .menu-description {
            color: #718096;
            line-height: 1.6;
            margin-bottom: 2rem;
            text-align: center;
        }

        .menu-button {
            width: 100%;
            background: linear-gradient(135deg, #2d3748, #4a5568);
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .menu-button:hover {
            background: linear-gradient(135deg, #1a202c, #2d3748);
            transform: translateY(-2px);
        }

        .logout-section {
            text-align: center;
            margin-top: 2rem;
        }

        .logout-btn {
            background: #fed7d7;
            color: #c53030;
            border: 2px solid #fc8181;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #fc8181;
            color: white;
        }

        /* ë¡œë”© ìƒíƒœ */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .loading .toggle-switch {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ì´ˆê¸°í™” ìƒíƒœ í‘œì‹œ */
        .init-status {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #1a202c;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            z-index: 1000;
            max-width: 300px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .init-status.success {
            background: #22543d;
        }

        .init-status.error {
            background: #c53030;
        }

        .init-status.warning {
            background: #d69e2e;
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 1rem;
            }

            .dashboard-header {
                padding: 1.5rem;
            }

            .welcome-title {
                font-size: 2rem;
            }

            .menu-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .menu-card {
                padding: 1.5rem;
            }

            .feature-list {
                gap: 0.75rem;
            }

            .feature-item {
                padding: 1rem;
                flex-direction: column;
                text-align: center;
            }

            .feature-controls {
                margin-top: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ í˜ì´ì§€ -->
        <div id="loginPage" class="page active">
            <div class="login-container">
                <div class="login-card">
                    <div class="login-header">
                        <h1>ì„¸ì¢…í•™ë‹¹ ë¬¸í™”ì¸í„´ ì§€ì› ì‹œìŠ¤í…œ</h1>
                        <p>Cultural Intern Support System - Administrator</p>
                    </div>

                    <div id="adminLogin" class="login-form active">
                        <div class="form-group">
                            <label>ê´€ë¦¬ì ì½”ë“œ</label>
                            <input type="password" id="adminCode" placeholder="ê´€ë¦¬ì ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                        </div>
                        <button id="adminLoginBtn" class="login-btn admin">
                            <i data-lucide="log-in"></i>
                            ê´€ë¦¬ì ë¡œê·¸ì¸
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ -->
        <div id="adminPage" class="page">
            <div class="dashboard-container">
                <!-- í—¤ë” ì„¹ì…˜ -->
                <div class="dashboard-header">
                    <div class="welcome-section">
                        <h1 class="welcome-title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
                        <p class="welcome-subtitle">Cultural Intern Support System - Administrator</p>
                    </div>
                    
                    <div class="admin-info">
                        <h3>ê´€ë¦¬ìë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!</h3>
                        <p>ì„¸ì¢…í•™ë‹¹ ë¬¸í™”ì¸í„´ ì§€ì› ì‹œìŠ¤í…œì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>

                <!-- ê¸°ëŠ¥ í™œì„±í™” ê´€ë¦¬ ì„¹ì…˜ -->
                <div class="feature-settings-section">
                    <h2 class="feature-settings-title">
                        <i data-lucide="settings"></i>
                        ê¸°ëŠ¥ í™œì„±í™” ê´€ë¦¬
                    </h2>
                    <div class="feature-list" id="featureList">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>

                <!-- ê´€ë¦¬ ë©”ë‰´ ê·¸ë¦¬ë“œ -->
                <div class="menu-grid">
                    <!-- íŒŒê²¬ í•™ë‹¹ ì •ë³´ ê´€ë¦¬ -->
                    <div class="menu-card" onclick="navigateToInstituteManagement()">
                        <div class="menu-icon">
                            <i data-lucide="building"></i>
                        </div>
                        <h2 class="menu-title">íŒŒê²¬ í•™ë‹¹ ì •ë³´ ê´€ë¦¬</h2>
                        <p class="menu-description">
                            ì„¸ì¢…í•™ë‹¹ ì •ë³´ë¥¼ ë“±ë¡í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.<br>
                            í•™ìƒ ë°°ì • ë° í˜„ì§€ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>
                        <button class="menu-button">
                            <i data-lucide="arrow-right"></i>
                            ê´€ë¦¬í•˜ê¸°
                        </button>
                    </div>

                    <!-- í•­ê³µê¶Œ êµ¬ë§¤ ì‹ ì²­ ê´€ë¦¬ -->
                    <div class="menu-card" onclick="navigateToFlightManagement()">
                        <div class="menu-icon">
                            <i data-lucide="plane"></i>
                        </div>
                        <h2 class="menu-title">í•­ê³µê¶Œ êµ¬ë§¤ ì‹ ì²­ ê´€ë¦¬</h2>
                        <p class="menu-description">
                            í•™ìƒë“¤ì˜ í•­ê³µê¶Œ êµ¬ë§¤ ì‹ ì²­ì„ ê²€í† í•˜ê³ <br>
                            ìŠ¹ì¸ ì²˜ë¦¬ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>
                        <button class="menu-button">
                            <i data-lucide="arrow-right"></i>
                            ê´€ë¦¬í•˜ê¸°
                        </button>
                    </div>

                    <!-- êµêµ¬ êµ¬ë§¤ ì‹ ì²­ ê´€ë¦¬ -->
                    <div class="menu-card" onclick="navigateToEquipmentManagement()">
                        <div class="menu-icon">
                            <i data-lucide="package"></i>
                        </div>
                        <h2 class="menu-title">êµêµ¬ êµ¬ë§¤ ì‹ ì²­ ê´€ë¦¬</h2>
                        <p class="menu-description">
                            í•™ìƒë“¤ì˜ êµêµ¬ ì‹ ì²­ì„ ê²€í† í•˜ê³ <br>
                            ì˜ˆì‚° ìŠ¹ì¸ ë° êµ¬ë§¤ ì²˜ë¦¬ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>
                        <button class="menu-button">
                            <i data-lucide="arrow-right"></i>
                            ê´€ë¦¬í•˜ê¸°
                        </button>
                    </div>
                </div>

                <!-- ë¡œê·¸ì•„ì›ƒ ì„¹ì…˜ -->
                <div class="logout-section">
                    <button class="logout-btn" onclick="handleLogout()">
                        <i data-lucide="log-out"></i>
                        ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì´ˆê¸°í™” ìƒíƒœ í‘œì‹œ -->
    <div id="initStatus" class="init-status" style="display: none;">
        ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...
    </div>

    <!-- JavaScript Files - Fixed CDN URLs -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/supabase-client.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    
    <!-- ğŸ†• ëª¨ë“ˆí™”ëœ Admin íŒŒì¼ë“¤ (ìˆœì„œ ì¤‘ìš”!) -->
    <!-- í•µì‹¬ íŒŒì¼ë“¤ ë¨¼ì € ë¡œë“œ -->
    <script src="js/admin/admin-core.js"></script>
    <script src="js/admin/admin-utils.js"></script>
    <script src="js/admin/admin-modals.js"></script>
    
    <!-- ê¸°ëŠ¥ë³„ ëª¨ë“ˆë“¤ -->
    <script src="js/admin/admin-budget.js"></script>
    <script src="js/admin/admin-lesson-plans.js"></script>
    <script src="js/admin/admin-applications.js"></script>
    <script src="js/admin/admin-features.js"></script>
    
    <!-- í˜ì´ì§€ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // ì „ì—­ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¡œ ì¶©ëŒ ë°©ì§€
        window.AdminPageController = (function() {
            'use strict';
            
            // ì´ˆê¸°í™” ìƒíƒœ ê´€ë¦¬ (ê³ ìœ  ë³€ìˆ˜ëª… ì‚¬ìš©)
            const adminInitState = {
                configLoaded: false,
                supabaseInitialized: false,
                adminManagerReady: false,
                retryCount: 0,
                maxRetries: 3
            };

            // ì´ˆê¸°í™” ìƒíƒœ í‘œì‹œ ê´€ë¦¬
            const InitManager = {
                status: document.getElementById('initStatus'),
                
                show(message, type = 'info') {
                    if (this.status) {
                        this.status.textContent = message;
                        this.status.className = `init-status ${type}`;
                        this.status.style.display = 'block';
                    }
                    console.log(`ğŸ”„ ${message}`);
                },
                
                hide() {
                    if (this.status) {
                        setTimeout(() => {
                            this.status.style.display = 'none';
                        }, 2000);
                    }
                },
                
                success(message) {
                    this.show(message, 'success');
                    this.hide();
                },
                
                error(message) {
                    this.show(message, 'error');
                    setTimeout(() => this.hide(), 5000); // ì—ëŸ¬ëŠ” ë” ì˜¤ë˜ í‘œì‹œ
                },

                warning(message) {
                    this.show(message, 'warning');
                    setTimeout(() => this.hide(), 3000);
                }
            };

            // ì•ˆì „í•œ ì´ˆê¸°í™” í•¨ìˆ˜
            async function safeInitialize() {
                try {
                    InitManager.show('ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...');
                    
                    // 1. í•„ìˆ˜ ê°ì²´ë“¤ì´ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
                    await waitForEssentials();
                    InitManager.show('í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì™„ë£Œ');
                    
                    // 2. Lucide ì•„ì´ì½˜ ì´ˆê¸°í™”
                    if (typeof lucide !== 'undefined') {
                        lucide.createIcons();
                        InitManager.show('ì•„ì´ì½˜ ì´ˆê¸°í™” ì™„ë£Œ');
                    } else {
                        console.warn('âš ï¸ Lucide ì•„ì´ì½˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                    
                    // 3. SupabaseAPI ì´ˆê¸°í™” ëŒ€ê¸° (ì¤‘ìš”!)
                    await waitForSupabaseAPI();
                    InitManager.show('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì™„ë£Œ');
                    
                    // 4. AdminManager ì´ˆê¸°í™” í™•ì¸
                    await waitForAdminManager();
                    InitManager.show('ê´€ë¦¬ì ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ');
                    
                    // 5. ê´€ë¦¬ì ì•± ì´ˆê¸°í™”
                    await initializeAdminApp();
                    InitManager.success('ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
                    
                    // ì´ˆê¸°í™” ìƒíƒœ ì—…ë°ì´íŠ¸
                    adminInitState.supabaseInitialized = true;
                    adminInitState.adminManagerReady = true;
                    
                } catch (error) {
                    console.error('âŒ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    
                    // ì¬ì‹œë„ ë¡œì§
                    if (adminInitState.retryCount < adminInitState.maxRetries) {
                        adminInitState.retryCount++;
                        InitManager.warning(`ì´ˆê¸°í™” ì¬ì‹œë„ ì¤‘... (${adminInitState.retryCount}/${adminInitState.maxRetries})`);
                        
                        setTimeout(() => {
                            safeInitialize();
                        }, 2000 * adminInitState.retryCount); // ì ì§„ì  ì§€ì—°
                        return;
                    }
                    
                    InitManager.error(`ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`);
                    
                    // ì‚¬ìš©ìì—ê²Œ ë¬¸ì œ í•´ê²° ë°©ë²• ì œì‹œ
                    setTimeout(() => {
                        if (confirm('ì‹œìŠ¤í…œ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\\n\\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            window.location.reload();
                        }
                    }, 1000);
                }
            }

            // í•„ìˆ˜ ê°ì²´ë“¤ì´ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
            function waitForEssentials() {
                return new Promise((resolve, reject) => {
                    let attempts = 0;
                    const maxAttempts = 50; // 5ì´ˆ
                    
                    const check = () => {
                        attempts++;
                        
                        const hasConfig = window.CONFIG;
                        const hasSupabase = window.supabase && typeof window.supabase.createClient === 'function';
                        
                        console.log(`ğŸ” ì´ˆê¸°í™” ì²´í¬ ${attempts}/${maxAttempts}:`, {
                            CONFIG: hasConfig,
                            Supabase: hasSupabase
                        });
                        
                        if (hasConfig && hasSupabase) {
                            console.log('âœ… í•„ìˆ˜ ê°ì²´ ë¡œë“œ ì™„ë£Œ');
                            adminInitState.configLoaded = true;
                            resolve();
                        } else if (attempts >= maxAttempts) {
                            const missing = [];
                            if (!hasConfig) missing.push('CONFIG');
                            if (!hasSupabase) missing.push('Supabase');
                            reject(new Error(`í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨: ${missing.join(', ')}`));
                        } else {
                            setTimeout(check, 100);
                        }
                    };
                    
                    check();
                });
            }

            // SupabaseAPI ì´ˆê¸°í™” ëŒ€ê¸° (ì¤‘ìš”!)
            function waitForSupabaseAPI() {
                return new Promise((resolve, reject) => {
                    let attempts = 0;
                    const maxAttempts = 30; // 3ì´ˆ
                    
                    const check = async () => {
                        attempts++;
                        
                        if (window.SupabaseAPI && typeof window.SupabaseAPI.init === 'function') {
                            try {
                                console.log('ğŸ”— SupabaseAPI ì´ˆê¸°í™” ì¤‘...');
                                const success = await window.SupabaseAPI.init();
                                
                                if (success) {
                                    console.log('âœ… SupabaseAPI ì´ˆê¸°í™” ì™„ë£Œ');
                                    resolve();
                                    return;
                                }
                            } catch (error) {
                                console.warn(`âš ï¸ SupabaseAPI ì´ˆê¸°í™” ì‹œë„ ${attempts}/${maxAttempts} ì‹¤íŒ¨:`, error.message);
                            }
                        }
                        
                        if (attempts >= maxAttempts) {
                            reject(new Error('SupabaseAPI ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.'));
                        } else {
                            setTimeout(check, 100);
                        }
                    };
                    
                    check();
                });
            }

            // AdminManager ì´ˆê¸°í™” ëŒ€ê¸°
            function waitForAdminManager() {
                return new Promise((resolve, reject) => {
                    let attempts = 0;
                    const maxAttempts = 30; // 3ì´ˆ
                    
                    const check = () => {
                        attempts++;
                        
                        if (window.AdminManager && typeof window.AdminManager.init === 'function') {
                            console.log('âœ… AdminManager ì¤€ë¹„ ì™„ë£Œ');
                            resolve();
                        } else if (attempts >= maxAttempts) {
                            console.warn('âš ï¸ AdminManagerë¥¼ ì°¾ì„ ìˆ˜ ì—†ì§€ë§Œ ê³„ì† ì§„í–‰í•©ë‹ˆë‹¤.');
                            resolve(); // AdminManagerê°€ ì—†ì–´ë„ ê¸°ë³¸ ê¸°ëŠ¥ì€ ë™ì‘í•˜ë„ë¡
                        } else {
                            setTimeout(check, 100);
                        }
                    };
                    
                    check();
                });
            }

            // ê´€ë¦¬ì ì•± ì´ˆê¸°í™”
            async function initializeAdminApp() {
                console.log('ğŸš€ ê´€ë¦¬ì ì•± ì´ˆê¸°í™” ì‹œì‘');
                
                const adminSession = localStorage.getItem('adminSession');
                if (adminSession) {
                    console.log('ğŸ“‹ ê¸°ì¡´ ê´€ë¦¬ì ì„¸ì…˜ ë°œê²¬');
                    await showAdminDashboard();
                } else {
                    console.log('ğŸ” ê´€ë¦¬ì ì„¸ì…˜ ì—†ìŒ, ë¡œê·¸ì¸ í˜ì´ì§€ í‘œì‹œ');
                }

                setupAdminLoginEvents();
                console.log('âœ… ê´€ë¦¬ì ì•± ì´ˆê¸°í™” ì™„ë£Œ');
            }

            // ê´€ë¦¬ì ë¡œê·¸ì¸ ì´ë²¤íŠ¸ ì„¤ì •
            function setupAdminLoginEvents() {
                const adminLoginBtn = document.getElementById('adminLoginBtn');
                const adminCodeInput = document.getElementById('adminCode');

                if (adminLoginBtn) {
                    adminLoginBtn.addEventListener('click', handleAdminLogin);
                }

                if (adminCodeInput) {
                    adminCodeInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            handleAdminLogin();
                        }
                    });
                }
            }

            // ê´€ë¦¬ì ë¡œê·¸ì¸ ì²˜ë¦¬
            async function handleAdminLogin() {
                const code = document.getElementById('adminCode').value.trim();
                
                if (!code) {
                    alert('ê´€ë¦¬ì ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                try {
                    // ë¡œë”© ìƒíƒœ í‘œì‹œ
                    const loginBtn = document.getElementById('adminLoginBtn');
                    const originalText = loginBtn.innerHTML;
                    loginBtn.innerHTML = '<i data-lucide="loader-2"></i> ë¡œê·¸ì¸ ì¤‘...';
                    loginBtn.disabled = true;

                    // ê´€ë¦¬ì ì¸ì¦ ì‹œë„
                    const result = await SupabaseAPI.authenticateAdmin(code);
                    
                    if (result && result.success) {
                        // ì„¸ì…˜ ì €ì¥
                        localStorage.setItem('adminSession', 'true');
                        localStorage.setItem('adminInfo', JSON.stringify(result.data));
                        
                        // ëŒ€ì‹œë³´ë“œë¡œ ì „í™˜
                        await showAdminDashboard();
                    } else {
                        alert(result?.message || 'ê´€ë¦¬ì ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                    
                } catch (error) {
                    console.error('ê´€ë¦¬ì ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                    alert('ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    // ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
                    const loginBtn = document.getElementById('adminLoginBtn');
                    loginBtn.innerHTML = '<i data-lucide="log-in"></i> ê´€ë¦¬ì ë¡œê·¸ì¸';
                    loginBtn.disabled = false;
                    
                    if (typeof lucide !== 'undefined') {
                        lucide.createIcons();
                    }
                }
            }

            // ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ í‘œì‹œ
            async function showAdminDashboard() {
                const loginPage = document.getElementById('loginPage');
                const adminPage = document.getElementById('adminPage');
                
                if (loginPage) loginPage.classList.remove('active');
                if (adminPage) adminPage.classList.add('active');
                
                // ê¸°ëŠ¥ ì„¤ì • ë¡œë“œ
                if (window.AdminManager && typeof window.AdminManager.loadFeatureSettings === 'function') {
                    await window.AdminManager.loadFeatureSettings();
                }
                
                // ì•„ì´ì½˜ ì¬ì´ˆê¸°í™”
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }

            // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
            function handleLogout() {
                if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    localStorage.removeItem('adminSession');
                    localStorage.removeItem('adminInfo');
                    
                    if (window.SupabaseAPI && typeof window.SupabaseAPI.logout === 'function') {
                        window.SupabaseAPI.logout();
                    }
                    
                    window.location.reload();
                }
            }

            // ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜ë“¤
            function navigateToInstituteManagement() {
                window.location.href = 'admin/institute-management.html';
            }

            function navigateToFlightManagement() {
                window.location.href = 'admin/flight-management.html';
            }

            function navigateToEquipmentManagement() {
                window.location.href = 'admin/equipment-management.html';
            }

            // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
            window.handleAdminLogin = handleAdminLogin;
            window.handleLogout = handleLogout;
            window.navigateToInstituteManagement = navigateToInstituteManagement;
            window.navigateToFlightManagement = navigateToFlightManagement;
            window.navigateToEquipmentManagement = navigateToEquipmentManagement;

            // DOMContentLoaded ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.addEventListener('DOMContentLoaded', safeInitialize);

            return {
                initialize: safeInitialize,
                handleAdminLogin,
                handleLogout,
                navigateToInstituteManagement,
                navigateToFlightManagement,
                navigateToEquipmentManagement
            };
        })();
    </script>
</body>
</html>