<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¸ì¢…í•™ë‹¹ ë¬¸í™”ì¸í„´ ì§€ì› ì‹œìŠ¤í…œ - ê´€ë¦¬ì</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/main.css?v=1.4.0">
    <link rel="stylesheet" href="css/login.css?v=1.4.0">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Supabase JavaScript Client -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <!-- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì „ìš© ìŠ¤íƒ€ì¼ -->
    <style>
        .dashboard-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            padding: 2rem;
        }

        .dashboard-header {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .welcome-section {
            text-align: center;
            margin-bottom: 2rem;
        }

        .welcome-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            color: #718096;
            margin-bottom: 1rem;
        }

        .admin-info {
            background: #2d3748;
            color: white;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .admin-info h3 {
            margin: 0 0 0.5rem 0;
            color: white;
        }

        .admin-info p {
            margin: 0;
            color: #cbd5e0;
        }

        /* ê¸°ëŠ¥ í™œì„±í™” ê´€ë¦¬ ì„¹ì…˜ */
        .feature-settings-section {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .feature-settings-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feature-list {
            display: grid;
            gap: 1rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .feature-item {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .feature-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .feature-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
        }

        .feature-icon {
            width: 3rem;
            height: 3rem;
            background: linear-gradient(135deg, #2d3748, #4a5568);
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .feature-icon i {
            width: 1.5rem;
            height: 1.5rem;
        }

        .feature-details h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d3748;
            margin: 0 0 0.25rem 0;
        }

        .feature-details p {
            font-size: 0.875rem;
            color: #718096;
            margin: 0;
        }

        .feature-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .feature-status {
            font-size: 0.875rem;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            min-width: 4rem;
            text-align: center;
        }

        .feature-status.active {
            background: #c6f6d5;
            color: #22543d;
        }

        .feature-status.inactive {
            background: #fed7d7;
            color: #c53030;
        }

        /* í† ê¸€ ìŠ¤ìœ„ì¹˜ */
        .toggle-switch {
            position: relative;
            width: 3.5rem;
            height: 2rem;
            background: #cbd5e0;
            border-radius: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .toggle-switch.active {
            background: #48bb78;
        }

        .toggle-switch::before {
            content: '';
            position: absolute;
            top: 0.125rem;
            left: 0.125rem;
            width: 1.75rem;
            height: 1.75rem;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.active::before {
            transform: translateX(1.5rem);
        }

        /* ê´€ë¦¬ ë©”ë‰´ ê·¸ë¦¬ë“œ */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .menu-card {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .menu-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #2d3748, #4a5568);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .menu-card:hover::before {
            transform: scaleX(1);
        }

        .menu-icon {
            width: 4rem;
            height: 4rem;
            margin: 0 auto 1.5rem;
            background: linear-gradient(135deg, #2d3748, #4a5568);
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .menu-icon i {
            width: 2rem;
            height: 2rem;
        }

        .menu-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 1rem;
            text-align: center;
        }

        .menu-description {
            color: #718096;
            line-height: 1.6;
            margin-bottom: 2rem;
            text-align: center;
        }

        .menu-button {
            width: 100%;
            background: linear-gradient(135deg, #2d3748, #4a5568);
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .menu-button:hover {
            background: linear-gradient(135deg, #1a202c, #2d3748);
            transform: translateY(-2px);
        }

        .logout-section {
            text-align: center;
            margin-top: 2rem;
        }

        .logout-btn {
            background: #fed7d7;
            color: #c53030;
            border: 2px solid #fc8181;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #fc8181;
            color: white;
        }

        /* ë¡œë”© ìƒíƒœ */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .loading .toggle-switch {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 1rem;
            }

            .dashboard-header {
                padding: 1.5rem;
            }

            .welcome-title {
                font-size: 2rem;
            }

            .menu-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .menu-card {
                padding: 1.5rem;
            }

            .feature-list {
                gap: 0.75rem;
            }

            .feature-item {
                padding: 1rem;
                flex-direction: column;
                text-align: center;
            }

            .feature-controls {
                margin-top: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ í˜ì´ì§€ -->
        <div id="loginPage" class="page active">
            <div class="login-container">
                <div class="login-card">
                    <div class="login-header">
                        <h1>ì„¸ì¢…í•™ë‹¹ ë¬¸í™”ì¸í„´ ì§€ì› ì‹œìŠ¤í…œ</h1>
                        <p>Cultural Intern Support System - Administrator</p>
                    </div>

                    <div id="adminLogin" class="login-form active">
                        <div class="form-group">
                            <label>ê´€ë¦¬ì ì½”ë“œ</label>
                            <input type="password" id="adminCode" placeholder="ê´€ë¦¬ì ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                        </div>
                        <button id="adminLoginBtn" class="login-btn admin">
                            <i data-lucide="log-in"></i>
                            ê´€ë¦¬ì ë¡œê·¸ì¸
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ -->
        <div id="adminPage" class="page">
            <div class="dashboard-container">
                <!-- í—¤ë” ì„¹ì…˜ -->
                <div class="dashboard-header">
                    <div class="welcome-section">
                        <h1 class="welcome-title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
                        <p class="welcome-subtitle">Cultural Intern Support System - Administrator</p>
                    </div>
                    
                    <div class="admin-info">
                        <h3>ê´€ë¦¬ìë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!</h3>
                        <p>ì„¸ì¢…í•™ë‹¹ ë¬¸í™”ì¸í„´ ì§€ì› ì‹œìŠ¤í…œì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>

                <!-- ê¸°ëŠ¥ í™œì„±í™” ê´€ë¦¬ ì„¹ì…˜ -->
                <div class="feature-settings-section">
                    <h2 class="feature-settings-title">
                        <i data-lucide="settings"></i>
                        ê¸°ëŠ¥ í™œì„±í™” ê´€ë¦¬
                    </h2>
                    <div class="feature-list" id="featureList">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>

                <!-- ê´€ë¦¬ ë©”ë‰´ ê·¸ë¦¬ë“œ -->
                <div class="menu-grid">
                    <!-- íŒŒê²¬ í•™ë‹¹ ì •ë³´ ê´€ë¦¬ -->
                    <div class="menu-card" onclick="navigateToInstituteManagement()">
                        <div class="menu-icon">
                            <i data-lucide="building"></i>
                        </div>
                        <h2 class="menu-title">íŒŒê²¬ í•™ë‹¹ ì •ë³´ ê´€ë¦¬</h2>
                        <p class="menu-description">
                            ì„¸ì¢…í•™ë‹¹ ì •ë³´ë¥¼ ë“±ë¡í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.<br>
                            í•™ìƒ ë°°ì • ë° í˜„ì§€ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>
                        <button class="menu-button">
                            <i data-lucide="arrow-right"></i>
                            ê´€ë¦¬í•˜ê¸°
                        </button>
                    </div>

                    <!-- í•­ê³µê¶Œ êµ¬ë§¤ ì‹ ì²­ ê´€ë¦¬ -->
                    <div class="menu-card" onclick="navigateToFlightManagement()">
                        <div class="menu-icon">
                            <i data-lucide="plane"></i>
                        </div>
                        <h2 class="menu-title">í•­ê³µê¶Œ êµ¬ë§¤ ì‹ ì²­ ê´€ë¦¬</h2>
                        <p class="menu-description">
                            í•™ìƒë“¤ì˜ í•­ê³µê¶Œ êµ¬ë§¤ ì‹ ì²­ì„ ê²€í† í•˜ê³ <br>
                            ìŠ¹ì¸ ì²˜ë¦¬ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>
                        <button class="menu-button">
                            <i data-lucide="arrow-right"></i>
                            ê´€ë¦¬í•˜ê¸°
                        </button>
                    </div>

                    <!-- êµêµ¬ êµ¬ë§¤ ì‹ ì²­ ê´€ë¦¬ -->
                    <div class="menu-card" onclick="navigateToEquipmentManagement()">
                        <div class="menu-icon">
                            <i data-lucide="package"></i>
                        </div>
                        <h2 class="menu-title">êµêµ¬ êµ¬ë§¤ ì‹ ì²­ ê´€ë¦¬</h2>
                        <p class="menu-description">
                            í•™ìƒë“¤ì˜ êµêµ¬ ì‹ ì²­ì„ ê²€í† í•˜ê³ <br>
                            ì˜ˆì‚° ìŠ¹ì¸ ë° êµ¬ë§¤ ì²˜ë¦¬ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>
                        <button class="menu-button">
                            <i data-lucide="arrow-right"></i>
                            ê´€ë¦¬í•˜ê¸°
                        </button>
                    </div>
                </div>

                <!-- ë¡œê·¸ì•„ì›ƒ ì„¹ì…˜ -->
                <div class="logout-section">
                    <button class="logout-btn" onclick="handleLogout()">
                        <i data-lucide="log-out"></i>
                        ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="js/config.js?v=1.4.0"></script>
    <script src="js/supabase-client.js?v=1.4.0"></script>
    <script src="js/utils.js?v=1.4.0"></script>
    <script src="js/auth.js?v=1.4.0"></script>
    
    <!-- í˜ì´ì§€ ì´ˆê¸°í™” -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Lucide ì•„ì´ì½˜ ì´ˆê¸°í™”
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }

                // ê´€ë¦¬ì ì•± ì´ˆê¸°í™”
                initializeAdminApp();
                
            } catch (error) {
                console.error('ê´€ë¦¬ì í˜ì´ì§€ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
            }
        });

        // ê´€ë¦¬ì ì•± ì´ˆê¸°í™”
        function initializeAdminApp() {
            console.log('ğŸš€ ê´€ë¦¬ì ì•± ì´ˆê¸°í™”');
            
            try {
                const adminSession = localStorage.getItem('adminSession');
                if (adminSession) {
                    console.log('ğŸ“‹ ê¸°ì¡´ ê´€ë¦¬ì ì„¸ì…˜ ë°œê²¬, ëŒ€ì‹œë³´ë“œ í‘œì‹œ');
                    showAdminDashboard();
                } else {
                    console.log('ğŸ” ê´€ë¦¬ì ì„¸ì…˜ ì—†ìŒ, ë¡œê·¸ì¸ í˜ì´ì§€ í‘œì‹œ');
                }

                setupAdminLoginEvents();
                
                console.log('âœ… ê´€ë¦¬ì ì•± ì´ˆê¸°í™” ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ê´€ë¦¬ì ì•± ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
            }
        }

        // ê´€ë¦¬ì ë¡œê·¸ì¸ ì´ë²¤íŠ¸ ì„¤ì •
        function setupAdminLoginEvents() {
            const adminLoginBtn = document.getElementById('adminLoginBtn');
            const adminCodeInput = document.getElementById('adminCode');

            if (adminLoginBtn) {
                adminLoginBtn.addEventListener('click', handleAdminLogin);
            }

            if (adminCodeInput) {
                adminCodeInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handleAdminLogin();
                    }
                });
            }
        }

        // ê´€ë¦¬ì ë¡œê·¸ì¸ ì²˜ë¦¬
        async function handleAdminLogin() {
            const adminCode = document.getElementById('adminCode').value;
            
            if (!adminCode) {
                alert('ê´€ë¦¬ì ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const loginBtn = document.getElementById('adminLoginBtn');
            const originalText = loginBtn.innerHTML;
            
            try {
                // ë¡œë”© ìƒíƒœ í‘œì‹œ
                loginBtn.innerHTML = '<i data-lucide="loader-2"></i> ë¡œê·¸ì¸ ì¤‘...';
                loginBtn.disabled = true;
                
                // ê´€ë¦¬ì ì½”ë“œ ê²€ì¦
                const validCodes = ['admin123', 'sejong2025'];
                
                if (!validCodes.includes(adminCode)) {
                    throw new Error('ì˜ëª»ëœ ê´€ë¦¬ì ì½”ë“œì…ë‹ˆë‹¤');
                }
                
                // ì„¸ì…˜ ì •ë³´ ì €ì¥
                localStorage.setItem('adminSession', 'true');
                localStorage.setItem('adminLoginTime', new Date().toISOString());
                
                // ëŒ€ì‹œë³´ë“œ í‘œì‹œ
                showAdminDashboard();
                
                console.log('âœ… ê´€ë¦¬ì ë¡œê·¸ì¸ ì„±ê³µ');
                
            } catch (error) {
                console.error('âŒ ê´€ë¦¬ì ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
                alert(error.message || 'ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                
                // ë¡œë”© ìƒíƒœ í•´ì œ
                loginBtn.innerHTML = originalText;
                loginBtn.disabled = false;
                
                // ì•„ì´ì½˜ ì¬ìƒì„±
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }
        }

        // ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ í‘œì‹œ
        function showAdminDashboard() {
            console.log('ğŸ“Š ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ í‘œì‹œ');
            
            try {
                document.getElementById('loginPage').classList.remove('active');
                document.getElementById('adminPage').classList.add('active');
                
                // ê¸°ëŠ¥ ì„¤ì • ë¡œë“œ
                loadFeatureSettings();
                
                // ê´€ë¦¬ì ì •ë³´ í‘œì‹œ
                displayAdminInfo();
                
                console.log('âœ… ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ í‘œì‹œ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ í‘œì‹œ ì˜¤ë¥˜:', error);
                alert('ëŒ€ì‹œë³´ë“œë¥¼ í‘œì‹œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê´€ë¦¬ì ì •ë³´ í‘œì‹œ
        function displayAdminInfo() {
            try {
                const adminInfoElement = document.querySelector('.admin-info');
                if (adminInfoElement) {
                    const loginTime = new Date().toLocaleString('ko-KR');
                    adminInfoElement.innerHTML = `
                        <h3>ê´€ë¦¬ìë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!</h3>
                        <p>ì„¸ì¢…í•™ë‹¹ ë¬¸í™”ì¸í„´ ì§€ì› ì‹œìŠ¤í…œì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        <small>ë¡œê·¸ì¸ ì‹œê°„: ${loginTime}</small>
                    `;
                }
            } catch (error) {
                console.error('âŒ ê´€ë¦¬ì ì •ë³´ í‘œì‹œ ì˜¤ë¥˜:', error);
            }
        }

        // ê¸°ëŠ¥ ì„¤ì • ë¡œë“œ - SupabaseAPI ì‚¬ìš©ìœ¼ë¡œ ìˆ˜ì •
        async function loadFeatureSettings() {
            try {
                console.log('ğŸ”§ ê¸°ëŠ¥ ì„¤ì • ë¡œë“œ ì‹œì‘');
                
                // SupabaseAPIê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°
                await waitForSupabaseAPIReady();
                
                // SupabaseAPIë¥¼ í†µí•´ ê¸°ëŠ¥ ì„¤ì • ì¡°íšŒ
                const client = await SupabaseAPI.ensureClient();
                const { data: features, error } = await client
                    .from('feature_settings')
                    .select('*')
                    .order('display_order');

                if (error) {
                    console.warn('âš ï¸ ê¸°ëŠ¥ ì„¤ì • ì¡°íšŒ ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©:', error);
                    throw error;
                }

                console.log('ğŸ“‹ ê¸°ëŠ¥ ì„¤ì • ì¡°íšŒ ì„±ê³µ:', features.length, 'ê°œ');
                renderFeatureList(features);
                
            } catch (error) {
                console.error('âŒ ê¸°ëŠ¥ ì„¤ì • ë¡œë“œ ì˜¤ë¥˜:', error);
                // ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ë Œë”ë§
                const defaultFeatures = [
                    { feature_name: 'institute_info', feature_title: 'íŒŒê²¬ í•™ë‹¹ ì •ë³´', is_active: true },
                    { feature_name: 'flight_request', feature_title: 'í•­ê³µê¶Œ êµ¬ë§¤ ì‹ ì²­', is_active: false },
                    { feature_name: 'equipment_request', feature_title: 'ë¬¸í™”êµêµ¬ ì‹ ì²­', is_active: true }
                ];
                renderFeatureList(defaultFeatures);
            }
        }

        // SupabaseAPI ì¤€ë¹„ ìƒíƒœ í™•ì¸
        function waitForSupabaseAPIReady() {
            return new Promise((resolve, reject) => {
                let attempts = 0;
                const maxAttempts = 50; // 5ì´ˆ ëŒ€ê¸°
                
                const checkSupabaseAPI = () => {
                    attempts++;
                    
                    if (window.SupabaseAPI && typeof window.SupabaseAPI.ensureClient === 'function') {
                        console.log('âœ… SupabaseAPI ì¤€ë¹„ë¨');
                        resolve();
                    } else if (attempts >= maxAttempts) {
                        console.error('âŒ SupabaseAPI ì´ˆê¸°í™” ì‹œê°„ ì´ˆê³¼');
                        reject(new Error('SupabaseAPI ì´ˆê¸°í™” ì‹œê°„ ì´ˆê³¼'));
                    } else {
                        setTimeout(checkSupabaseAPI, 100);
                    }
                };
                
                checkSupabaseAPI();
            });
        }

        // ê¸°ëŠ¥ ëª©ë¡ ë Œë”ë§
        function renderFeatureList(features) {
            console.log('ğŸ¨ ê¸°ëŠ¥ ëª©ë¡ ë Œë”ë§ ì‹œì‘');
            
            const featureList = document.getElementById('featureList');
            if (!featureList) {
                console.warn('âš ï¸ featureList ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            const icons = {
                'institute_info': 'building',
                'flight_request': 'plane',
                'equipment_request': 'package'
            };

            const descriptions = {
                'institute_info': 'í•™ìƒë“¤ì´ íŒŒê²¬ í•™ë‹¹ ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤',
                'flight_request': 'í•™ìƒë“¤ì´ í•­ê³µê¶Œ êµ¬ë§¤ ì‹ ì²­ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤',
                'equipment_request': 'í•™ìƒë“¤ì´ ë¬¸í™”êµêµ¬ ì‹ ì²­ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤'
            };

            featureList.innerHTML = features.map(feature => `
                <div class="feature-item" data-feature="${feature.feature_name}">
                    <div class="feature-info">
                        <div class="feature-icon">
                            <i data-lucide="${icons[feature.feature_name] || 'settings'}"></i>
                        </div>
                        <div class="feature-details">
                            <h4>${feature.feature_title}</h4>
                            <p>${descriptions[feature.feature_name] || 'ê¸°ëŠ¥ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤'}</p>
                        </div>
                    </div>
                    <div class="feature-controls">
                        <span class="feature-status ${feature.is_active ? 'active' : 'inactive'}">
                            ${feature.is_active ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}
                        </span>
                        <div class="toggle-switch ${feature.is_active ? 'active' : ''}" 
                             onclick="toggleFeature('${feature.feature_name}', ${!feature.is_active})">
                        </div>
                    </div>
                </div>
            `).join('');

            // ì•„ì´ì½˜ ë‹¤ì‹œ ì´ˆê¸°í™”
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            console.log('âœ… ê¸°ëŠ¥ ëª©ë¡ ë Œë”ë§ ì™„ë£Œ');
        }

        // ê¸°ëŠ¥ í† ê¸€ - SupabaseAPI ì‚¬ìš©ìœ¼ë¡œ ìˆ˜ì •
        async function toggleFeature(featureName, newState) {
            console.log(`ğŸ”„ ê¸°ëŠ¥ í† ê¸€: ${featureName} â†’ ${newState}`);
            
            const featureItem = document.querySelector(`[data-feature="${featureName}"]`);
            if (featureItem) {
                featureItem.classList.add('loading');
            }
            
            try {
                // SupabaseAPIë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ í™•ì¸
                if (!window.SupabaseAPI) {
                    throw new Error('SupabaseAPIë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
                
                const client = await SupabaseAPI.ensureClient();
                const { error } = await client
                    .from('feature_settings')
                    .update({ 
                        is_active: newState,
                        updated_by: 'admin',
                        updated_at: new Date().toISOString()
                    })
                    .eq('feature_name', featureName);

                if (error) {
                    console.error('âŒ ê¸°ëŠ¥ í† ê¸€ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                    throw error;
                }

                // ì„±ê³µì‹œ UI ì—…ë°ì´íŠ¸
                await loadFeatureSettings();
                
                // ì„±ê³µ ë©”ì‹œì§€
                const featureTitle = {
                    'institute_info': 'íŒŒê²¬ í•™ë‹¹ ì •ë³´',
                    'flight_request': 'í•­ê³µê¶Œ êµ¬ë§¤ ì‹ ì²­',
                    'equipment_request': 'ë¬¸í™”êµêµ¬ ì‹ ì²­'
                }[featureName] || featureName;

                alert(`${featureTitle} ê¸°ëŠ¥ì´ ${newState ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                
                console.log(`âœ… ê¸°ëŠ¥ í† ê¸€ ì™„ë£Œ: ${featureName}`);

            } catch (error) {
                console.error('âŒ ê¸°ëŠ¥ í† ê¸€ ì˜¤ë¥˜:', error);
                alert('ì„¤ì • ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                
                // ì‹¤íŒ¨ì‹œ UI ë³µì›
                await loadFeatureSettings();
            } finally {
                if (featureItem) {
                    featureItem.classList.remove('loading');
                }
            }
        }

        // ê° ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™
        function navigateToInstituteManagement() {
            window.location.href = 'admin/institute-management.html';
        }

        function navigateToFlightManagement() {
            window.location.href = 'admin/flight-management.html';
        }

        function navigateToEquipmentManagement() {
            console.log('ğŸ¥ êµêµ¬ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™ ì‹œì‘');
            
            try {
                // 1. ê´€ë¦¬ì ì„¸ì…˜ í™•ì¸
                const adminSession = localStorage.getItem('adminSession');
                if (!adminSession) {
                    alert('ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    return;
                }
                
                // 2. í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì €ì¥ (êµêµ¬ ê´€ë¦¬ í˜ì´ì§€ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡)
                const adminInfo = {
                    sessionId: adminSession,
                    loginTime: new Date().toISOString(),
                    userType: 'admin'
                };
                localStorage.setItem('adminInfo', JSON.stringify(adminInfo));
                
                // 3. êµêµ¬ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™
                window.location.href = 'admin/equipment-management.html';
                
                console.log('âœ… êµêµ¬ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ êµêµ¬ ê´€ë¦¬ í˜ì´ì§€ ì´ë™ ì˜¤ë¥˜:', error);
                alert('êµêµ¬ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        function handleLogout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    // ëª¨ë“  ê´€ë¦¬ì ê´€ë ¨ ë°ì´í„° ì‚­ì œ
                    localStorage.removeItem('adminSession');
                    localStorage.removeItem('adminInfo');
                    localStorage.removeItem('adminLoginTime');
                    
                    console.log('âœ… ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
                    
                    // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    window.location.href = 'admin.html';
                    
                } catch (error) {
                    console.error('âŒ ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
                    alert('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        // ê°œë°œì ë„êµ¬ (ë””ë²„ê¹…ìš©)
        if (window.CONFIG && window.CONFIG.DEV && window.CONFIG.DEV.DEBUG) {
            window.AdminDebug = {
                // ê°•ì œ ë¡œê·¸ì¸
                forceLogin() {
                    localStorage.setItem('adminSession', 'true');
                    showAdminDashboard();
                    console.log('ğŸ› ï¸ ê°•ì œ ë¡œê·¸ì¸ ì™„ë£Œ');
                },
                
                // ì„¸ì…˜ ì •ë³´ í™•ì¸
                checkSession() {
                    const session = localStorage.getItem('adminSession');
                    const info = localStorage.getItem('adminInfo');
                    const loginTime = localStorage.getItem('adminLoginTime');
                    
                    console.log('ğŸ“Š ì„¸ì…˜ ì •ë³´:', {
                        session,
                        info: info ? JSON.parse(info) : null,
                        loginTime
                    });
                },
                
                // ê¸°ëŠ¥ ì„¤ì • ê°•ì œ ë¡œë“œ
                async reloadFeatures() {
                    await loadFeatureSettings();
                    console.log('ğŸ”„ ê¸°ëŠ¥ ì„¤ì • ê°•ì œ ë¡œë“œ ì™„ë£Œ');
                }
            };
            
            console.log('ğŸ› ï¸ ê´€ë¦¬ì ë””ë²„ê·¸ ë„êµ¬ ì‚¬ìš©ë²•:');
            console.log('  AdminDebug.forceLogin() - ê°•ì œ ë¡œê·¸ì¸');
            console.log('  AdminDebug.checkSession() - ì„¸ì…˜ ì •ë³´ í™•ì¸');
            console.log('  AdminDebug.reloadFeatures() - ê¸°ëŠ¥ ì„¤ì • ê°•ì œ ë¡œë“œ');
        }
    </script>
</body>
</html>